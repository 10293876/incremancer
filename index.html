<!DOCTYPE html>
<html ng-app="zombieApp">
  <head>
    <title>Incremancer</title>
    <meta name="description" content="Zombie necromancer idle game">
    <meta name="keywords" content="zombie,game,idle,javascript">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#104510" />
    <link rel="manifest" href="manifest.json">
    <!-- <script src="js/pixi.min.js"></script> -->
    <script src="js/pixi-legacy.min.js"></script>
    <script src="js/utilsfunctions.js"></script>
    <script src="js/zombiemancer.js"></script>
    <script src="js/spells.js"></script>
    <script src="js/map.js"></script>
    <script src="js/gamemodel.js"></script>
    <script src="js/upgrades.js"></script>
    <script src="js/humans.js"></script>
    <script src="js/zombies.js"></script>
    <script src="js/graveyard.js"></script>
    <script src="js/particles.js"></script>
    <script src="js/angular.min.js"></script>
    <script src="js/angularzombie.js"></script>
    <link rel="stylesheet" type="text/css" href="zombiemancer.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
  </head>
  <body ng-controller="ZombieController as zm">
    <div class="top-bar">
      <div class="resources">
          <label class="energy">Energy: {{zm.model.energy|decimal}} / {{zm.model.energyMax|whole}}<span class="percent" ng-style="{'width':zm.energyPercent() + '%'}"></span></label>
          <label class="blood">Blood: {{zm.model.persistentData.blood|whole}} / {{zm.model.bloodMax|whole}}<span class="percent" ng-style="{'width':zm.bloodPercent() + '%'}"></span></label>
          <label class="brains">Brains: {{zm.model.persistentData.brains|whole}} / {{zm.model.brainsMax|whole}}<span class="percent" ng-style="{'width':zm.brainsPercent() + '%'}"></span></label>
          <label class="bones" ng-if="zm.model.constructions.graveyard || zm.model.persistentData.bones > 0">Bones: {{zm.model.persistentData.bones|whole}}</label>
      </div>
      <div class="stats">
        <label>Level: {{zm.model.level}}</label>
        <label>Humans: {{zm.model.getHumanCount()}}</label>
        <label>Zombies: {{zm.model.zombieCount}}</label>
        <label ng-if="zm.model.persistentData.showfps">FPS: {{zm.model.frameRate}}</label>
      </div>
      <div class="message" ng-if="zm.message">
          <p>{{zm.message}}</p>
        </div>
    </div>

    <div class="buttons {{zm.sidePanels.open ? 'open' : ''}}">
      <button ng-click="zm.openSidePanel('shop');" class="{{zm.sidePanels.shop ? 'active' : ''}}">Shop</button>
      <button ng-click="zm.openSidePanel('construction');" ng-if="zm.model.construction" class="{{zm.sidePanels.construction ? 'active' : ''}}"><span ng-if="zm.model.persistentData.currentConstruction" class="tag">{{zm.constructionPercent()}}%</span>Construction</button>
      <button ng-click="zm.openSidePanel('graveyard');" ng-if="zm.model.constructions.graveyard" class="{{zm.sidePanels.graveyard ? 'active' : ''}}">Graveyard</button>
      <button ng-click="zm.openSidePanel('prestige');" ng-if="zm.isShowPrestige()" class="{{zm.sidePanels.prestige ? 'active' : ''}}">Prestige</button>
      <button ng-click="zm.openSidePanel('options');" class="{{zm.sidePanels.options ? 'active' : ''}}">Options</button>
    </div>

    <div class="zoom-buttons" ng-if="zm.model.persistentData.zoomButtons">
      <button ng-click="zm.zoom(-1);">-</button>
      <button ng-click="zm.resetZoom();">Reset</button>
      <button ng-click="zm.zoom(+1);">+</button>
    </div>

    <div class="shop" ng-if="zm.sidePanels.prestige">
      <div class="shop-title">
        <h2>Prestige Menu</h2>
        <button ng-click="zm.closeSidePanels()">Close</button>
      </div>
      <h3>Prestige now to unlock {{zm.model.persistentData.prestigePointsEarned|whole}} prestige points</h3>
      <p class="prestige-info">This will reset your game progress but grant you powerful prestige points to spend.</p>
      <button ng-click="zm.doPrestige();" ng-disabled="zm.model.persistentData.prestigePointsEarned <= 0">Prestige Now</button>
      <p class="prestige-info">You currently have {{zm.model.persistentData.prestigePointsToSpend|whole}} prestige points to spend</p>
      <div class="upgrades">
        <div ng-repeat="upgrade in zm.upgrades" class="upgrade {{upgrade.costType}}">
          <h4>{{upgrade.name}}</h4>
          <h4 class="cost">Cost: {{zm.upgradePrice(upgrade)|whole}} Points</h4>
          <label>{{zm.upgradeSubtitle(upgrade)}}</label>
          <p>{{upgrade.description}}</p>
          <p>Current Rank: {{zm.currentRank(upgrade)}}{{upgrade.cap != 0 ? ' / ' + upgrade.cap : ''}} - {{zm.upgradeStatInfo(upgrade)}}</p>
          <button ng-click="zm.buyUpgrade(upgrade);" ng-disabled="zm.upgradeTooExpensive(upgrade);">{{upgrade.cap != 0 && zm.currentRank(upgrade) >= upgrade.cap ? 'Sold Out' : zm.upgradeTooExpensive(upgrade) ? zm.requiredForUpgrade(upgrade) : zm.purchaseText(upgrade)}}</button>
        </div>
      </div>
    </div>

    <div class="shop" ng-if="zm.sidePanels.shop">
      <div class="shop-title">
        <h2>Shop</h2>
        <button ng-click="zm.closeSidePanels();">Close</button>
      </div>

      <div class="tabs">
        <!-- <h3>What would you like to pay with?</h3> -->
        <button ng-click="zm.filterShop('blood');" class="blood {{zm.currentShopFilter == 'blood' ? 'active' : ''}}">Blood</button>
        <button ng-click="zm.filterShop('brains');" class="brains {{zm.currentShopFilter == 'brains' ? 'active' : ''}}">Brains</button>
        <button ng-click="zm.filterShop('bones');" class="bones {{zm.currentShopFilter == 'bones' ? 'active' : ''}}" ng-if="zm.model.constructions.graveyard">Bones</button>
        <button ng-click="zm.filterShop('completed');" class="bones {{zm.currentShopFilter == 'completed' ? 'active' : ''}}">Completed</button>
      </div>

      <div class="upgrades">
        <div ng-repeat="upgrade in zm.upgrades" class="upgrade {{upgrade.costType}}">
          <h4>{{upgrade.name}}</h4>
          <h4 class="cost">{{zm.upgradePrice(upgrade)|whole}} {{upgrade.costType}}</h4>
          <label>{{zm.upgradeSubtitle(upgrade)}}</label>
          <button ng-click="zm.buyUpgrade(upgrade);" ng-disabled="zm.upgradeTooExpensive(upgrade);">{{zm.upgradeButtonText(upgrade)}}</button>
          <button ng-click="upgrade.selected = !upgrade.selected" class="info  {{upgrade.selected ? 'active' : ''}}">Info</button>
          <p ng-show="upgrade.selected">{{upgrade.description}}</p>
          <p ng-show="upgrade.selected">Current Rank: {{zm.currentRank(upgrade)}}{{upgrade.cap != 0 ? ' / ' + upgrade.cap : ''}} - {{zm.upgradeStatInfo(upgrade)}}</p>
          <span class="percent" ng-style="{'width':zm.upgradePercent(upgrade) + '%'}"></span>
        </div>
      </div>
    </div>

    <div class="shop" ng-if="zm.sidePanels.construction">
      <div class="shop-title">
        <h2>Unholy Construction</h2>
        <button ng-click="zm.closeSidePanels();">Close</button>
      </div>
      <div class="tabs">
        <button ng-click="zm.filterConstruction('available');" class="{{zm.currentConstructionFilter == 'available' ? 'active' : ''}}">Available</button>
        <button ng-click="zm.filterConstruction('completed');" class="{{zm.currentConstructionFilter == 'completed' ? 'active' : ''}}">Completed</button>
      </div>
      <div class="upgrade current-construction" ng-if="zm.model.persistentData.currentConstruction">
        <h4>Building - {{zm.model.persistentData.currentConstruction.name}}</h4>
        <p>Consuming 
          <span ng-if="zm.model.persistentData.currentConstruction.costPerTick.energy" class="energy">{{zm.model.persistentData.currentConstruction.costPerTick.energy|decimal}} energy</span> 
          <span ng-if="zm.model.persistentData.currentConstruction.costPerTick.blood" class="blood">{{zm.model.persistentData.currentConstruction.costPerTick.blood|decimal}} blood</span>
          <span ng-if="zm.model.persistentData.currentConstruction.costPerTick.brains" class="brains">{{zm.model.persistentData.currentConstruction.costPerTick.brains|decimal}} brains</span>
          <span ng-if="zm.model.persistentData.currentConstruction.costPerTick.bones" class="bones">{{zm.model.persistentData.currentConstruction.costPerTick.bones|decimal}} bones</span>
          each second
        </p>
        <div class="progress {{zm.model.persistentData.currentConstruction.state == 'building' ? 'active' : 'stopped'}}">
          <div ng-style="{'width':zm.constructionPercent() + '%'}"></div>
          <span>{{zm.constructionPercent()}}%</span>
        </div>
        <p ng-if="!zm.model.persistentData.currentConstruction.shortfall"><strong>Time Remaining: {{zm.model.persistentData.currentConstruction.timeRemaining}}</strong></p>
        <p ng-if="zm.model.persistentData.currentConstruction.shortfall">
          <strong>Production stopped, need more
          <span ng-if="zm.model.persistentData.currentConstruction.shortfall.energy" class="energy">energy</span>
          <span ng-if="zm.model.persistentData.currentConstruction.shortfall.blood" class="blood">blood</span>
          <span ng-if="zm.model.persistentData.currentConstruction.shortfall.brains" class="brains">brains</span>
          <span ng-if="zm.model.persistentData.currentConstruction.shortfall.bones" class="bones">bones</span>
          </strong>
        </p>
        <button ng-click="zm.playPauseConstruction();">{{zm.model.persistentData.currentConstruction.state == 'paused' ? 'Resume' : 'Pause'}}</button>
        <button ng-click="zm.cancelConstruction();">Cancel</button>
      </div>
      <div class="upgrades">
        <div ng-repeat="upgrade in zm.upgrades" class="upgrade">
          <h4>{{upgrade.name}}</h4>
          <p>{{upgrade.description}}</p>
          <label>Time to build: {{upgrade.time}} seconds</label>
          <div>
            <label>Total Cost: </label>
            <label ng-if="upgrade.costs.energy" class="energy">{{upgrade.costs.energy}} energy</label>
            <label ng-if="upgrade.costs.blood" class="blood">{{upgrade.costs.blood}} blood</label>
            <label ng-if="upgrade.costs.brains" class="brains">{{upgrade.costs.brains}} brains</label>
            <label ng-if="upgrade.costs.bones" class="bones">{{upgrade.costs.bones}} bones</label>
          </div>
          <label ng-if="zm.constructionLeadsTo(upgrade)">Required for: {{zm.constructionLeadsTo(upgrade)}}</label>
          <p>Current Rank: {{zm.currentRankConstruction(upgrade)}} / {{upgrade.cap}}</p>
          <button ng-click="zm.startConstruction(upgrade);" ng-disabled="zm.model.persistentData.currentConstruction" ng-show="zm.currentRankConstruction(upgrade) < upgrade.cap">Begin Construction</button>
        </div>
      </div>
    </div>

    <div class="shop" ng-if="zm.sidePanels.graveyard">
      <div class="shop-title">
        <h2>Cursed Graveyard</h2>
        <button ng-click="zm.closeSidePanels();">Close</button>
      </div>
      <div class="upgrades">
        <div class="bone-collectors bones">
          <h4>Bone Collectors</h4>
          <p>Hire bone collectors to gather bones from the town's dead and your own fallen zombies. Each bone collector consumes 1 energy per second. They're hungry little creatures. Must be all that running around.</p>
          <h4>Energy rate {{zm.model.getEnergyRate()|decimal}} per second</h4>
          <button ng-click="zm.subtractBoneCollector();">-</button><label>{{zm.model.persistentData.boneCollectors|whole}} bone collectors</label><button ng-click="zm.addBoneCollector();">+</button>
        </div>
        <div class="bone-collectors bones">
          <h4>Zombies to Spawn</h4>
          <p>Control how many zombies the graveyard spawns each time your energy is full. This is limited by your maximum energy.</p>
          <button ng-click="zm.subtractGraveyardZombie();">-</button><label>{{zm.model.persistentData.graveyardZombies|whole}} zombies</label><button ng-click="zm.addGraveyardZombie();">+</button>
        </div>
      </div>
    </div>

    <div class="shop" ng-if="zm.sidePanels.options">
      <div class="shop-title">
        <h2>Options</h2>
        <button ng-click="zm.closeSidePanels();">Close</button>
      </div>
      <div class="upgrades">
        <div class="upgrade">
          <h4>How to play</h4>
          <ul>
            <li ng-repeat="text in zm.howToPlay">{{text}}</li>
          </ul>
        </div>
        <div class="upgrade">
          <h4>Auto Start Next Level</h4>
          <p>Automatically start the next level after 3 seconds. If you want to play without actually playing.</p>
          <button ng-click="zm.toggleAutoStart();">{{zm.model.persistentData.autoStart ? "On" : "Off"}}</button>
        </div>
        <div class="upgrade">
          <h4>Render Resolution</h4>
          <p>Choose your preferred resolution to render the game.</p>
          <p>50% will run better on slower hardware but may look blurry.</p>
          <p>100% will pixel match the resolution reported by your browser.</p>
          <p>200% will double the reported values which may look better on retina devices or smartphones.</p>
          <button ng-click="zm.toggleResolution(0.5);" class="{{zm.getResolution() == 0.5 ? 'active' : ''}}">50%</button>
          <button ng-click="zm.toggleResolution(1);" class="{{zm.getResolution() == 1 ? 'active' : ''}}">100%</button>
          <button ng-click="zm.toggleResolution(2);" class="{{zm.getResolution() == 2 ? 'active' : ''}}">200%</button>
        </div>
        <div class="upgrade" ng-if="zm.model.deferredPrompt">
          <h4>Add to Home Screen</h4>
          <p>You can add this game to your smartphones home screen without having to install anything.</p>
          <button ng-click="zm.addToHomeScreen();">Add to Home Screen</button>
        </div>
        <div class="upgrade">
          <h4>Show Zoom Buttons</h4>
          <p>If you're unable to zoom with other methods this will add some buttons to the screen for zooming the map.</p>
          <button ng-click="zm.toggleZoomButtons();">{{zm.model.persistentData.zoomButtons ? "On" : "Off"}}</button>
        </div>
        <div class="upgrade">
          <h4>Show Framerate Counter</h4>
          <p>Used for performance testing</p>
          <button ng-click="zm.toggleShowFps();">{{zm.model.persistentData.showfps ? "On" : "Off"}}</button>
        </div>
        <div class="upgrade">
          <h4>Reset Game</h4>
          <p>This will reset all save data if you want to start from the very beginning again.</p>
          <button ng-click="zm.resetGame();">Reset Game</button>
        </div>
      </div>
    </div>

    <div class="start-game" ng-if="zm.model.currentState == zm.model.states.startGame">
      <h2>Incremancer</h2>
      <h4>Take control of a horde of zombies to ravage small towns</h4>
      <ul>
        <li ng-repeat="text in zm.howToPlay">{{text}}</li>
      </ul>
      <button ng-click="zm.startGame();">Start Level {{zm.model.level}}</button>
    </div>

    <div class="end-level" ng-if="zm.model.currentState == zm.model.states.levelCompleted">
      <h2>Level {{zm.model.level}} Complete</h2>
      <h4>All the humans are either dead or undead!</h4>
      <h4>You have earned {{zm.model.level}} prestige points</h4>
      <h4 ng-if="zm.model.endLevelBones">Your bone collectors have gathered the remaining {{zm.model.endLevelBones}} bones from the town</h4>
      <button ng-click="zm.nextLevel();">Start Level {{zm.model.level + 1}}</button>
    </div>

    <div class="start-game" ng-if="zm.model.currentState == zm.model.states.prestiged">
      <h2>You have prestiged!</h2>
      <p>It's time to start from the beginning again, but this time stronger and faster.</p>
      <h4>You have {{zm.model.persistentData.prestigePointsToSpend}} prestige points to spend</h4>
      <p>It is recommended to spend your points before clicking start game</p>
      <p>as some of their effects will only activate when a new level is started.</p>
      <button ng-click="zm.startGame();">Start Level {{zm.model.level}}</button>
    </div>
  </body>
</html>
var Incremancer;(()=>{"use strict";var e={115:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});var s=i(838);angular.module("zombieApp",[]).filter("decimal",(function(){return s.format2Places})).filter("whole",(function(){return s.formatWhole})).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|javascript|data|blob):/),e.debugInfoEnabled(!1)}]).controller("ZombieController",["$scope","$interval","$document",function(e,t,i){var a=new s.Skeleton,r=new s.Spells,n=new s.PartFactory,o=new s.CreatureFactory,h=new s.Upgrades,l=new s.Trophies,c=this;function d(){var e=(new Date).getTime();!function(e,t){c.model.update(e,t),c.updateMessages(e)}(Math.min(1e3,Math.max(e-c.lastUpdate,0))/1e3,e),c.lastUpdate=e}c.model=s.GameModel.getInstance(),c.skeleton=function(){return a.persistent},c.spells=r,c.keysPressed=s.KeysPressed,c.files=[],c.messageTimer=4,c.message=!1,c.lastUpdate=0,c.sidePanels={},c.upgrades=[],c.currentShopFilter="blood",c.currentConstructionFilter="available",c.graveyardTab="minions",c.trophyTab="all",c.factoryTab="parts",c.factoryStats={},c.moveTooltip=s.moveToolTip,c.closeSidePanels=function(){c.currentShopFilter="blood",c.currentConstructionFilter="available",c.graveyardTab="minions",c.factoryTab="parts",c.sidePanels.options=!1,c.sidePanels.graveyard=!1,c.sidePanels.runesmith=!1,c.sidePanels.prestige=!1,c.sidePanels.construction=!1,c.sidePanels.shop=!1,c.sidePanels.open=!1,c.sidePanels.factory=!1,c.levelSelect.shown=!1},c.openSidePanel=function(e){var t;switch(c.closeSidePanels(),e){case"shop":c.filterShop(c.currentShopFilter),c.sidePanels.shop=!0;break;case"construction":c.filterConstruction(c.currentConstructionFilter),c.sidePanels.construction=!0;break;case"graveyard":c.sidePanels.graveyard=!0,c.graveyardTab="minions",c.trophyTab="all";break;case"runesmith":c.sidePanels.runesmith=!0;break;case"factory":c.sidePanels.factory=!0,c.upgrades=n.generators,c.factoryStats=n.factoryStats(),c.factory.updateDelays();break;case"prestige":c.upgrades=h.prestigeUpgrades.filter((function(e){return 0==e.cap||c.currentRank(e)<e.cap})),(t=c.upgrades).push.apply(t,h.prestigeUpgrades.filter((function(e){return 0!==e.cap&&c.currentRank(e)>=e.cap}))),c.sidePanels.prestige=!0;break;case"options":c.sidePanels.options=!0,c.model.downloadSaveGame()}c.sidePanels.open=!0},c.graveyardTabSelect=function(e){c.graveyardTab=e,"trophies"==e&&(c.trophies=l.getTrophyList(),c.trophyTab="all")},c.trophyTabSelect=function(e){switch(c.trophyTab=e,e){case"all":c.trophies=l.getTrophyList();break;case"collected":c.trophies=l.getTrophyList().filter((function(e){return e.owned}));break;case"uncollected":c.trophies=l.getTrophyList().filter((function(e){return!e.owned}));break;case"totals":c.trophies=l.getTrophyTotals()}},c.filterShop=function(e){c.currentShopFilter=e,c.upgrades=h.getUpgrades(e)},c.filterConstruction=function(e){switch(c.currentConstructionFilter=e,e){case"available":c.upgrades=h.getAvailableConstructions();break;case"completed":c.upgrades=h.getCompletedConstructions()}},c.resetGame=function(){confirm("Are you sure you want to reset everything? If you have a cloud save it will also be deleted. Make sure you export your save game first.")&&c.model.resetData()},c.addBoneCollector=function(){c.model.getEnergyRate()>=1&&c.model.persistentData.boneCollectors++},c.subtractBoneCollector=function(){c.model.persistentData.boneCollectors>0&&c.model.persistentData.boneCollectors--},c.setHarpies=function(e){(e>=0&&e<c.model.persistentData.harpies||c.model.getEnergyRate()>=1&&e>0)&&(c.model.persistentData.harpies=e)},c.setGraveyardZombies=function(e){e<=c.maxGraveyardZombies()&&e>=0&&(c.model.persistentData.graveyardZombies=e)},c.maxGraveyardZombies=function(){return Math.floor(c.model.energyMax/c.model.zombieCost)},c.upgradePrice=function(e){return c.sidePanels.factory?n.purchasePrice(e):h.upgradePrice(e)},c.factory={delays:[],changeFactoryTab:function(e){c.factoryTab=e,"parts"==e?(c.upgrades=n.generators,this.updateDelays()):c.upgrades=o.creatures},buyGenerator:function(e){c.keysPressed.shift?n.purchaseMaxGenerators(e):n.purchaseGenerator(e),c.factoryStats=n.factoryStats()},generatorPrice:function(e){return n.purchasePrice(e)},creaturePrice:function(e){return o.purchasePrice(e)},creatureLevelPrice:function(e){return o.levelPrice(e)},creaturePercent:function(e){return Math.min(Math.round(c.model.persistentData.parts/this.creaturePrice(e)*100),100)},creatureLevelPercent:function(e){return Math.min(Math.round(c.model.persistentData.parts/this.creatureLevelPrice(e)*100),100)},buyCreature:function(e){return o.startBuilding(e)},creatureTooExpensive:function(e){return!o.canAffordCreature(e)},creatureButtonText:function(e){return e.building?"Building...":this.creatureTooExpensive(e)?s.formatWhole(this.creaturePrice(e)-c.model.persistentData.parts)+" parts required":"Build ("+s.formatWhole(this.creaturePrice(e))+" parts)"},creatureLevelButtonText:function(e){return this.canLevelCreature(e)?"Upgrade Level "+(e.level+1)+" ("+s.formatWhole(this.creatureLevelPrice(e))+" parts)":s.formatWhole(this.creatureLevelPrice(e)-c.model.persistentData.parts)+" parts required"},canBuildCreature:function(e){return!this.creatureTooExpensive(e)&&!e.building&&o.creaturesBuildingCount()+c.model.creatureCount<c.model.creatureLimit},canLevelCreature:function(e){return this.creatureLevelPrice(e)<c.model.persistentData.parts},levelCreature:function(e){o.levelCreature(e)},autoBuild:function(e,t){e.autobuild+t>=0&&e.autobuild+t<=c.model.creatureLimit&&o.creatureAutoBuildNumber(e,t)},creatureStats:function(e){return o.creatureStats(e)},updateDelays:function(){this.delays=[];for(var e=0;e<n.generatorsApplied.length;e++)this.delays[n.generatorsApplied[e].id]=(-1*(n.generatorsApplied[e].time-n.generatorsApplied[e].timeLeft)).toFixed(2)}},c.levelSelect={shown:!1,levelsPerPage:50,levels:[],levelRanges:[],start:1,showButton:function(){return c.model.persistentData.allTimeHighestLevel>1},show:function(){this.shown?this.shown=!1:(c.closeSidePanels(),this.shown=!0,this.level=c.model.levelInfo(c.model.level),this.start=Math.floor((this.level.level-1)/this.levelsPerPage)*this.levelsPerPage+1,this.populate())},populate:function(){this.levels=[],this.levelRanges=[],this.start>this.levelsPerPage&&this.levelRanges.push(this.start-this.levelsPerPage),this.levelRanges.push(this.start),this.start+this.levelsPerPage<=c.model.persistentData.allTimeHighestLevel+1&&this.levelRanges.push(this.start+this.levelsPerPage);for(var e=this.start;e<this.start+this.levelsPerPage;e++)this.levels.push(c.model.levelInfo(e))},selectRange:function(e){this.start=e,this.populate()},select:function(e){this.level=e},startLevel:function(){c.model.startLevel(this.level.level),this.shown=!1}},c.addToHomeScreen=function(){c.model.deferredPrompt},c.constructionPercent=function(){if(c.model.persistentData.currentConstruction){var e=c.model.persistentData.currentConstruction.time-c.model.persistentData.currentConstruction.timeRemaining;return Math.round(e/c.model.persistentData.currentConstruction.time*100)}return 0},c.updateConstructionUpgrades=function(){1==c.sidePanels.construction&&(c.upgrades=h.getAvailableConstructions())},c.startConstruction=function(e){h.startConstruction(e),c.upgrades=h.getAvailableConstructions()},c.playPauseConstruction=function(){h.playPauseConstruction()},c.cancelConstruction=function(){confirm("Are you sure you want to cancel construction? Used materials will not be refunded")&&(h.cancelConstruction(),c.upgrades=h.getAvailableConstructions())},c.upgradeSubtitle=function(e){switch(e.type){case h.types.energyRate:return"+"+e.effect+" energy per second";case h.types.energyCap:return"+"+e.effect+" max energy";case h.types.bloodCap:return"+"+s.formatWhole(e.effect)+" max blood";case h.types.bloodStoragePC:return"+"+Math.round(100*e.effect)+"% max blood";case h.types.bloodGainPC:return"+"+Math.round(100*e.effect)+"% blood income";case h.types.brainsGainPC:return"+"+Math.round(100*e.effect)+"% brains income";case h.types.bonesGainPC:return"+"+Math.round(100*e.effect)+"% bones income";case h.types.partsGainPC:return"+"+Math.round(100*e.effect)+"% parts income";case h.types.brainsStoragePC:return"+"+Math.round(100*e.effect)+"% max brains";case h.types.energyCost:return"-"+e.effect+" zombie energy cost";case h.types.brainsCap:return"+"+e.effect+" max brains";case h.types.damage:return"+"+e.effect+" zombie damage";case h.types.speed:return"+"+e.effect+" zombie speed";case h.types.health:return"+"+e.effect+" zombie health";case h.types.brainRecoverChance:return"+"+Math.round(100*e.effect)+"% chance to recover brain";case h.types.riseFromTheDeadChance:return"+"+Math.round(100*e.effect)+"% chance for corpse to become zombie";case h.types.infectedBite:return"+"+Math.round(100*e.effect)+"% chance for zombies to infect their targets";case h.types.infectedBlast:return"+"+Math.round(100*e.effect)+"% chance for zombies to explode on death";case h.types.boneCollectorCapacity:return"+"+e.effect+" bone collector capacity";case h.types.zombieDmgPC:return"+"+s.formatWhole(Math.round(100*e.effect))+"% zombie damage";case h.types.zombieHealthPC:return"+"+s.formatWhole(Math.round(100*e.effect))+"% zombie health";case h.types.bonesRate:return"+"+e.effect+" bones per second";case h.types.brainsRate:return"+"+e.effect+" brains per second";case h.types.plagueDamage:return"+"+s.formatWhole(e.effect)+" plague damage";case h.types.spitDistance:return"+"+e.effect+" spit distance";case h.types.blastHealing:return"+"+Math.round(100*e.effect)+"% plague healing";case h.types.plagueArmor:return"+"+Math.round(100*e.effect)+"% damage reduction";case h.types.monsterLimit:return"+"+e.effect+" creature limit";case h.types.runicSyphon:return"+"+Math.round(100*e.effect)+"% runic syphon";case h.types.gigazombies:return"Unlock more gigazombies";case h.types.bulletproof:return"+"+Math.round(100*e.effect)+"% earth golem bullet reflect";case h.types.harpySpeed:return"+"+e.effect+" harpy speed";case h.types.harpyBombs:return"+"+e.effect+" harpy bombs";case h.types.tankBuster:return"Anti tank harpies";case h.types.spikeDelay:return"-20% spike delay"}return""},c.currentRank=function(e){return c.sidePanels.factory?n.currentRank(e):h.currentRank(e)},c.currentRankConstruction=function(e){return h.currentRankConstruction(e)},c.upgradeTooExpensive=function(e){return c.sidePanels.factory?!n.canAffordGenerator(e):!h.canAffordUpgrade(e)||0!=e.cap&&h.currentRank(e)>=e.cap},c.requiredForUpgrade=function(e){var t=c.upgradePrice(e);switch(e.costType){case h.costs.energy:return s.formatWhole(t-c.model.energy)+" energy required";case h.costs.blood:case n.costs.blood:return s.formatWhole(t-c.model.persistentData.blood)+" blood required";case h.costs.brains:return s.formatWhole(t-c.model.persistentData.brains)+" brains required";case h.costs.bones:return s.formatWhole(t-c.model.persistentData.bones)+" bones required";case h.costs.prestigePoints:return s.formatWhole(t-c.model.persistentData.prestigePointsToSpend)+" prestige points required";case n.costs.parts:return s.formatWhole(t-c.model.persistentData.parts)+" parts required"}},c.purchaseText=function(e){if(c.keysPressed.shift){if(c.sidePanels.factory){var t=n.upgradeMaxAffordable(e),i=n.upgradeMaxPrice(e,t);return"Purchase "+t+" ("+s.formatWhole(i)+" "+c.costTranslate(e.costType)+")"}return t=h.upgradeMaxAffordable(e),i=h.upgradeMaxPrice(e,t),"Purchase "+t+" ("+s.formatWhole(i)+" "+c.costTranslate(e.costType)+")"}return"Purchase ("+s.formatWhole(c.upgradePrice(e))+" "+c.costTranslate(e.costType)+")"},c.costTranslate=function(e){return e==h.costs.prestigePoints?"points":e},c.buyUpgrade=function(e){c.keysPressed.shift?h.purchaseMaxUpgrades(e):h.purchaseUpgrade(e)},c.upgradeStatInfo=function(e){return h.displayStatValue(e)},c.startGame=function(){c.model.startGame()},c.nextLevel=function(){c.model.nextLevel()},c.toggleAutoStart=function(){c.model.persistentData.autoStart?c.model.persistentData.autoStart=!1:c.model.persistentData.autoStart=!0},c.toggleResolution=function(e){c.model.persistentData.resolution=e,c.model.setResolution(c.model.persistentData.resolution)},c.getResolution=function(){return c.model.persistentData.resolution||1},c.toggleZoomButtons=function(){c.model.persistentData.zoomButtons=!c.model.persistentData.zoomButtons},c.zoom=function(e){c.model.zoom(e)},c.resetZoom=function(){c.model.centerGameContainer(!0)},c.toggleShowFps=function(){c.model.persistentData.showfps=!c.model.persistentData.showfps},c.toggleParticles=function(){c.model.persistentData.particles=!c.model.persistentData.particles},c.isShowPrestige=function(){return void 0!==c.model.persistentData.prestigePointsEarned&&c.model.persistentData.allTimeHighestLevel>5},c.doPrestige=function(){confirm("Are you sure?")&&c.model.prestige()},c.constructionLeadsTo=function(e){return h.constructionLeadsTo(e)},c.howToPlay=["Energy refills over time. You need 10 energy to spawn a zombie by clicking on the ground.","Hold shift or control to spawn multiple zombies with a single click.","Whenever one of your zombies attacks a human you will collect some blood.","Killing a human or turning them into a zombie will earn you 1 brain.","You can spend these currencies in the shop to purchase upgrades for your zombie horde.","Hold shift to buy the maximum affordable number of upgrades.","The world can be dragged with the mouse to explore it. Or by using the WASD or arrow keys.","You can zoom in and out using your mouse wheel. Pinch to zoom on mobile."],c.updateMessages=function(e){c.message?(c.messageTimer-=e,c.model.messageQueue.length>0&&(c.messageTimer-=e),c.messageTimer<0&&(c.message=!1,c.messageTimer=4)):c.model.messageQueue.length>0&&(c.message=c.model.messageQueue.shift(),c.messageTimer=4)},c.infusionAmount=1e3,c.infusionMax=!1,c.infuseRune=function(e,t){if(c.infusionMax)switch(t){case"blood":h.infuseRune(e,t,c.model.persistentData.blood);break;case"brains":h.infuseRune(e,t,c.model.persistentData.brains);break;case"bones":h.infuseRune(e,t,c.model.persistentData.bones)}else h.infuseRune(e,t,c.infusionAmount)},c.shatterPercent=function(e){return h.shatterPercent(e)},c.shatterBloodCost=function(e){return h.shatterBloodCost(e)},c.shatterSatiate=function(e,t){h.infuseRune(e,"blood",this.shatterBloodCost(t))},c.canShatter=function(){return h.canShatter()},c.doShatter=function(){h.doShatter()},c.shatterEffect=function(){return 100*h.shatterEffect()},c.infuseButtonText=function(){return c.infusionMax?"Max":s.formatWhole(c.infusionAmount)},c.energyPercent=function(){return Math.min(Math.round(c.model.energy/c.model.energyMax*100),100)},c.bloodPercent=function(){return Math.min(Math.round(c.model.persistentData.blood/c.model.bloodMax*100),100)},c.brainsPercent=function(){return Math.min(Math.round(c.model.persistentData.brains/c.model.brainsMax*100),100)},c.costAboveCap=function(e,t){switch(e.costType){case"blood":if(t>c.model.bloodMax)return"Blood capacity too low";break;case"brains":if(t>c.model.brainsMax)return"Brains capacity too low"}return!1},c.upgradeButtonText=function(e){if(0!=e.cap&&c.currentRank(e)>=e.cap)return"Sold Out";var t=c.upgradePrice(e);return c.upgradeTooExpensive(e)?c.costAboveCap(e,t)||c.requiredForUpgrade(e):c.purchaseText(e,t)},c.upgradePercent=function(e){switch(e.costType){case"blood":return Math.round(100*Math.min(1,c.model.persistentData.blood/c.upgradePrice(e)));case"brains":return Math.round(100*Math.min(1,c.model.persistentData.brains/c.upgradePrice(e)));case"bones":return Math.round(100*Math.min(1,c.model.persistentData.bones/c.upgradePrice(e)));case"parts":return Math.round(100*Math.min(1,c.model.persistentData.parts/c.upgradePrice(e)));case"prestigePoints":return Math.round(100*Math.min(1,c.model.persistentData.prestigePointsToSpend/c.upgradePrice(e)))}},c.skeletonTimer=function(){return a.skeletonTimer()},c.skeletonMenu={isShown:!1,equipped:[],show:function(){this.isShown=!this.isShown,this.isShown&&(this.updateEquippedItems(),setTimeout((function(){for(var e=document.getElementsByClassName("item legendary"),t=0;t<e.length;t++);}),100))},acceptOffer:function(){a.acceptOffer(),this.isShown=!1},anotherOffer:function(){return a.persistent.skeletons>0&&c.model.persistentData.trophies.length>=20*a.persistent.xpRate},xpPercent:function(){return Math.round(100*Math.min(1,c.skeleton().xp/a.xpForNextLevel()))},xpForNextLevel:function(){return a.xpForNextLevel()},xpRate:function(){return 100*a.persistent.xpRate},isAlive:function(){return a.isAlive()},timer:function(){return Math.ceil(a.skeletonTimer())},updateEquippedItems:function(){this.equipped=[];var e=a.persistent.items.filter((function(e){return e.q&&e.s==a.lootPositions.helmet.id}));e.length>0?this.equipped.push([e[0]]):this.equipped.push([{name:"Helmet Slot",s:a.lootPositions.helmet.id,id:-1}]);var t=[],i=a.persistent.items.filter((function(e){return e.q&&e.s==a.lootPositions.sword.id}));i.length>0?t.push(i[0]):t.push({name:"Sword Slot",s:a.lootPositions.sword.id,id:-2});var s=a.persistent.items.filter((function(e){return e.q&&e.s==a.lootPositions.chest.id}));s.length>0?t.push(s[0]):t.push({name:"Chest Slot",s:a.lootPositions.chest.id,id:-3});var r=a.persistent.items.filter((function(e){return e.q&&e.s==a.lootPositions.shield.id}));r.length>0?t.push(r[0]):t.push({name:"Shield Slot",s:a.lootPositions.shield.id,id:-4}),this.equipped.push(t);var n=[],o=a.persistent.items.filter((function(e){return e.q&&e.s==a.lootPositions.gloves.id}));o.length>0?n.push(o[0]):n.push({name:"Gloves Slot",s:a.lootPositions.gloves.id,id:-5});var h=a.persistent.items.filter((function(e){return e.q&&e.s==a.lootPositions.legs.id}));h.length>0?n.push(h[0]):n.push({name:"Legs Slot",s:a.lootPositions.legs.id,id:-6});var l=a.persistent.items.filter((function(e){return e.q&&e.s==a.lootPositions.boots.id}));l.length>0?n.push(l[0]):n.push({name:"Boots Slot",s:a.lootPositions.boots.id,id:-7}),this.equipped.push(n),this.equipped.push([{name:"Destroy Items",s:-1,id:-8}])},inventoryItems:function(){return a.persistent.items.filter((function(e){return!e.q})).sort((function(e,t){return t.r*t.l-e.r*e.l}))},itemName:function(e){return e.name||a.getLootName(e)},itemSubName:function(e){if(!e.name)switch(e.r){case a.rarity.common:return"Common level "+e.l+" "+this.itemType(e);case a.rarity.rare:return"Rare level "+e.l+" "+this.itemType(e);case a.rarity.epic:return"Epic level "+e.l+" "+this.itemType(e);case a.rarity.legendary:return"Legendary level "+e.l+" "+this.itemType(e)}if(-1==e.s)return"Click this to destroy all non-equipped items. Or drag items here to destroy them."},itemStats:function(e){return a.getLootStats(e)},itemEffects:function(e){return a.getSpecialEffects(e)},itemType:function(e){switch(e.s){case-1:return"trash";case a.lootPositions.helmet.id:return"helmet";case a.lootPositions.chest.id:return"chest";case a.lootPositions.gloves.id:return"gloves";case a.lootPositions.legs.id:return"legs";case a.lootPositions.boots.id:return"boots";case a.lootPositions.sword.id:return"sword";case a.lootPositions.shield.id:return"shield"}},itemClass:function(e){return e.name?"empty":a.getLootClass(e)},itemById:function(e){var t=null;return a.persistent.items.forEach((function(i){i.id==e&&(t=i)})),t},itemDropped:function(e,t){var i=null;a.persistent.items.forEach((function(t){t.id==e&&(i=t)})),-1==t?a.destroyItem(i):(i.s==t&&(a.persistent.items.forEach((function(e){e.s==t&&(e.q=!1)})),i.q=!0,h.applyUpgrades()),this.updateEquippedItems())},equipItem:function(e){a.persistent.items.forEach((function(t){t.s==e.s&&(t.q=!1)})),e.q=!0,h.applyUpgrades(),this.updateEquippedItems()},trashAll:function(){confirm("Are you sure you want to destroy all non-equipped items? You will earn "+s.formatWhole(a.xpForItems())+" xp")&&a.destroyAllItems()}},i.ready((function(){e.updatePromise=t(d,200),h.angularModel=c}))}]).directive("levelSelect",(function(){return{templateUrl:"./templates/levelselect.html"}})).directive("levelStats",(function(){return{templateUrl:"./templates/levelstats.html"}})).directive("graveyardMenu",(function(){return{templateUrl:"./templates/graveyardmenu.html"}})).directive("runesmithMenu",(function(){return{templateUrl:"./templates/runesmithmenu.html"}})).directive("optionsMenu",(function(){return{templateUrl:"./templates/optionsmenu.html"}})).directive("shopMenu",(function(){return{templateUrl:"./templates/shopmenu.html"}})).directive("constructionMenu",(function(){return{templateUrl:"./templates/constructionmenu.html"}})).directive("prestigeMenu",(function(){return{templateUrl:"./templates/prestigemenu.html"}})).directive("championsHoldMenu",(function(){return{templateUrl:"./templates/championshold.html"}})).directive("factoryMenu",(function(){return{templateUrl:"./templates/factorymenu.html"}})).directive("customOnChange",(function(){return{restrict:"A",link:function(e,t,i){var s=e.$eval(i.customOnChange);t.on("change",s),t.on("$destroy",(function(){t.off()}))}}})).directive("draggableItem",["$rootScope",function(e){return{restrict:"A",link:function(t,i,s,a){var r=t.item.id;"true"==s.draggableItem&&(angular.element(i).attr("draggable","true"),i.bind("dragstart",(function(t){document.getElementById("champ-hold").classList.toggle("no-tooltip"),t.dataTransfer.setData("text",r);var s=i[0].getBoundingClientRect();t.dataTransfer.setDragImage(i[0],s.width/2,s.height/2),e.$emit("item-drag-start",r),setTimeout((function(){angular.element(i)[0].style.opacity="0.3"}))})),i.bind("dragend",(function(t){document.getElementById("champ-hold").classList.toggle("no-tooltip"),angular.element(i)[0].style.opacity="",e.$emit("item-drag-end",r)})))}}}]).directive("droppableTarget",["$rootScope",function(e){return{restrict:"A",link:function(t,i,s,a){var r=t.item.s;i.bind("dragover",(function(e){return e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move",!1})),i.bind("dragenter",(function(e){e.target&&e.target.classList&&e.target.classList.contains("icon")&&angular.element(e.target.parentElement).addClass("over")})),i.bind("dragleave",(function(e){e.target&&e.target.classList&&e.target.classList.contains("icon")&&angular.element(e.target.parentElement).removeClass("over")})),i.bind("drop",(function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.target.classList.contains("icon")&&angular.element(e.target.parentElement).removeClass("over");var i=e.dataTransfer.getData("text"),s=t.zm.skeletonMenu.itemById(i);if(s){var a=t.zm.skeletonMenu.itemType(s);document.getElementsByClassName("equipped")[0].classList.remove(a)}t.zm.skeletonMenu.itemDropped(i,r)})),e.$on("item-drag-start",(function(e,i){var s=t.zm.skeletonMenu.itemById(i);if(s){var a=t.zm.skeletonMenu.itemType(s);document.getElementsByClassName("equipped")[0].classList.add(a)}})),e.$on("item-drag-end",(function(e,i){var s=t.zm.skeletonMenu.itemById(i);if(s){var a=t.zm.skeletonMenu.itemType(s);document.getElementsByClassName("equipped")[0].classList.remove(a)}}))}}}])},84:function(e,t,i){var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Fragments=t.Smoke=t.Blasts=t.Bullets=t.Exclamations=t.Bones=t.Blood=t.PrestigePoints=t.Particles=void 0;var r=i(841),n=i(838),o=function(){function e(){if(this.blood=new l,this.smoke=new y,this.prestigePoints=new h,this.bullets=new m,this.exclamations=new p,this.blasts=new f,this.fragments=new v,e.instance)return e.instance;e.instance=this}return e.prototype.initialize=function(){this.blood.initialize(),this.bullets.initialize(),this.exclamations.initialize(),this.blasts.initialize(),this.smoke.initialize(),this.fragments.initialize(),this.prestigePoints.initialize()},e.prototype.update=function(e){this.blood.update(e),this.bullets.update(e),this.exclamations.update(e),this.blasts.update(e),this.smoke.update(e),this.fragments.update(e),this.prestigePoints.update(e)},e}();t.Particles=o;var h=function(e){function t(){var i=e.call(this)||this;return i.zmMap=new n.ZmMap,i.speed=20,t.instance?t.instance:(t.instance=i,i.create=function(e){return new r.GameObject(e)},i)}return a(t,e),t.prototype.initialize=function(){this.gameModel=n.GameModel.getInstance(),this.container||(this.setup(new PIXI.Container,PIXI.Texture.from("pp.png")),n.foregroundContainer.addChild(this.container)),this.targetElement=document.getElementById("prestige-button"),this.animElement=document.getElementById("prestige-bg")},t.prototype.update=function(e){if(this.gameModel.persistentData.particles){this.container.visible=!0;var t={x:0,y:0};if(null!=this.targetElement){var i=this.targetElement.getBoundingClientRect();(t={x:i.x+i.width/2,y:i.y+i.height/2}).x-=n.gameContainer.x,t.y-=n.gameContainer.y,t.x=t.x/n.gameContainer.scale.x,t.y=t.y/n.gameContainer.scale.y}for(var s=0;s<this.sprites.length;s++)this.sprites[s].visible&&this.updatePart(this.sprites[s],e,t)}else this.container.visible=!1},t.prototype.updatePart=function(e,t,i){var s=this.zmMap.normalizeVector({x:i.x-e.x,y:i.y-e.y}),a=300*s.x-e.xSpeed,r=300*s.y-e.ySpeed;if(e.xSpeed+=a*t,e.ySpeed+=r*t,e.x+=e.xSpeed*t,e.y+=e.ySpeed*t,n.fastDistance(e.x,e.y,i.x,i.y)<30&&(e.visible=!1,e.x=100,e.y=100,this.animElement)){var o=this.animElement;o.classList.toggle("levelup"),setTimeout((function(){o.classList.toggle("levelup")}),3e3)}},t.prototype.newPart=function(e,t){if(this.container.visible){var i=this.getSprite();i.x=e,i.y=t-10,i.visible=!0,i.scale.set(2,2),i.xSpeed=0,i.ySpeed=-100}},t}(r.SpritePool);t.PrestigePoints=h;var l=function(){function e(){if(this.maxParts=500,this.partCounter=0,this.partsPerSplatter=6,this.ecoPartsPerSplatter=3,this.container=null,this.sprites=[],this.gravity=100,this.spraySpeed=20,this.fadeSpeed=.7,this.visibleParts=0,this.viewableArea=null,e.instance)return e.instance;e.instance=this}return e.prototype.getTexture=function(e){var t=document.createElement("canvas");t.width=1,t.height=1;var i=t.getContext("2d");return i.fillStyle=e,i.fillRect(0,0,1,1),PIXI.Texture.from(t)},e.prototype.initialize=function(){if(this.gameModel=n.GameModel.getInstance(),this.viewableArea=n.viewableArea,this.container||(this.container=new PIXI.Container,n.backgroundSpriteContainer.addChild(this.container),this.texture=this.getTexture("#ff0000"),this.plagueTexture=this.getTexture("#00ff00")),this.sprites.length<this.maxParts)for(var e=0;e<this.maxParts;e++){var t=new b(this.texture);this.sprites.push(t),t.visible=!1,Math.random()>.5&&t.scale.set(2,2),this.container.addChild(t)}},e.prototype.update=function(e){if(this.gameModel.persistentData.particles){this.container.visible=!0,this.visibleParts=0;for(var t=0;t<this.sprites.length;t++)this.sprites[t].visible&&(this.updatePart(this.sprites[t],e),this.visibleParts++)}else this.container.visible=!1},e.prototype.updatePart=function(e,t){e.hitFloor?(e.alpha-=this.fadeSpeed*t,e.alpha<=0&&(e.visible=!1)):(e.ySpeed+=this.gravity*t,e.x+=e.xSpeed*t,e.y+=e.ySpeed*t,e.y>=e.floor&&(e.hitFloor=!0))},e.prototype.newPart=function(e,t,i){if(!this.viewableArea.hideParticle(e,t)){var s=this.sprites[this.partCounter++];this.partCounter>=this.maxParts&&(this.partCounter=0),s.texture=i?this.plagueTexture:this.texture,s.x=e,s.y=t-(8+10*Math.random()),s.floor=t,s.hitFloor=!1,s.visible=!0,s.alpha=1,s.scale.set(1,1),Math.random()>.5&&s.scale.set(2,2);var a=Math.random()*(i?1.5*this.spraySpeed:this.spraySpeed);s.xSpeed=Math.random()>.5?-1*a:a,s.ySpeed=-1*(i?1.5*this.spraySpeed:this.spraySpeed)}},e.prototype.newSplatter=function(e,t){if(this.container.visible)if(this.visibleParts<.9*this.maxParts)for(var i=0;i<this.partsPerSplatter;i++)this.newPart(e,t,!1);else for(i=0;i<this.ecoPartsPerSplatter;i++)this.newPart(e,t,!1)},e.prototype.newPlagueSplatter=function(e,t){if(this.container.visible)for(var i=0;i<this.partsPerSplatter;i++)this.newPart(e,t,!0)},e}();t.Blood=l;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fadeTime=0,t.floor=0,t.rotSpeed=0,t.collector=null,t.hitFloor=!1,t.collected=!1,t}return a(t,e),t}(r.GameObject),d=function(){function e(){if(this.maxParts=100,this.partsPerSplatter=3,this.container=null,this.sprites=[],this.discardedSprites=[],this.uncollected=[],this.gravity=100,this.spraySpeed=20,this.fadeTime=40,this.fadeSpeed=.2,this.fadeBones=!1,this.texture=null,this.gameModel=null,e.instance)return e.instance;e.instance=this}return e.prototype.getTexture=function(){var e=document.createElement("canvas");e.width=4,e.height=1;var t=e.getContext("2d");return t.fillStyle="#dddddd",t.fillRect(0,0,4,1),PIXI.Texture.from(e)},e.prototype.initialize=function(){this.gameModel=n.GameModel.getInstance(),this.container||(this.container=new PIXI.Container,n.backgroundSpriteContainer.addChild(this.container),this.texture=this.getTexture());for(var e=0;e<this.sprites.length;e++)this.sprites[e].collected=!0,this.sprites[e].visible=!1,this.container.removeChild(this.sprites[e]);if(this.sprites.length<this.maxParts)for(e=0;e<this.maxParts;e++){var t=new c(this.texture);t.visible=!1,this.sprites.push(t)}this.discardedSprites=this.sprites.slice()},e.prototype.update=function(e){for(var t=[],i=0;i<this.sprites.length;i++)this.sprites[i].visible&&(this.updatePart(this.sprites[i],e),t.push(this.sprites[i]));this.uncollected=t,this.fadeBones=t.length>200},e.prototype.updatePart=function(e,t){if(e.collected)return e.visible=!1,this.discardedSprites.push(e),void this.container.removeChild(e);e.hitFloor?(this.fadeBones&&(e.fadeTime-=t),e.fadeTime<0&&!e.collector&&(e.alpha-=this.fadeSpeed*t,e.alpha<=0&&(e.visible=!1,this.discardedSprites.push(e),this.container.removeChild(e)))):(e.ySpeed+=this.gravity*t,e.rotation+=e.rotSpeed*t,e.x+=e.xSpeed*t,e.y+=e.ySpeed*t,e.y>=e.floor&&(e.hitFloor=!0))},e.prototype.newPart=function(e,t){var i=null;this.discardedSprites.length>0?i=this.discardedSprites.pop():(i=new PIXI.Sprite(this.texture),this.sprites.push(i)),this.container.addChild(i),i.x=e,i.y=t-(8+10*Math.random()),i.fadeTime=Math.random()*this.fadeTime,i.rotation=5*Math.random(),i.rotSpeed=4*Math.random()-2,i.floor=t,i.hitFloor=!1,i.collected=!1,i.collector=!1,i.visible=!0,i.alpha=1,i.scale={x:1,y:1},Math.random()>.5&&(i.scale={x:1.5,y:1.5});var s=Math.random()*this.spraySpeed;i.xSpeed=Math.random()>.5?-1*s:s,i.ySpeed=-1*this.spraySpeed},e.prototype.newBones=function(e,t){if(this.gameModel.constructions.graveyard)for(var i=0;i<this.partsPerSplatter;i++)this.newPart(e,t)},e}();t.Bones=d;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.time=0,t.target=null,t}return a(t,e),t}(PIXI.Sprite),p=function(){function e(){if(this.sprites=[],this.discardedSprites=[],this.maxSprites=10,this.height=20,this.fadeSpeed=4,e.instance)return e.instance;e.instance=this}return e.prototype.initialize=function(){this.container||(this.container=new PIXI.Container,n.foregroundContainer.addChild(this.container),this.healTexture=PIXI.Texture.from("healing.png"),this.exclamationTexture=PIXI.Texture.from("exclamation.png"),this.radioTexture=PIXI.Texture.from("radio.png"),this.fireTexture=PIXI.Texture.from("fire.png"),this.shieldTexture=PIXI.Texture.from("shield.png"),this.poisonTexture=PIXI.Texture.from("poison.png"));for(var e=0;e<this.sprites.length;e++)this.container.removeChild(this.sprites[e]);if(this.sprites.length<this.maxSprites)for(e=0;e<this.maxSprites;e++){var t=new u(this.exclamationTexture);t.anchor.set(.5,1),this.sprites.push(t),t.visible=!1}this.discardedSprites=this.sprites.slice()},e.prototype.newIcon=function(e,t,i){var s;e.hasIcon||(this.discardedSprites.length>0?s=this.discardedSprites.pop():((s=new u(this.exclamationTexture)).anchor.set(.5,1),this.sprites.push(s)),this.container.addChild(s),s.texture=t,s.target=e,s.target.hasIcon=!0,s.x=e.x,s.y=e.y-this.height,s.visible=!0,s.time=i,s.alpha=1,s.scale.set(1.5,1.5))},e.prototype.newHealing=function(e){this.newIcon(e,this.healTexture,1)},e.prototype.newExclamation=function(e){this.newIcon(e,this.exclamationTexture,2)},e.prototype.newRadio=function(e){this.newIcon(e,this.radioTexture,3)},e.prototype.newFire=function(e){this.newIcon(e,this.fireTexture,1)},e.prototype.newShield=function(e){this.newIcon(e,this.shieldTexture,1)},e.prototype.newPoison=function(e){this.newIcon(e,this.poisonTexture,1)},e.prototype.update=function(e){for(var t=0;t<this.sprites.length;t++)this.sprites[t].visible&&this.updateSprite(this.sprites[t],e)},e.prototype.updateSprite=function(e,t){e.x=e.target.x,e.y=e.target.y-this.height,e.time-=t,e.time<0&&(e.alpha-=t*this.fadeSpeed,e.alpha<0&&(e.visible=!1,e.target.hasIcon=!1,this.discardedSprites.push(e)))},e}();t.Exclamations=p;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.plague=!1,t.rocket=!1,t.fireball=!1,t.target=null,t.source=null,t.hitbox=0,t.damage=0,t}return a(t,e),t}(r.GameObject),m=function(){function e(){if(this.zombies=new n.Zombies,this.humans=new n.Humans,this.graveyard=new n.Graveyard,this.army=new n.Army,this.maxParts=20,this.speed=150,this.hitbox=12,this.sprites=[],this.discardedSprites=[],this.fadeSpeed=.2,e.instance)return e.instance;e.instance=this}return e.prototype.getTexture=function(){var e=document.createElement("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="#ffffff",t.fillRect(0,0,1,1),PIXI.Texture.from(e)},e.prototype.getFireballTexture=function(){var e=document.createElement("canvas");e.width=8,e.height=8;var t=e.getContext("2d"),i=t.createRadialGradient(4,4,0,4,4,4);return i.addColorStop(0,"rgba(255,255,0,1)"),i.addColorStop(.8,"rgba(255,0,0,0.2)"),i.addColorStop(1,"rgba(255,0,0,0)"),t.fillStyle=i,t.fillRect(0,0,8,8),PIXI.Texture.from(e)},e.prototype.initialize=function(){this.texture||(this.texture=this.getTexture(),this.fireballTexture=this.getFireballTexture());for(var e=0;e<this.sprites.length;e++)n.characterContainer.removeChild(this.sprites[e]);if(this.sprites.length<this.maxParts)for(e=0;e<this.maxParts;e++){var t=new g(this.texture);t.scale.x=t.scale.y=2,t.visible=!1,this.sprites.push(t)}this.discardedSprites=this.sprites.slice()},e.prototype.update=function(e){for(var t=0;t<this.sprites.length;t++)this.sprites[t].visible&&this.updatePart(this.sprites[t],e)},e.prototype.updatePart=function(e,t){n.fastDistance(e.x,e.y+8,e.target.x,e.target.y)<e.hitbox?(e.plague?(this.zombies.inflictPlague(e.target),this.humans.damageHuman(e.target,e.damage)):e.fireball?(this.humans.burnHuman(e.target,e.damage),this.humans.damageHuman(e.target,e.damage)):!e.rocket&&e.target.bulletReflect&&Math.random()<e.target.bulletReflect?this.newBullet(e.target,e.source,e.damage,!1,!1,!1):e.rocket?(e.target.graveyard&&this.graveyard.damageGraveyard(e.damage),this.army.droneExplosion(e.target.x,e.target.y,null,e.damage)):(e.target.zombie&&this.zombies.damageZombie(e.target,e.damage,e.source),e.target.human&&this.humans.damageHuman(e.target,e.damage)),e.visible=!1,this.discardedSprites.push(e),n.characterContainer.removeChild(e)):(e.x+=e.xSpeed*t,e.y+=e.ySpeed*t,e.zIndex=e.y),e.alpha-=this.fadeSpeed*t,e.alpha<0&&(e.visible=!1,this.discardedSprites.push(e),n.characterContainer.removeChild(e))},e.prototype.newBullet=function(e,t,i,s,a,r){var o;void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===r&&(r=!1),this.discardedSprites.length>0?o=this.discardedSprites.pop():((o=new g(this.texture)).scale.x=o.scale.y=2,this.sprites.push(o)),n.characterContainer.addChild(o),o.texture=r?this.fireballTexture:this.texture,o.source=e,o.x=e.x,o.y=e.y-8,s&&(o.y=e.y-12),o.target=t,o.damage=i,o.visible=!0,o.alpha=1,o.hitbox=a?1.5*this.hitbox:this.hitbox,o.plague=s,o.rocket=a,o.fireball=r,o.tint=s?65280:a?16772096:16777215,o.scale.x=o.scale.y=a?2.5:2,r&&(o.scale.x=o.scale.y=1.5);var h=t.x-o.x,l=t.y-8-o.y,c=Math.abs(h),d=Math.abs(l),u=1/Math.max(c,d);u*=1.29289-(c+d)*u*.29289,o.xSpeed=h*u*this.speed,o.ySpeed=l*u*this.speed,o.rotation=Math.atan2(o.ySpeed,o.xSpeed)},e}();t.Bullets=m;var f=function(e){function t(){var i=e.call(this)||this;return i.viewableArea=null,t.instance?t.instance:(t.instance=i,i.create=function(e){return new r.GameObject(e)},i)}return a(t,e),t.prototype.getTexture=function(){var e=document.createElement("canvas");e.width=32,e.height=32;var t=e.getContext("2d"),i=t.createRadialGradient(16,16,0,16,16,16);return i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(.8,"rgba(255,255,128,0.2)"),i.addColorStop(1,"rgba(255,180,0,0)"),t.fillStyle=i,t.fillRect(0,0,32,32),PIXI.Texture.from(e)},t.prototype.initialize=function(){this.viewableArea=n.viewableArea,this.texture||(this.texture=this.getTexture(),this.container=new PIXI.Container,n.foregroundContainer.addChild(this.container),this.setup(this.container,this.texture))},t.prototype.update=function(e){for(var t=0;t<this.sprites.length;t++)this.sprites[t].visible&&this.updatePart(this.sprites[t],e)},t.prototype.updatePart=function(e,t){e.visible&&(e.scale.y-=10*t,e.scale.x=e.scale.y,e.scale.x<=0&&this.discardSprite(e))},t.prototype.newBlast=function(e,t){if(!this.viewableArea.hideParticle(e,t)){var i=this.getSprite();i.anchor.set(.5,.5),i.scale.x=i.scale.y=2,i.x=e,i.y=t,(new y).newCloud(e,t)}},t.prototype.newDroneBlast=function(e,t){var i=this.getSprite();i.scale.x=i.scale.y=2,i.x=e,i.y=t,(new y).newDroneCloud(e,t)},t}(r.SpritePool);t.Blasts=f;var y=function(e){function t(){var i=e.call(this)||this;return i.tint=16777215,i.viewableArea=null,i.allowTint=!1,i.gameModel=null,i.sizeVariance=.2,t.instance?t.instance:(t.instance=i,i.create=function(e){return new r.GameObject(e)},i)}return a(t,e),t.prototype.getTexture=function(){var e=document.createElement("canvas");e.width=12,e.height=12;var t=e.getContext("2d");t.shadowBlur=5,t.shadowColor="white";var i=t.createRadialGradient(6,6,0,6,6,4);return i.addColorStop(0,"rgba(255,255,255,0.05)"),i.addColorStop(.5,"rgba(255,255,255,0.1)"),i.addColorStop(1,"rgba(255,255,255,0)"),t.fillStyle=i,t.fillRect(0,0,12,12),PIXI.Texture.from(e)},t.prototype.initialize=function(){this.gameModel=n.GameModel.getInstance(),this.viewableArea=n.viewableArea,this.allowTint=this.gameModel.app&&this.gameModel.app.renderer&&1==this.gameModel.app.renderer.type,this.texture||(this.setup(new PIXI.Container,this.getTexture()),n.foregroundContainer.addChild(this.container))},t.prototype.update=function(e){if(this.gameModel.persistentData.particles){this.container.visible=!0;for(var t=0;t<this.sprites.length;t++)this.sprites[t].visible&&this.updatePart(this.sprites[t],e)}else this.container.visible=!1},t.prototype.updatePart=function(e,t){e.scale.y-=1.5*t,e.scale.x=e.scale.y,e.y+=e.ySpeed,e.scale.x<=0&&this.discardSprite(e)},t.prototype.newSmoke=function(e,t,i){if(void 0===i&&(i=0),!this.viewableArea.hideParticle(e,t)){var s=this.getSprite();this.allowTint&&(s.tint=this.tint),s.ySpeed=-.5,s.anchor.set(.5,.5),s.scale.x=s.scale.y=1.6-this.sizeVariance+Math.random()*this.sizeVariance*2,s.visible=!0,s.x=e-i+Math.random()*i*2,s.y=t-i+Math.random()*i*2}},t.prototype.newFireSmoke=function(e,t){this.container.visible&&(this.tint=16777215,this.newSmoke(e,t,3))},t.prototype.newCloud=function(e,t){if(this.container.visible){this.tint=65280;for(var i=0;i<10;i++)this.newSmoke(e,t,16)}},t.prototype.newDroneCloud=function(e,t){if(this.container.visible){this.tint=16777215;for(var i=0;i<10;i++)this.newSmoke(e,t,24)}},t.prototype.newZombieSpawnCloud=function(e,t){if(this.container.visible){this.tint=65280;for(var i=0;i<5;i++)this.newSmoke(e,t,6)}},t}(r.SpritePool);t.Smoke=y;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hitFloor=!1,t}return a(t,e),t}(r.GameObject),v=function(e){function t(){var i=e.call(this)||this;return i.partsPerSplatter=15,i.gravity=100,i.spraySpeed=50,i.fadeSpeed=.7,i.viewableArea=n.viewableArea,t.instance?t.instance:(t.instance=i,i.create=function(e){return new b(e)},i)}return a(t,e),t.prototype.getTexture=function(){var e=document.createElement("canvas");e.width=5,e.height=1;var t=e.getContext("2d");return t.fillStyle="#FFFFFF",t.fillRect(0,0,5,1),PIXI.Texture.from(e)},t.prototype.initialize=function(){this.gameModel=n.GameModel.getInstance(),this.viewableArea=n.viewableArea,this.container||(this.container=new PIXI.Container,n.backgroundSpriteContainer.addChild(this.container),this.texture=this.getTexture(),this.setup(this.container,this.texture))},t.prototype.update=function(e){if(this.gameModel.persistentData.particles){this.container.visible=!0;for(var t=0;t<this.sprites.length;t++)this.sprites[t].visible&&this.updatePart(this.sprites[t],e)}else this.container.visible=!1},t.prototype.updatePart=function(e,t){e.hitFloor?(e.alpha-=this.fadeSpeed*t,e.alpha<=0&&this.discardSprite(e)):(e.ySpeed+=this.gravity*t,e.x+=e.xSpeed*t,e.y+=e.ySpeed*t,e.y>=e.floor&&(e.hitFloor=!0),e.rotation+=e.rotSpeed*t)},t.prototype.newPart=function(e,t,i){if(this.container.visible&&!this.viewableArea.hideParticle(e,t)){var s=this.getSprite();s.tint=i,s.x=e,s.y=t-(8+10*Math.random()),s.floor=t,s.hitFloor=!1,s.rotation=5*Math.random(),s.rotSpeed=4*Math.random()-2,s.alpha=1,s.scale.set(2,2);var a=Math.random()*this.spraySpeed;s.xSpeed=Math.random()>.5?-1*a:a,s.ySpeed=-1*(10+Math.random()*this.spraySpeed)}},t.prototype.newFragmentExplosion=function(e,t,i){if(this.container.visible)for(var s=0;s<this.partsPerSplatter;s++)this.newPart(e,t,i)},t}(r.SpritePool);t.Fragments=v},5:function(e,t,i){var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.CreatureState=t.Creature=void 0;var r,n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentDirection=0,t.bulletReflect=0,t.zombieId=0,t.lastKnownBuilding=null,t.maxSpeed=0,t.graveyard=!1,t.regenTimer=0,t.level=0,t.creatureType=0,t.scaling=0,t.attackDamage=0,t.speedMultiplier=1,t.immuneToBurns=!1,t.zombie=!0,t.textureSet={set:!1,down:[],up:[],left:[],right:[],dead:[]},t}return a(t,e),t}(i(841).CharacterObject);t.Creature=n,(r=t.CreatureState||(t.CreatureState={}))[r.lookingForTarget=0]="lookingForTarget",r[r.movingToTarget=1]="movingToTarget",r[r.attackingTarget=2]="attackingTarget"},841:function(e,t){var i,s=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpritePool=t.GameObject=t.CharacterObject=t.CharacterFlags=t.CharacterTimers=t.Building=t.Wall=void 0;var a=function(e){function t(t){var i=e.call(this,t)||this;return i.collisionX=0,i.collisionY=0,i.collisionWidth=0,i.collisionHeight=0,i}return s(t,e),t}(PIXI.TilingSprite);t.Wall=a;t.Building=function(e,t,i,s,a){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.entrance=null,this.id=e,this.x=t,this.y=i,this.width=s,this.height=a};var r=function(){this.attack=0,this.scan=0,this.smoke=0,this.burnTick=0,this.ability=0,this.dogStun=0,this.target=0};t.CharacterTimers=r;var n=function(){this.burning=!1,this.infected=!1,this.dead=!1};t.CharacterFlags=n;var o=function(e){function t(t){var i=e.call(this,t)||this;return i.xSpeed=0,i.ySpeed=0,i.health=0,i.maxHealth=0,i.zombie=!1,i.targetVector={x:0,y:0},i.burnDamage=0,i.hasIcon=!1,i.flags=new n,i.timer=new r,i}return s(t,e),t.prototype.reset=function(){this.xSpeed=0,this.ySpeed=0,this.alpha=1,this.visible=!0,this.burnDamage=0,this.currentPoi=null,this.flags.dead=!1,this.flags.burning=!1,this.flags.infected=!1},t}(PIXI.AnimatedSprite);t.CharacterObject=o;var h=function(e){function t(t){var i=e.call(this,t)||this;return i.xSpeed=0,i.ySpeed=0,i}return s(t,e),t}(PIXI.Sprite);t.GameObject=h;var l=function(){function e(){this.sprites=[],this.discardedSprites=[]}return e.prototype.setup=function(e,t){this.container=e,this.texture=t},e.prototype.discardSprite=function(e){e.visible=!1,this.discardedSprites.push(e)},e.prototype.getSprite=function(){if(this.discardedSprites.length>0){var e=this.discardedSprites.pop();return e.visible=!0,e}var t=this.create(this.texture);return this.container.addChild(t),this.sprites.push(t),t},e}();t.SpritePool=l},658:function(e,t,i){var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Human=t.HumanFlags=t.HumanTimers=t.VIPText=t.HumanState=void 0;var r,n=i(841);(r=t.HumanState||(t.HumanState={}))[r.standing=0]="standing",r[r.walking=1]="walking",r[r.attacking=2]="attacking",r[r.fleeing=3]="fleeing",r[r.escaping=4]="escaping";var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.human=null,t.yOffset=0,t}return a(t,e),t}(PIXI.Text);t.VIPText=o;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flee=0,t.standing=0,t.target=0,t.plagueTick=0,t.healTick=0,t}return a(t,e),t}(n.CharacterTimers);t.HumanTimers=h;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dog=!1,t.doctor=!1,t.tank=!1,t.vip=!1,t.torchBearer=!1,t}return a(t,e),t}(n.CharacterFlags);t.HumanFlags=l;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.maxSpeed=0,t.flags=new l,t.target=null,t.speedMod=0,t.human=!0,t.plagueTicks=0,t.plagueDamage=0,t.visionDistance=0,t.timer=new h,t}return a(t,e),t}(n.CharacterObject);t.Human=c},345:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreatureFactory=void 0;var s=i(838),a=function(){function e(){if(this.gameModel=s.GameModel.getInstance(),this.spawnedSavedCreatures=!1,this.types={earthGolem:1,airGolem:2,fireGolem:3,waterGolem:4},this.creatures=[new r(1,this.types.earthGolem,"Earth Golem",3e3,75,30,800,"A golem born from rocks and mud, able to take a lot of punishment and taunt enemies to attack it"),new r(2,this.types.airGolem,"Air Golem",1200,110,45,900,"A fast moving golem able to cover large distances and chase targets down"),new r(3,this.types.fireGolem,"Fire Golem",1200,130,32,1e3,"A fireball spewing golem that ignites everything it touches"),new r(4,this.types.waterGolem,"Water Golem",1500,90,30,1100,"A calming golem that restores health to nearby units")],this.creatureScaling=1.75,this.creatureCostScaling=2,e.instance)return e.instance;e.instance=this}return e.prototype.update=function(e){for(var t=(new s.Creatures).creatureCount,i=0;i<this.creatures.length;i++)this.creatures[i].building?(this.creatures[i].timeLeft-=e,this.creatures[i].timeLeft<0&&(this.spawnCreature(this.creatures[i]),this.creatures[i].building=!1)):void 0!==t[this.creatures[i].type]&&t[this.creatures[i].type]<this.creatures[i].autobuild&&this.startBuilding(this.creatures[i]),this.gameModel.persistentData.creatureLevels[this.creatures[i].id]&&(this.creatures[i].level=this.gameModel.persistentData.creatureLevels[this.creatures[i].id])},e.prototype.purchasePrice=function(e){return e.baseCost*Math.pow(this.creatureCostScaling,e.level-1)},e.prototype.levelPrice=function(e){return e.baseCost*Math.pow(this.creatureCostScaling,e.level)*5},e.prototype.levelCreature=function(e){this.levelPrice(e)<this.gameModel.persistentData.parts&&(this.gameModel.persistentData.parts-=this.levelPrice(e),e.level++,this.gameModel.persistentData.creatureLevels[e.id]=e.level)},e.prototype.canAffordCreature=function(e){return this.purchasePrice(e)<this.gameModel.persistentData.parts},e.prototype.creaturesBuildingCount=function(){for(var e=0,t=0;t<this.creatures.length;t++)this.creatures[t].building&&e++;return e},e.prototype.startBuilding=function(e){e.building||this.canAffordCreature(e)&&(this.creaturesBuildingCount()+this.gameModel.creatureCount>=this.gameModel.creatureLimit||(e.building=!0,e.timeLeft=e.time,this.gameModel.persistentData.parts-=this.purchasePrice(e)))},e.prototype.creatureAutoBuildNumber=function(e,t){e.autobuild+t>=0&&(e.autobuild+=t,this.gameModel.persistentData.creatureAutobuild[e.id]=e.autobuild)},e.prototype.updateAutoBuild=function(){for(var e=0;e<this.creatures.length;e++)this.creatures[e].autobuild=this.gameModel.persistentData.creatureAutobuild[this.creatures[e].id]||0},e.prototype.resetLevels=function(){for(var e=0;e<this.creatures.length;e++)this.creatures[e].level=1},e.prototype.spawnCreature=function(e){var t=new s.Creatures,i=e.baseHealth*Math.pow(this.creatureScaling,e.level-1)*this.gameModel.golemHealthPCMod,a=e.baseDamage*Math.pow(this.creatureScaling,e.level-1)*this.gameModel.golemDamagePCMod;t.spawnCreature(i,a,e.speed,e.type,e.level)},e.prototype.spawnSavedCreatures=function(){if(!this.spawnedSavedCreatures){for(var e=0,t=function(t){if(++e<=i.gameModel.creatureLimit){var s=i.gameModel.persistentData.savedCreatures[t],a=i.creatures.filter((function(e){return e.type==s.t}))[0];a.level=s.l,i.spawnCreature(a)}},i=this,s=0;s<this.gameModel.persistentData.savedCreatures.length;s++)t(s);this.spawnedSavedCreatures=!0}},e.prototype.creatureStats=function(e){return{thisLevel:{level:e.level,health:e.baseHealth*Math.pow(this.creatureScaling,e.level-1)*this.gameModel.golemHealthPCMod,damage:e.baseDamage*Math.pow(this.creatureScaling,e.level-1)*this.gameModel.golemDamagePCMod,cost:e.baseCost*Math.pow(this.creatureCostScaling,e.level-1)},nextLevel:{level:e.level+1,health:e.baseHealth*Math.pow(this.creatureScaling,e.level)*this.gameModel.golemHealthPCMod,damage:e.baseDamage*Math.pow(this.creatureScaling,e.level)*this.gameModel.golemDamagePCMod,cost:e.baseCost*Math.pow(this.creatureCostScaling,e.level)}}},e}();t.CreatureFactory=a;var r=function(e,t,i,s,a,r,n,o){this.id=e,this.type=t,this.name=i,this.baseHealth=s,this.baseDamage=a,this.speed=r,this.baseCost=n,this.description=o,this.time=3,this.building=!1,this.timeLeft=10,this.autobuild=0,this.level=1}},298:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Creatures=void 0;var s=i(5),a=i(841),r=i(838),n=function(){function e(){if(this.creatureFactory=new r.CreatureFactory,this.zombies=new r.Zombies,this.creatures=[],this.creatureCount=[],this.aliveCreatures=[],this.aliveZombies=[],this.graveyardAttackers=[],this.discardedSprites=[],this.aliveHumans=[],this.scaling=1.6,this.moveTargetDistance=15,this.attackDistance=20,this.attackSpeed=3,this.targetDistance=100,this.fadeSpeed=.1,this.currId=1,this.scanTime=3,this.creatureTypes=this.creatureFactory.types,this.golemTextures={set:!1,down:[],up:[],left:[],right:[],dead:[]},this.directions={down:1,up:2,right:3,left:4,dead:5},this.burnTickTimer=5,this.smokeTimer=.3,this.fastDistance=r.fastDistance,this.magnitude=r.magnitude,this.damageZombie=this.zombies.damageZombie,this.searchClosestTarget=this.zombies.searchClosestTarget,this.updateBurns=this.zombies.updateBurns,this.updateZombieRegen=this.zombies.updateZombieRegen,this.causePlagueExplosion=this.zombies.causePlagueExplosion,this.inflictPlague=this.zombies.inflictPlague,this.healZombie=this.zombies.healZombie,e.instance)return e.instance;e.instance=this}return e.prototype.populate=function(){if(this.map=new r.ZmMap,this.model=r.GameModel.getInstance(),this.graveyard=new r.Graveyard,this.smoke=new r.Smoke,this.bullets=new r.Bullets,this.humans=new r.Humans,this.exclamations=new r.Exclamations,this.blood=new r.Blood,this.bones=new r.Bones,this.blasts=new r.Blasts,!this.golemTextures.set){this.golemTextures.down=[],this.golemTextures.up=[],this.golemTextures.right=[],this.golemTextures.dead=[];for(var e=0;e<3;e++)this.golemTextures.down.push(PIXI.Texture.from("golem"+e+".png"));for(e=3;e<6;e++)this.golemTextures.up.push(PIXI.Texture.from("golem"+e+".png"));for(e=6;e<9;e++)this.golemTextures.right.push(PIXI.Texture.from("golem"+e+".png"));this.golemTextures.dead.push(PIXI.Texture.from("golem9.png")),this.golemTextures.set=!0}var t=[];for(e=0;e<this.creatures.length;e++)this.model.constructions.monsterFactory?this.creatures[e].flags.dead?(this.discardedSprites.push(this.creatures[e]),r.characterContainer.removeChild(this.creatures[e])):(t.push(this.creatures[e]),this.creatures[e].x=this.graveyard.sprite.x,this.creatures[e].zIndex=this.creatures[e].y=this.graveyard.sprite.y+(this.graveyard.level>2?8:0),this.creatures[e].target=null,this.creatures[e].state=s.CreatureState.lookingForTarget):(this.discardedSprites.push(this.creatures[e]),r.characterContainer.removeChild(this.creatures[e]));this.creatures=t,this.aliveCreatures=[],this.creatureFactory.spawnSavedCreatures()},e.prototype.spawnCreature=function(e,t,i,n,o){if(!(this.model.creatureCount>=this.model.creatureLimit)){var h;switch(this.discardedSprites.length>0?(h=this.discardedSprites.pop()).textures=this.golemTextures.down:h=new s.Creature(this.golemTextures.down),n){case this.creatureTypes.earthGolem:h.tint=11042610,h.bulletReflect=this.model.bulletproofChance;break;case this.creatureTypes.airGolem:h.tint=10266040;break;case this.creatureTypes.fireGolem:h.tint=14370586,h.immuneToBurns=!0;break;case this.creatureTypes.waterGolem:h.tint=5080808,h.immuneToBurns=!0}h.flags=new a.CharacterFlags,h.burnDamage=0,h.level=o,h.textureSet=this.golemTextures,h.deadTexture=this.golemTextures.dead,h.currentDirection=this.directions.down,h.creatureType=n,h.lastKnownBuilding=!1,h.alpha=1,h.animationSpeed=.15,h.anchor.set(8.5/16,1),h.position.set(this.graveyard.sprite.x,this.graveyard.sprite.y+(this.graveyard.level>2?8:0)),h.target=null,h.zIndex=h.position.y,h.visible=!0,h.maxHealth=h.health=e,h.attackDamage=t,h.regenTimer=5,h.state=s.CreatureState.lookingForTarget,h.scaling=this.scaling,h.scale.set(h.scaling,h.scaling),h.xSpeed=0,h.ySpeed=0,h.speedMultiplier=1,h.maxSpeed=i,h.timer.ability=4*Math.random(),h.timer.attack=0,h.timer.scan=0,h.timer.burnTick=this.burnTickTimer,h.timer.smoke=this.smokeTimer,h.play(),h.zombieId=this.currId++,this.creatures.push(h),r.characterContainer.addChild(h),this.smoke.newZombieSpawnCloud(h.x,h.y-2),this.model.creatureCount++}},e.prototype.update=function(e){var t=0;this.aliveHumans=this.humans.aliveHumans,this.graveyardAttackers=this.humans.graveyardAttackers,this.aliveZombies=this.zombies.aliveZombies,this.creatureCount=[];for(var i=0;i<this.creatureFactory.creatures.length;i++)this.creatureCount[this.creatureFactory.creatures[i].type]=0;for(this.model.persistentData.savedCreatures=[],i=0;i<this.creatures.length;i++)this.creatures[i].visible&&this.updateCreature(this.creatures[i],e);for(i=0;i<this.creatures.length;i++)this.creatures[i].visible&&(this.creatures[i].flags.dead||(this.aliveZombies.push(this.creatures[i]),t++,this.creatureCount[this.creatures[i].creatureType]++,this.model.persistentData.savedCreatures.push({t:this.creatures[i].creatureType,l:this.creatures[i].level})));this.model.creatureCount=t},e.prototype.updateCreature=function(e,t){if(e.flags.dead){if(!e.visible)return;return e.alpha-=this.fadeSpeed*t,void(e.alpha<0&&(e.visible=!1,r.characterContainer.removeChild(e)))}if(e.timer.attack-=t,e.timer.scan-=t,e.timer.ability-=t,this.model.runeEffects.healthRegen>0&&this.updateZombieRegen(e,t),e.flags.burning&&!e.immuneToBurns&&this.updateBurns(e,t),e.timer.ability<0)switch(e.timer.ability=4,e.creatureType){case this.creatureTypes.earthGolem:this.golemTaunt(e);break;case this.creatureTypes.waterGolem:this.golemHeal(e);break;case this.creatureTypes.fireGolem:this.golemFireball(e)}switch((!e.target||e.target.flags.dead)&&e.timer.scan<0&&(e.state=s.CreatureState.lookingForTarget),e.state){case s.CreatureState.lookingForTarget:this.searchClosestTarget(e),e.target&&(e.state=s.CreatureState.movingToTarget);break;case s.CreatureState.movingToTarget:var i=this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y);if(i<this.attackDistance){e.state=s.CreatureState.attackingTarget;break}i>3*this.attackDistance&&e.timer.scan<0&&this.searchClosestTarget(e),this.updateCreatureSpeed(e,t);break;case s.CreatureState.attackingTarget:var a=this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y);a<this.attackDistance?(e.scale.x=e.target.x>e.x?e.scaling:-e.scaling,e.timer.attack<0&&(this.humans.damageHuman(e.target,this.calculateDamage(e)),e.creatureType==this.creatureTypes.fireGolem&&this.humans.burnHuman(e.target,e.attackDamage/2),e.timer.attack=this.attackSpeed*this.model.runeEffects.attackSpeed,e.flags.burning&&(e.timer.attack*=1/this.model.burningSpeedMod)),a>this.attackDistance/2&&this.updateCreatureSpeed(e,t)):e.state=s.CreatureState.movingToTarget}},e.prototype.getCreatureDirection=function(e){return Math.abs(e.xSpeed)>Math.abs(e.ySpeed)?e.xSpeed<0?this.directions.left:this.directions.right:e.ySpeed<0?this.directions.up:this.directions.down},e.prototype.changeTextureDirection=function(e){var t=this.getCreatureDirection(e);if(t!==e.currentDirection){switch(t){case this.directions.up:e.textures=e.textureSet.up,e.scale.x=e.scaling;break;case this.directions.down:e.textures=e.textureSet.down,e.scale.x=e.scaling;break;case this.directions.right:e.textures=e.textureSet.right,e.scale.x=e.scaling;break;case this.directions.left:e.textures=e.textureSet.right,e.scale.x=-e.scaling}e.currentDirection=t,e.play()}},e.prototype.updateCreatureSpeed=function(e,t){if(e.timer.dogStun&&e.timer.dogStun>0)e.timer.dogStun-=t;else{e.timer.target&&e.targetVector||(e.timer.target=0),e.timer.target-=t,e.timer.target<=0&&(e.targetVector=this.map.howDoIGetToMyTarget(e,e.target),e.timer.target=.2);var i=e.speedMultiplier*e.maxSpeed;e.xSpeed=e.targetVector.x*i,e.ySpeed=e.targetVector.y*i,e.position.x+=e.xSpeed*t,e.position.y+=e.ySpeed*t,e.zIndex=e.position.y,this.changeTextureDirection(e)}},e.prototype.calculateDamage=function(e){var t=e.attackDamage;return this.model.runeEffects.critChance>0&&Math.random()<this.model.runeEffects.critChance&&(t*=this.model.runeEffects.critDamage),t},e.prototype.golemTaunt=function(e){for(var t=0;t<this.aliveHumans.length;t++)Math.abs(this.aliveHumans[t].x-e.x)<this.targetDistance&&Math.abs(this.aliveHumans[t].y-e.y)<this.targetDistance&&(this.aliveHumans[t].vip||(this.aliveHumans[t].zombieTarget=e,this.aliveHumans[t].target=e))},e.prototype.golemHeal=function(e){for(var t=e.attackDamage,i=0;i<this.aliveZombies.length;i++)Math.abs(this.aliveZombies[i].x-e.x)<this.targetDistance&&Math.abs(this.aliveZombies[i].y-e.y)<this.targetDistance&&this.healZombie(this.aliveZombies[i],t);for(i=0;i<this.creatures.length;i++)!this.creatures[i].flags.dead&&this.creatures[i].visible&&Math.abs(this.creatures[i].x-e.x)<this.targetDistance&&Math.abs(this.creatures[i].y-e.y)<this.targetDistance&&this.healZombie(this.creatures[i],t)},e.prototype.golemFireball=function(e){for(var t=5,i=0;i<this.aliveHumans.length;i++)t>0&&Math.abs(this.aliveHumans[i].x-e.x)<this.targetDistance&&Math.abs(this.aliveHumans[i].y-e.y)<this.targetDistance&&(t--,this.bullets.newBullet(e,this.aliveHumans[i],e.attackDamage/2,!1,!1,!0))},e}();t.Creatures=n},894:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameModel=void 0;var s=i(838),a=function(){function e(){this.storageName="ZombieData",this.kongregate=null,this.playFabId=null,this.titleId="772D8",this.hidden=!1,this.autoShatter=!1,this.energy=0,this.energyMax=10,this.energyRate=1,this.brainsRate=0,this.bonesRate=0,this.energySpellMultiplier=1,this.prestigePointsEarned=0,this.zombieCost=10,this.bonesPCMod=1,this.partsPCMod=1,this.bloodMax=1e3,this.bloodPCMod=1,this.bloodStorePCMod=1,this.brainsMax=50,this.brainsPCMod=1,this.brainsStorePCMod=1,this.zombieHealth=100,this.zombieHealthPCMod=1,this.zombieDamage=10,this.zombieDamagePCMod=1,this.zombieSpeed=10,this.zombieCages=0,this.zombiesInCages=0,this.golemDamagePCMod=1,this.golemHealthPCMod=1,this.plagueDamageMod=0,this.graveyardHealthMod=1,this.burningSpeedMod=1,this.startingResources=0,this.blastHealing=0,this.plagueDmgReduction=0,this.brainRecoverChance=0,this.riseFromTheDeadChance=0,this.infectedBiteChance=0,this.infectedBlastChance=0,this.spitDistance=0,this.spikeDelay=5,this.startTimer=0,this.fenceRadius=50,this.constructions={},this.construction=0,this.boneCollectorCapacity=10,this.frameRate=0,this.humanCount=50,this.zombieCount=0,this.creatureCount=0,this.creatureLimit=1,this.harpySpeed=75,this.tankBuster=!1,this.harpyBombs=1,this.stats=null,this.runicSyphon={percentage:0,blood:0,bones:0,brains:0},this.gigazombies=!1,this.endLevelTimer=3,this.endLevelDelay=3,this.messageQueue=[],this.offlineMessage="",this.runeEffects={attackSpeed:1,critChance:0,critDamage:0,damageReduction:1,healthRegen:0,damageReflection:0},this.encodedContent="",this.savefilename="",this.autoUpgrades=!1,this.autoconstruction=!1,this.autoconstructionUnlocked=!1,this.levelResourcesAdded=!1,this.bulletproofChance=0,this.gameSpeed=1,this.level=1,this.currentState="startGame",this.states={playingLevel:"playingLevel",levelCompleted:"levelCompleted",startGame:"startGame",prestiged:"prestiged",failed:"failed"},this.baseStats={energyRate:1,brainsRate:0,bonesRate:0,energyMax:10,bloodMax:1e3,brainsMax:50,zombieCost:10,zombieHealth:100,zombieDamage:10,zombieSpeed:10,level:1,graveyard:0,construction:0,boneCollectorCapacity:10},this.zoom=s.zoom,this.centerGameContainer=s.centerGameContainer,this.lastSave=0,this.lastPlayFabSave=Date.now()-15e3,this.persistentData={saveCreated:Date.now(),dateOfSave:Date.now(),autoStart:!1,levelUnlocked:1,allTimeHighestLevel:0,blood:0,brains:0,bones:0,parts:0,bonesTotal:0,upgrades:[],constructions:[],prestigePointsEarned:0,prestigePointsToSpend:0,boneCollectors:0,graveyardZombies:1,harpies:0,resolution:1,zoomButtons:!1,particles:!0,generators:[],currentConstruction:null,creatureLevels:[],creatures:[],creatureAutobuild:[],savedCreatures:[],levelsCompleted:[],showfps:!1,runeshatter:0,runes:{life:{blood:0,brains:0,bones:0},death:{blood:0,brains:0,bones:0}},trophies:[],vipEscaped:[],autoRelease:!1,skeleton:null}}return e.getInstance=function(){return e.instance||(e.instance=new e,e.instance.particles=new s.Particles,e.instance.trophies=new s.Trophies,e.instance.bones=new s.Bones,e.instance.creatureFactory=new s.CreatureFactory,e.instance.creatures=new s.Creatures,e.instance.boneCollectors=new s.BoneCollectors,e.instance.graveyard=new s.Graveyard,e.instance.spells=new s.Spells,e.instance.partFactory=new s.PartFactory,e.instance.skeleton=new s.Skeleton,e.instance.upgrades=new s.Upgrades,e.instance.zombies=new s.Zombies,e.instance.humans=new s.Humans,e.instance.police=new s.Police,e.instance.army=new s.Army),e.instance},e.prototype.resetToBaseStats=function(){this.energyRate=this.baseStats.energyRate,this.brainsRate=this.baseStats.brainsRate,this.bonesRate=this.baseStats.bonesRate,this.energyMax=this.baseStats.energyMax,this.bloodMax=this.baseStats.bloodMax,this.brainsMax=this.baseStats.brainsMax,this.zombieHealth=this.baseStats.zombieHealth,this.zombieDamage=this.baseStats.zombieDamage,this.zombieSpeed=this.baseStats.zombieSpeed,this.zombieCost=this.baseStats.zombieCost,this.zombieCages=0,this.brainRecoverChance=0,this.riseFromTheDeadChance=0,this.infectedBiteChance=0,this.infectedBlastChance=0,this.construction=this.baseStats.construction,this.constructions={},this.boneCollectorCapacity=this.baseStats.boneCollectorCapacity,this.bonesPCMod=1,this.partsPCMod=1,this.bloodPCMod=1,this.bloodStorePCMod=1,this.brainsPCMod=1,this.brainsStorePCMod=1,this.zombieHealthPCMod=1,this.zombieDamagePCMod=1,this.golemHealthPCMod=1,this.golemDamagePCMod=1,this.plagueDamageMod=0,this.burningSpeedMod=1,this.startingResources=0,this.fenceRadius=50,this.spitDistance=0,this.spikeDelay=5,this.blastHealing=0,this.plagueDmgReduction=1,this.creatureLimit=1,this.runicSyphon.percentage=0,this.autoconstructionUnlocked=!1,this.autoUpgrades=!1,this.graveyardHealthMod=1,this.bulletproofChance=0,this.gigazombies=!1,this.harpySpeed=75,this.tankBuster=!1,this.harpyBombs=1},e.prototype.addEnergy=function(e){this.energy+=e,this.energy>this.energyMax&&(this.energy=this.energyMax)},e.prototype.addBlood=function(e){isNaN(this.persistentData.blood)&&(this.persistentData.blood=0),isNaN(e)||(this.persistentData.blood+=e*this.bloodPCMod,this.persistentData.blood>this.bloodMax&&(this.persistentData.blood=this.bloodMax,this.constructions.runesmith&&this.runicSyphon.percentage>0&&(this.runicSyphon.blood+=e*this.bloodPCMod)),this.runicSyphon.percentage>0&&(this.runicSyphon.blood+=e*this.bloodPCMod*this.runicSyphon.percentage))},e.prototype.addBrains=function(e){isNaN(this.persistentData.brains)&&(this.persistentData.brains=0),isNaN(e)||(this.persistentData.brains+=e*this.brainsPCMod,this.persistentData.brains>this.brainsMax&&(this.persistentData.brains=this.brainsMax,this.constructions.runesmith&&this.runicSyphon.percentage>0&&(this.runicSyphon.brains+=e*this.brainsPCMod)),this.runicSyphon.percentage>0&&(this.runicSyphon.brains+=e*this.brainsPCMod*this.runicSyphon.percentage))},e.prototype.addBones=function(e){isNaN(this.persistentData.bones)&&(this.persistentData.bones=0),isNaN(e)||(this.persistentData.bones+=e*this.bonesPCMod,this.persistentData.bonesTotal+=e*this.bonesPCMod,this.runicSyphon.percentage>0&&(this.runicSyphon.bones+=e*this.bonesPCMod*this.runicSyphon.percentage))},e.prototype.getHumanCount=function(){return this.humanCount},e.prototype.getEnergyRate=function(){return this.energySpellMultiplier*this.energyRate-(this.persistentData.boneCollectors+this.persistentData.harpies)},e.prototype.update=function(e,t){this.spells.updateSpells(e),e*=this.gameSpeed,this.hidden&&s.update(e,this.app),this.partFactory.update(e),this.autoRemoveCollectorsHarpies(),this.addEnergy(this.getEnergyRate()*e),this.currentState==this.states.playingLevel&&(this.addBones(this.bonesRate*e),this.addBrains(this.brainsRate*e),this.upgrades.updateRunicSyphon(this.runicSyphon),this.lastSave+3e4<t&&(this.saveData(),this.lastSave=t),this.lastPlayFabSave+12e5<t&&this.saveToPlayFab(),this.getHumanCount()<=0&&(this.endLevelTimer<0?(this.isBossStage(this.level)&&this.trophies.doesLevelHaveTrophy(this.level)&&this.trophies.trophyAquired(this.level),this.prestigePointsEarned=this.prestigePointsForLevel(this.level),this.currentState=this.states.levelCompleted,this.levelResourcesAdded=!1,this.calculateEndLevelBones(),this.calculateEndLevelZombieCages(),-1==this.persistentData.levelsCompleted.indexOf(this.level)&&(this.addPrestigePoints(this.prestigePointsForLevel(this.level)),this.persistentData.levelsCompleted.push(this.level)),this.persistentData.levelUnlocked=this.level+1,(!this.persistentData.allTimeHighestLevel||this.level>this.persistentData.allTimeHighestLevel)&&(this.persistentData.allTimeHighestLevel=this.level,window.kongregate&&window.kongregate.stats.submit("level",this.persistentData.allTimeHighestLevel)),this.startTimer=3):this.endLevelTimer-=e),this.upgrades.updateConstruction(e),this.upgrades.updateAutoUpgrades(),this.creatureFactory.update(e)),this.currentState==this.states.levelCompleted&&(this.startTimer-=e,this.startTimer<0&&this.persistentData.autoStart&&this.nextLevel()),this.currentState==this.states.failed&&(this.startTimer-=e,this.startTimer<0&&this.persistentData.autoStart&&this.startLevel(this.level-1)),this.updateStats()},e.prototype.calculateEndLevelBones=function(){var e=0;this.persistentData.boneCollectors>0&&this.bones.uncollected&&(e=this.bones.uncollected.length,this.addBones(e))},e.prototype.calculateEndLevelZombieCages=function(){this.zombieCages>0&&(this.zombiesInCages+=this.zombieCount,this.zombiesInCages>this.zombieCages&&(this.zombiesInCages=this.zombieCages))},e.prototype.autoRemoveCollectorsHarpies=function(){if(this.getEnergyRate()<0){var e=this.getEnergyRate();this.persistentData.harpies>0&&(this.persistentData.harpies-=Math.round(Math.abs(e)),this.persistentData.harpies<0&&(this.persistentData.harpies=0)),this.getEnergyRate()<0&&this.persistentData.boneCollectors>0&&this.persistentData.boneCollectors--}},e.prototype.releaseCagedZombies=function(){if(this.currentState==this.states.playingLevel){for(var e=0;e<this.zombiesInCages;e++)this.zombies.createZombie(this.graveyard.sprite.x,this.graveyard.sprite.y);this.zombiesInCages=0}},e.prototype.sacrificeCagedZombies=function(){this.addBlood(this.cagedZombieSacrificeValue().blood),this.addBrains(this.cagedZombieSacrificeValue().brains),this.addBones(this.cagedZombieSacrificeValue().bones),this.zombiesInCages=0},e.prototype.cagedZombieSacrificeValue=function(){return{blood:this.zombiesInCages*this.zombieHealth*.5,brains:this.zombiesInCages,bones:3*this.zombiesInCages}},e.prototype.startLevel=function(e){this.level=e,this.startGame()},e.prototype.startGame=function(){this.currentState=this.states.playingLevel,this.setupLevel(),this.updatePlayingLevel()},e.prototype.nextLevel=function(){this.level++,this.currentState=this.states.playingLevel,this.setupLevel(),this.updatePlayingLevel(),this.persistentData.autoRelease&&this.releaseCagedZombies()},e.prototype.setupLevel=function(){this.endLevelTimer=this.endLevelDelay,s.setGameFieldSizeForLevel(),this.particles.initialize(),this.humans.populate(),this.zombies.populate(),this.graveyard.initialize(),setTimeout(s.centerGameContainer,10),this.upgrades.applyUpgrades(),this.upgrades.updateRuneEffects(),this.partFactory.applyGenerators(),this.creatures.populate(),this.skeleton.populate(),this.addStartLevelResources(),this.populateStats()},e.prototype.populateStats=function(){this.stats={skeleton:{show:this.skeleton.persistent.skeletons>0,health:10*this.zombieHealth,damage:10*this.zombieDamage,speed:this.skeleton.moveSpeed},zombie:{health:this.zombieHealth,damage:this.zombieDamage,speed:this.zombieSpeed},human:{health:this.humans.getMaxHealth(this.level),damage:this.humans.attackDamage,speed:this.humans.maxRunSpeed},police:{show:this.police.getMaxPolice()>0,health:this.police.getMaxHealth(),damage:this.police.attackDamage,speed:this.police.maxRunSpeed},army:{show:this.army.getMaxArmy()>0,health:this.army.getMaxHealth(),damage:this.army.attackDamage,speed:this.army.maxRunSpeed}}},e.prototype.updateStats=function(){this.stats&&(this.stats.zombie.health=this.zombieHealth,this.stats.zombie.damage=this.zombieDamage,this.stats.zombie.speed=this.zombieSpeed,this.stats.zombie.count=this.zombieCount,this.stats.skeleton.health=10*this.zombieHealth,this.stats.skeleton.damage=10*this.zombieDamage,this.stats.skeleton.speed=this.skeleton.moveSpeed)},e.prototype.vipEscaped=function(){this.persistentData.vipEscaped||(this.persistentData.vipEscaped=[]),this.persistentData.vipEscaped.push(this.level),this.saveData()},e.prototype.updatePlayingLevel=function(){this.saveData()},e.prototype.addStartLevelResources=function(){this.energy=this.energyMax,this.levelResourcesAdded||(this.persistentData.blood+=500*this.startingResources,this.persistentData.blood>this.bloodMax&&(this.persistentData.blood=this.bloodMax),this.persistentData.brains+=50*this.startingResources,this.persistentData.brains>this.brainsMax&&(this.persistentData.brains=this.brainsMax),this.persistentData.bones+=200*this.startingResources,this.persistentData.bonesTotal+=200*this.startingResources,this.levelResourcesAdded=!0)},e.prototype.onReady=function(){this.upgrades.upgradeIdCheck()},e.prototype.addPrestigePoints=function(e){void 0===this.persistentData.prestigePointsEarned&&(this.persistentData.prestigePointsEarned=0,this.persistentData.prestigePointsToSpend=0),this.persistentData.prestigePointsEarned+=e},e.prototype.prestige=function(){var e=this;if(this.persistentData.prestigePointsEarned>0){this.persistentData.levelUnlocked=1,this.persistentData.blood=0,this.persistentData.brains=0,this.persistentData.bones=0,this.persistentData.parts=0,this.persistentData.generators=[],this.persistentData.bonesTotal=0,this.persistentData.upgrades=this.persistentData.upgrades.filter((function(t){return t.costType==e.upgrades.costs.prestigePoints})),this.persistentData.constructions=[],this.persistentData.boneCollectors=0,this.persistentData.currentConstruction=!1,this.persistentData.harpies=0,this.persistentData.graveyardZombies=1,this.persistentData.prestigePointsToSpend+=this.persistentData.prestigePointsEarned,this.persistentData.prestigePointsEarned=0,this.persistentData.runes=null,this.persistentData.vipEscaped=[],this.persistentData.creatureLevels=[],this.persistentData.creatureAutobuild=[],this.persistentData.levelsCompleted=[],this.persistentData.runeshatter=0,this.zombiesInCages=0,this.autoconstruction=!1,this.levelResourcesAdded=!1,this.gigazombies=!1,this.runeEffects={attackSpeed:1,critChance:0,critDamage:0,damageReduction:1,healthRegen:0,damageReflection:0},this.boneCollectors.update(.1),this.partFactory.generatorsApplied=[],this.creatureFactory.updateAutoBuild(),this.creatureFactory.resetLevels(),this.level=1,this.currentState=this.states.prestiged,this.setupLevel(),this.saveData();for(var t=0;t<this.upgrades.upgrades.length;t++)this.upgrades.upgrades[t].auto=!1}},e.prototype.saveData=function(){this.persistentData.dateOfSave=Date.now();try{localStorage.setItem(this.storageName,JSON.stringify(this.persistentData)),localStorage.setItem(this.skeleton.storageName,JSON.stringify(this.skeleton.persistent))}catch(e){console.log(e)}},e.prototype.loadData=function(){try{null!==localStorage.getItem(this.storageName)&&(this.persistentData=JSON.parse(localStorage.getItem(this.storageName)),this.level=this.persistentData.levelUnlocked,null!==localStorage.getItem(this.skeleton.storageName)&&(this.skeleton.persistent=JSON.parse(localStorage.getItem(this.skeleton.storageName))),this.updatePersistentData(),this.calcOfflineProgress())}catch(e){console.log(e)}},e.prototype.calcOfflineProgress=function(){if(this.upgrades.applyUpgrades(),this.upgrades.updateRuneEffects(),this.partFactory.applyGenerators(),this.constructions.partFactory){var e=(Date.now()-this.persistentData.dateOfSave)/1e3,t=this.partFactory.updateLongTime(e);t>0&&(this.offlineMessage="Your factory has generated "+s.formatWhole(t)+" parts while you were away",this.persistentData.parts+=t)}},e.prototype.resetData=function(){try{localStorage.removeItem(this.storageName),localStorage.removeItem(this.skeleton.storageName),this.saveToPlayFab(!0)}catch(e){console.log(e)}},e.prototype.updatePersistentData=function(){this.persistentData.constructions||(this.persistentData.constructions=[]),this.persistentData.generators||(this.persistentData.generators=[]),this.persistentData.parts||(this.persistentData.parts=0),this.persistentData.creatureLevels||(this.persistentData.creatureLevels=[]),this.persistentData.creatureAutobuild||(this.persistentData.creatureAutobuild=[]),this.persistentData.savedCreatures||(this.persistentData.savedCreatures=[]),this.persistentData.levelsCompleted||(this.persistentData.levelsCompleted=[]),this.persistentData.saveCreated||(this.persistentData.saveCreated=Date.now()),void 0===this.persistentData.particles&&(this.persistentData.particles=!0),this.persistentData.runeshatter||(this.persistentData.runeshatter=0),this.creatureFactory.updateAutoBuild()},e.prototype.sendMessage=function(e){-1==this.messageQueue.indexOf(e)&&this.messageQueue.push(e)},e.prototype.setResolution=function(e){this.app&&(this.app.renderer.resolution=e,this.app.renderer.rootRenderTarget&&(this.app.renderer.rootRenderTarget.resolution=e),this.app.renderer.plugins.interaction.resolution=e,this.app.renderer.resize(document.body.clientWidth,document.body.clientHeight))},e.prototype.downloadSaveGame=function(){this.persistentData.skeleton=this.skeleton.persistent,this.blob=new Blob([LZString.compressToEncodedURIComponent(JSON.stringify(this.persistentData))],{type:"octet/stream"}),delete this.persistentData.skeleton,this.encodedContent=window.URL.createObjectURL(this.blob);var e=(new Date).toISOString().replace(/:|T|Z|\./g,"");this.savefilename="incremancer-"+e+".sav"},e.prototype.importFile=function(){var t=document.getElementById("import-file").files;if(t&&1==t.length){var i=t[0],s=new FileReader,a=e.getInstance();s.onload=function(e){var t=JSON.parse(LZString.decompressFromEncodedURIComponent(e.target.result));t.dateOfSave?(t.skeleton&&(a.skeleton.persistent=t.skeleton,delete t.skeleton),a.persistentData=t,a.updatePersistentData(),a.saveToPlayFab(),a.level=a.persistentData.levelUnlocked,a.creatureFactory.spawnedSavedCreatures=!1,a.setupLevel()):alert("Error loading save game")},s.readAsText(i)}},e.prototype.toggleFullscreen=function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();else{var e=document.body;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},e.prototype.prestigePointsForLevel=function(e){return this.persistentData.levelsCompleted.indexOf(e)>-1?0:e},e.prototype.bossCompleted=function(e){var t=50*Math.floor((e-1)/50);return t<50||this.persistentData.levelsCompleted.indexOf(t)>-1},e.prototype.levelLocked=function(e){return e>this.persistentData.allTimeHighestLevel+1||!this.bossCompleted(e)},e.prototype.isBossStage=function(e){return e>0&&e%50==0},e.prototype.levelInfo=function(e){return{level:e,bossStage:this.isBossStage(e),completed:this.persistentData.levelsCompleted.indexOf(e)>-1,locked:this.levelLocked(e),trophy:this.trophies.doesLevelHaveTrophy(e)}},e.prototype.loginInUsingPlayFab=function(){if(window.kongregate)try{PlayFab.settings.titleId=this.titleId;var e={TitleId:PlayFab.settings.titleId,AuthTicket:window.kongregate.services.getGameAuthToken(),KongregateId:window.kongregate.services.getUserId(),CreateAccount:!0},t=this;PlayFabClientSDK.LoginWithKongregate(e,(function(e){e&&e.data&&e.data.PlayFabId&&(t.playFabId=e.data.PlayFabId,t.loadFromPlayFab())}),(function(e){console.log(e)}))}catch(e){console.error(e)}},e.prototype.saveToPlayFab=function(e){if(void 0===e&&(e=!1),this.lastPlayFabSave=Date.now(),this.playFabId){var t=this.persistentData.trophies;delete this.persistentData.trophies;var i={TitleId:this.titleId,PlayFabId:this.playFabId,Data:{save:!e&&LZString.compressToEncodedURIComponent(JSON.stringify(this.persistentData)),trophies:!e&&LZString.compressToEncodedURIComponent(JSON.stringify(t)),skeleton:!e&&LZString.compressToEncodedURIComponent(JSON.stringify(this.skeleton.persistent))}};this.persistentData.trophies=t;try{var s=this;PlayFab.ClientApi.UpdateUserData(i,(function(t){e?(s.resetToBaseStats(),s.setupLevel(),window.location.reload()):s.messageQueue.push("Game Saved to Cloud")}),(function(e){console.log(e)}))}catch(e){console.log(e)}}else e&&(this.resetToBaseStats(),this.setupLevel(),window.location.reload())},e.prototype.loadFromPlayFab=function(e){if(void 0===e&&(e=!1),this.playFabId){var t={TitleId:this.titleId,PlayFabId:this.playFabId,Keys:["save","trophies","skeleton"]};try{var i=this;PlayFab.ClientApi.GetUserData(t,(function(t){if(t.data.Data.save){var s=JSON.parse(LZString.decompressFromEncodedURIComponent(t.data.Data.save.Value));(e||s.saveCreated<i.persistentData.saveCreated||s.saveCreated==i.persistentData.saveCreated&&s.dateOfSave>i.persistentData.dateOfSave)&&(i.persistentData=s,t.data.Data.trophies&&(i.persistentData.trophies=JSON.parse(LZString.decompressFromEncodedURIComponent(t.data.Data.trophies.Value))),t.data.Data.skeleton&&(i.skeleton.persistent=JSON.parse(LZString.decompressFromEncodedURIComponent(t.data.Data.skeleton.Value))),i.level=i.persistentData.levelUnlocked,i.updatePersistentData(),i.calcOfflineProgress(),i.setupLevel(),i.messageQueue.push("Game Loaded from Cloud"))}}),(function(e){console.log(e)}))}catch(e){console.log(e)}}},e.prototype.allowPlayFabAction=function(){return this.lastPlayFabSave+15e3<Date.now()},e}();t.GameModel=a},681:function(e,t,i){var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Harpies=t.BoneCollectors=t.Graveyard=t.GraveyardSprite=void 0;var r=i(838),n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.graveyard=!0,t}return a(t,e),t}(PIXI.Sprite);t.GraveyardSprite=n;var o=function(){function e(){if(this.spikeSprites=[],this.level=1,this.spikeTimer=5,this.fenceRadius=50,this.fastDistance=r.fastDistance,this.graveyardHealth=0,this.graveyardMaxHealth=0,this.target={graveyard:!0,x:0,y:0},this.healthBar=null,this.fence=null,e.instance)return e.instance;e.instance=this}return e.prototype.initialize=function(){this.boneCollectors=new d,this.zmMap=new r.ZmMap,this.zombies=new r.Zombies,this.bones=new r.Bones,this.gameModel=r.GameModel.getInstance(),this.smoke=new r.Smoke,this.harpies=new g,this.blood=new r.Blood,this.humans=new r.Humans,void 0===this.gameModel.persistentData.graveyardZombies&&(this.gameModel.persistentData.graveyardZombies=1),this.drawGraveyard(),this.drawFence(),this.drawHealthBar(),this.bones.initialize(),this.boneCollectors.populate(),this.harpies.populate()},e.prototype.damageGraveyard=function(e){this.gameModel.isBossStage(this.gameModel.level)&&(this.graveyardHealth-=e,this.graveyardHealth<0&&(this.gameModel.currentState=this.gameModel.states.failed,this.gameModel.startTimer=3))},e.prototype.drawHealthBar=function(){this.gameModel.isBossStage(this.gameModel.level)?(this.gameModel.sendMessage("Defend the Graveyard!"),this.graveyardHealth=this.graveyardMaxHealth=100*this.gameModel.zombieHealth*this.gameModel.graveyardHealthMod,this.healthBar||(this.healthBar={container:new PIXI.Container,background:new PIXI.Graphics,foreground:new PIXI.Graphics,percentage:100},this.healthBar.container.addChild(this.healthBar.background),this.healthBar.container.addChild(this.healthBar.foreground),r.foregroundContainer.addChild(this.healthBar.container)),this.target.x=r.gameFieldSize.x/2,this.target.y=r.gameFieldSize.y/2,this.healthBar.container.visible=!0,this.healthBar.container.x=this.target.x-50,this.healthBar.container.y=this.target.y-100,this.healthBar.background.clear(),this.healthBar.background.lineStyle(12,3355443),this.healthBar.background.moveTo(-2,0),this.healthBar.background.lineTo(102,0),this.healthBar.foreground.clear(),this.healthBar.foreground.lineStyle(8,16601682),this.healthBar.foreground.moveTo(0,0),this.healthBar.foreground.lineTo(100,0)):this.healthBar&&(this.healthBar.background.clear(),this.healthBar.foreground.clear(),this.healthBar.container.visible=!1)},e.prototype.updateHealthBar=function(){var e=Math.max(Math.round(this.graveyardHealth/this.graveyardMaxHealth*100),0);e!=this.healthBar.percentage&&(this.healthBar.foreground.clear(),e>0&&(this.healthBar.foreground.lineStyle(8,16601682),this.healthBar.foreground.moveTo(0,0),this.healthBar.foreground.lineTo(e,0)),this.healthBar.percentage=e)},e.prototype.drawGraveyard=function(){this.spikeTexture||(this.spikeTexture=PIXI.Texture.from("spikes.png")),this.sprite&&r.backgroundContainer.removeChild(this.sprite),this.fortSprite&&(r.characterContainer.removeChild(this.fortSprite),this.fortSprite=null),this.level=1;var e="graveyard1.png",t="";this.gameModel.constructions.crypt&&(this.level=2,e="graveyard2.png"),this.gameModel.constructions.fort&&(this.level=3,e="sprites/megagraveyard.png",t="fort1.png"),this.gameModel.constructions.fortress&&(this.level=4,e="sprites/megagraveyard.png",t="fort2.png"),this.gameModel.constructions.citadel&&(this.level=5,e="sprites/megagraveyard.png",t="fort3.png"),this.sprite?this.sprite.texture=PIXI.Texture.from(e):this.sprite=new n(PIXI.Texture.from(e));var i=this.zmMap.graveYardLocation;this.sprite.width=32,this.sprite.height=32,this.sprite.anchor.set(.5,.5),this.sprite.scale.set(2,2),this.sprite.visible=!1,r.backgroundContainer.addChild(this.sprite),this.sprite.x=i.x,this.sprite.y=i.y,this.zmMap.graveyardCollision=!1,t&&(this.fortSprite?this.fortSprite.texture=PIXI.Texture.from(t):this.fortSprite=new PIXI.Sprite(PIXI.Texture.from(t)),this.fortSprite.anchor.set(.5,1),this.fortSprite.scale.set(2,2),this.fortSprite.x=i.x,this.fortSprite.zIndex=this.fortSprite.y=i.y+2,this.fortSprite.visible=!1,r.characterContainer.addChild(this.fortSprite))},e.prototype.drawFence=function(){this.fence&&r.backgroundContainer.removeChild(this.fence),this.fenceRadius=this.gameModel.fenceRadius,this.fence=new PIXI.Container,this.fence.visible=!1,r.backgroundContainer.addChild(this.fence);for(var e=[],t=0;t<4;t++)e.push(PIXI.Texture.from("fencepost"+(t+1)+".png"));var i=Math.round(.4*this.fenceRadius),s=2*Math.PI/i;for(t=0;t<i;t++){var a=new PIXI.Sprite(r.getRandomElementFromArray(e,Math.random()));this.fence.addChild(a),a.anchor.set(.5,1),a.scale.x=Math.random()>.5?1:-1;var n=10*Math.random()-5,o=r.RotateVector2d(0,this.fenceRadius+n,s*t);a.position.set(o.x,o.y)}this.fence.cacheAsBitmap=!0;var h=this.zmMap.graveYardLocation;this.fence.x=h.x,this.fence.y=h.y},e.prototype.update=function(e){if(this.boneCollectors.addAndRemoveBoneCollectors(),this.harpies.addAndRemoveHarpies(),this.gameModel.isBossStage(this.gameModel.level)&&this.updateHealthBar(),this.gameModel.constructions.graveyard&&this.gameModel.currentState==this.gameModel.states.playingLevel){if((this.level<2&&this.gameModel.constructions.crypt||this.level<3&&this.gameModel.constructions.fort||this.level<4&&this.gameModel.constructions.fortress||this.level<5&&this.gameModel.constructions.citadel)&&this.drawGraveyard(),this.sprite.visible=!0,this.fortSprite&&(this.fortSprite.visible=!0),5==this.level&&Math.random()>.9&&(Math.random()>.5?this.smoke.newFireSmoke(this.sprite.x-20,this.sprite.y-113):this.smoke.newFireSmoke(this.sprite.x+20,this.sprite.y-113)),this.gameModel.energy>=this.gameModel.energyMax&&!this.gameModel.hidden)for(var t=0;t<this.gameModel.persistentData.graveyardZombies;t++)this.zombies.spawnZombie(this.sprite.x,this.sprite.y+(this.level>2?8:0));this.bones.update(e),this.boneCollectors.update(e),this.harpies.update(e),this.gameModel.constructions.fence&&this.gameModel.currentState==this.gameModel.states.playingLevel?(this.fence.visible=!0,this.fenceRadius!==this.gameModel.fenceRadius&&this.drawFence()):this.fence.visible=!1,this.updatePlagueSpikes(e),this.updateSpikeSprites(e)}else this.sprite.visible=!1},e.prototype.updatePlagueSpikes=function(e){if(this.gameModel.constructions.plagueSpikes&&(this.spikeTimer-=e,this.spikeTimer<0)){this.spikeTimer=this.gameModel.spikeDelay;for(var t=this.humans.aliveHumans,i=0;i<t.length;i++)Math.abs(t[i].x-this.sprite.x)<this.fenceRadius&&Math.abs(t[i].y-this.sprite.y)<this.fenceRadius&&this.fastDistance(this.sprite.x,this.sprite.y,t[i].x,t[i].y)<this.fenceRadius&&(this.zombies.inflictPlague(t[i]),this.humans.damageHuman(t[i],this.gameModel.zombieDamage),this.blood.newPlagueSplatter(t[i].x,t[i].y),this.addSpikeSprite(t[i]))}},e.prototype.addSpikeSprite=function(e){for(var t=null,i=0;i<this.spikeSprites.length;i++)if(!this.spikeSprites[i].visible){t=this.spikeSprites[i];break}t||(t=new PIXI.Sprite(this.spikeTexture),this.spikeSprites.push(t),r.characterContainer.addChild(t),t.anchor.set(.5,1)),t.visible=!0,t.alpha=1,t.x=e.x,t.y=e.y+2,t.zIndex=t.y,t.scale.y=2,t.scale.x=Math.random()>.5?1.5:-1.5},e.prototype.updateSpikeSprites=function(e){for(var t=0;t<this.spikeSprites.length;t++)this.spikeSprites[t].visible&&(this.spikeSprites[t].alpha-=.4*e,this.spikeSprites[t].alpha<=0&&(this.spikeSprites[t].visible=!1))},e.prototype.isWithinFence=function(e){return!(!this.gameModel.constructions.fence||this.gameModel.currentState!=this.gameModel.states.playingLevel)&&e.x>this.fence.x-this.fenceRadius&&e.x<this.fence.x+this.fenceRadius&&e.y>this.fence.y-this.fenceRadius&&e.y<this.fence.y+this.fenceRadius&&this.fastDistance(e.x,e.y,this.fence.x,this.fence.y)<=this.fenceRadius},e}();t.Graveyard=o;var h,l=function(e){function t(t){var i=e.call(this,t)||this;return i.xSpeed=0,i.ySpeed=0,i.bones=0,i.speedFactor=0,i.boneList=[],i.target=null,i.animationSpeed=.2,i}return a(t,e),t}(PIXI.AnimatedSprite);!function(e){e[e.collecting=0]="collecting",e[e.returning=1]="returning",e[e.waiting=2]="waiting"}(h||(h={}));var c,d=function(){function e(){if(this.sprites=[],this.maxSpeed=125,this.scaling=2,this.collectDistance=10,this.fastDistance=r.fastDistance,e.instance)return e.instance;e.instance=this}return e.prototype.populate=function(){if(this.graveyard=new o,this.gameModel=r.GameModel.getInstance(),this.bones=new r.Bones,!this.texture){this.texture=[];for(var e=0;e<2;e++)this.texture.push(PIXI.Texture.from("bonecollector"+(e+1)+".png"))}for(e=0;e<this.sprites.length;e++)this.sprites[e].boneList=[],this.sprites[e].target=!1,this.sprites[e].position.set(this.graveyard.sprite.x,this.graveyard.sprite.y),this.sprites[e].state=h.collecting},e.prototype.addAndRemoveBoneCollectors=function(){if(this.sprites.length>this.gameModel.persistentData.boneCollectors){var e=this.sprites.pop();if(e.boneList)for(var t=0;t<e.boneList.length;t++)e.boneList[t].collector=!1;this.gameModel.addBones(e.bones),r.characterContainer.removeChild(e)}if(this.sprites.length<this.gameModel.persistentData.boneCollectors){var i=new l(this.texture);i.animationSpeed=.2,i.anchor.set(.5,1),i.position.set(this.graveyard.sprite.x,this.graveyard.sprite.y),i.zIndex=i.position.y,i.visible=!0,i.scale.set(Math.random()>.5?this.scaling:-1*this.scaling,this.scaling),i.xSpeed=0,i.ySpeed=0,i.bones=0,i.speedFactor=0,i.state=h.collecting,i.play(),i.boneList=[],this.sprites.push(i),r.characterContainer.addChild(i)}},e.prototype.update=function(e){for(var t=0;t<this.sprites.length;t++)this.updateBoneCollector(this.sprites[t],e)},e.prototype.findNearestBone=function(e){if(e.boneList||(e.boneList=[]),0==e.boneList.length)for(var t=e.x,i=e.y,s=0;s<3;s++){for(var a=null,r=2e3,n=0;n<this.bones.uncollected.length;n++)if(!this.bones.uncollected[n].collected&&!this.bones.uncollected[n].collector){var o=this.fastDistance(t,i,this.bones.uncollected[n].x,this.bones.uncollected[n].y);o<r&&(r=o,a=this.bones.uncollected[n])}if(!a)break;e.boneList.push(a),a.collector=!0,t=a.x,i=a.y}e.boneList.length>0?e.target=e.boneList.shift():e.target=!1},e.prototype.updateBoneCollector=function(e,t){switch(!e.target||e.target.graveyard&&e.state==h.collecting||this.updateSpeed(e,t),e.state){case h.collecting:if(e.target&&!e.target.collected&&e.target.visible||this.findNearestBone(e),e.target&&!e.target.collected&&this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.collectDistance&&(e.bones++,e.target.collected=!0,e.speedFactor=0),e.bones>=this.gameModel.boneCollectorCapacity||!e.target)return e.state=h.returning,void(e.target=this.graveyard.sprite);break;case h.returning:e.target||(e.target=this.graveyard.sprite),this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.collectDistance&&(e.target=!1,this.gameModel.addBones(e.bones),e.bones=0,e.state=h.collecting,e.speedFactor=0)}},e.prototype.updateSpeed=function(e,t){e.speedFactor=Math.min(1,e.speedFactor+=3*t);var i=e.target.x-e.x,s=e.target.y-e.y,a=Math.abs(i),r=Math.abs(s);if(0!=Math.max(a,r)){var n=1/Math.max(a,r);n*=1.29289-(a+r)*n*.29289,e.xSpeed=i*n*this.maxSpeed*e.speedFactor,e.ySpeed=s*n*this.maxSpeed*e.speedFactor,e.position.x+=e.xSpeed*t,e.position.y+=e.ySpeed*t,e.zIndex=e.position.y}},e}();t.BoneCollectors=d,function(e){e[e.bombing=0]="bombing",e[e.returning=1]="returning"}(c||(c={}));var u=function(e){function t(t){var i=e.call(this,t)||this;return i.target=null,i.xSpeed=0,i.ySpeed=0,i.bombs=0,i.speedFactor=0,i.animationSpeed=.2,i.anchor.set(.5,1),i.visible=!0,i}return a(t,e),t}(PIXI.AnimatedSprite),p=function(e){function t(t){var i=e.call(this,t)||this;return i.dropped=!1,i.floor=0,i.rotSpeed=0,i.xSpeed=0,i.ySpeed=0,i.fire=!1,i.anchor.set(.5,.5),i}return a(t,e),t}(PIXI.Sprite),g=function(){function e(){if(this.sprites=[],this.bombSprites=[],this.discardedBombSprites=[],this.bombHeight=100,this.scaling=2.5,this.fastDistance=r.fastDistance,e.instance)return e.instance;e.instance=this}return e.prototype.populate=function(){if(this.model=r.GameModel.getInstance(),this.graveyard=new o,this.zombies=new r.Zombies,this.humans=new r.Humans,this.tanks=new r.Tanks,!this.textures){this.textures=[];for(var e=0;e<2;e++)this.textures.push(PIXI.Texture.from("harpy"+(e+1)+".png"));this.bombTexture=PIXI.Texture.from("harpybomb.png")}for(void 0===this.model.persistentData.harpies&&(this.model.persistentData.harpies=0),e=0;e<this.sprites.length;e++)this.sprites[e].target=!1,this.sprites[e].position.set(this.graveyard.sprite.x,this.graveyard.sprite.y-this.bombHeight),this.sprites[e].state=c.returning;for(e=0;e<this.bombSprites.length;e++)this.bombSprites[e].visible=!1},e.prototype.addAndRemoveHarpies=function(){if(this.sprites.length>this.model.persistentData.harpies){var e=this.sprites.pop();e.target=!1,e.bomb&&(e.bomb.dropped=!0,e.bomb.floor=e.bomb.y+this.bombHeight),r.foregroundContainer.removeChild(e)}if(this.sprites.length<this.model.persistentData.harpies){var t=new u(this.textures);t.position.set(this.graveyard.sprite.x,this.graveyard.sprite.y-this.bombHeight),t.zIndex=t.position.y,t.scale.set(Math.random()>.5?this.scaling:-1*this.scaling,this.scaling),t.state=c.returning,t.play(),this.sprites.push(t),r.foregroundContainer.addChild(t)}},e.prototype.update=function(e){for(var t=0;t<this.sprites.length;t++)this.updateHarpy(this.sprites[t],e);for(t=0;t<this.bombSprites.length;t++)this.bombSprites[t].visible&&this.updateBomb(this.bombSprites[t],e)},e.prototype.updateBomb=function(e,t){e.dropped?(e.rotation+=t*e.rotSpeed,e.ySpeed+=50*t,e.scale.x=e.scale.y-=.2*t,e.y+=e.ySpeed*t,e.y>=e.floor-2&&(e.visible=!1,this.discardedBombSprites.push(e),e.fire&&this.humans.burnHuman(e.target,.1*this.model.zombieHealth),this.zombies.causePlagueExplosion(e,.2*this.model.zombieHealth,!1))):(e.x=e.harpy.x,e.y=e.harpy.y)},e.prototype.updateHarpy=function(e,t){switch(e.state){case c.bombing:if(!e.target||e.target.graveyard||e.target.dead)if(this.model.tankBuster&&this.model.isBossStage(this.model.level)&&this.tanks.aliveTanks.length>0)e.target=r.getRandomElementFromArray(this.tanks.aliveTanks,Math.random()),e.bomb.fire=!0;else{for(var i=0;i<8&&(e.target=r.getRandomElementFromArray(this.humans.aliveHumans,Math.random()),e.target&&!(this.fastDistance(e.x,e.y,e.target.x,e.target.y-this.bombHeight)<500));i++);e.bomb.fire=!1}if(!e.target)return void(e.state=c.returning);this.fastDistance(e.x,e.y,e.target.x,e.target.y-this.bombHeight)<10?(e.bombs--,e.bomb.dropped=!0,e.bomb.floor=e.target.y,e.bomb.target=e.target,e.bomb=null,e.speedFactor=0,e.target=!1,e.bombs<=0?e.state=c.returning:this.getBomb(e)):this.updateHarpySpeed(e,t);break;case c.returning:e.target||(e.target=this.graveyard.sprite),this.fastDistance(e.x,e.y,e.target.x,e.target.y-this.bombHeight)<10?(e.bombs=this.model.harpyBombs,this.getBomb(e),e.state=c.bombing,e.speedFactor=0):this.updateHarpySpeed(e,t)}},e.prototype.getBomb=function(e){var t;this.discardedBombSprites.length>0?t=this.discardedBombSprites.pop():(t=new p(this.bombTexture),this.bombSprites.push(t),r.foregroundContainer.addChild(t)),t.scale.x=t.scale.y=2,t.rotation=0,t.rotSpeed=Math.random()>.5?4:-4,t.ySpeed=0,t.visible=!0,t.dropped=!1,t.harpy=e,e.bomb=t},e.prototype.updateHarpySpeed=function(e,t){e.speedFactor=Math.min(1,e.speedFactor+=2*t);var i=e.target.x-e.x,s=e.target.y-this.bombHeight-e.y,a=Math.abs(i),r=Math.abs(s);if(0!=Math.max(a,r)){var n=1/Math.max(a,r);n*=1.29289-(a+r)*n*.29289,e.xSpeed=i*n*this.model.harpySpeed*e.speedFactor,e.ySpeed=s*n*this.model.harpySpeed*e.speedFactor,e.position.x+=e.xSpeed*t,e.position.y+=e.ySpeed*t,e.scale.x=e.xSpeed>0?this.scaling:-1*this.scaling}},e}();t.Harpies=g},463:function(e,t,i){var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Tanks=t.Army=t.Police=t.Humans=void 0;var r=i(658),n=i(838),o=function(){function e(){if(this.maxWalkSpeed=15,this.maxRunSpeed=35,this.minSecondsTostand=1,this.maxSecondsToStand=60,this.chanceToStayInCurrentBuilding=.95,this.textures=[],this.doctorTextures=[],this.humans=[],this.discardedHumans=[],this.aliveHumans=[],this.graveyardAttackers=[],this.humansPerLevel=50,this.maxHumans=1e3,this.scaling=2,this.visionDistance=60,this.vipEscaping=!1,this.fleeChancePerZombie=.1,this.fleeTime=10,this.scanTime=3,this.attackDistance=20,this.moveTargetDistance=3,this.attackSpeed=2,this.attackDamage=5,this.fadeSpeed=.1,this.plagueTickTimer=5,this.healTickTimer=5,this.burnTickTimer=5,this.smokeTimer=.3,this.fastDistance=n.fastDistance,this.frozen=!1,this.pandemic=!1,this.graveYardPosition=null,this.drawTargets=!1,e.instance)return e.instance;e.instance=this}return e.prototype.randomSecondsToStand=function(){return this.minSecondsTostand+Math.random()*(this.maxSecondsToStand-this.minSecondsTostand)},e.prototype.damageHuman=function(e,t){var i=this;this.gameModel.addBlood(Math.round(t/3)),e.health-=t,e.timer.scan=0,e.flags.tank?this.fragments.newPart(e.x,e.y-18,8086798):(this.blood.newSplatter(e.x,e.y),e.speedMod=Math.max(Math.min(1,e.health/e.maxHealth),.25)),e.health<=0&&!e.flags.dead&&(this.bones.newBones(e.x,e.y),e.flags.dead=!0,this.gameModel.addBrains(1),this.skeleton.addXp(this.gameModel.level),this.skeleton.testForLoot(),e.flags.tank?(this.blasts.newDroneBlast(e.x,e.y-5),this.fragments.newFragmentExplosion(e.x,e.y-5,8086798),e.visible=!1):e.textures=e.deadTexture,e.flags.vip&&(this.vipText.visible=!1,this.trophies.trophyAquired(this.gameModel.level),setTimeout((function(){i.vipEscaping=!1}),1e3))),this.army.assaultStarted||Math.random()>.9&&this.gameModel.isBossStage(this.gameModel.level)&&(this.army.assaultStarted=!0,this.gameModel.sendMessage("The assault has begun!"))},e.prototype.updateBurns=function(e,t){e.timer.burnTick-=t,e.timer.smoke-=t,e.timer.smoke<0&&(this.smoke.newFireSmoke(e.x,e.y-14),e.timer.smoke=this.smokeTimer),e.timer.burnTick<0&&(this.damageHuman(e,e.burnDamage),e.timer.burnTick=this.burnTickTimer,this.exclamations.newFire(e))},e.prototype.assignRandomTarget=function(e){(Math.random()>this.chanceToStayInCurrentBuilding||e.timer.flee>0)&&(e.currentPoi=this.map.getRandomBuilding()),e.target=this.map.randomPositionInBuilding(e.currentPoi),e.maxSpeed=e.timer.flee>0?this.maxRunSpeed:this.maxWalkSpeed,e.xSpeed=0,e.ySpeed=0},e.prototype.getMaxNpcs=function(){return Math.min(this.humansPerLevel*this.gameModel.level,this.maxHumans)},e.prototype.getMaxHumans=function(){return this.gameModel.isBossStage(this.gameModel.level)?0:this.getMaxNpcs()-(this.police.police.length+this.army.armymen.length)},e.prototype.getMaxDoctors=function(){return this.gameModel.level<18?0:Math.min(Math.round(.7*this.gameModel.level),75)},e.prototype.getTorchChance=function(){return this.gameModel.level<10?0:.02*Math.min(this.gameModel.level-10,40)},e.prototype.getMaxHealth=function(e){return e<7?10*(e+4):e<12?20*(e-1):e<16?25*(e-3):e<29?50*(e-9):e<49?100*(e-19):e<64?300*(e-39):e<85?500*(e-49):e>499?85e5*Math.pow(1.03,e-499):17800*Math.pow(1.015,e-84)},e.prototype.getAttackDamage=function(){1!=this.gameModel.level?2!=this.gameModel.level?3!=this.gameModel.level?this.attackDamage=Math.round(this.getMaxHealth(this.gameModel.level)/10):this.attackDamage=5:this.attackDamage=4:this.attackDamage=2},e.prototype.setupVipText=function(e){this.vipText||(this.vipText=new r.VIPText("VIP",{fontFamily:"sans-serif",fontSize:64,fill:"#FC0",stroke:"#000",strokeThickness:5,align:"center"}),this.vipText.anchor.set(.5,1),this.vipText.scale.x=.25,this.vipText.scale.y=.25,n.foregroundContainer.addChild(this.vipText)),this.vipText.visible=!0,this.vipText.human=e,this.vipText.yOffset=-20,this.vipText.x=e.x,this.vipText.y=e.y+this.vipText.yOffset},e.prototype.populate=function(){if(this.map=new n.ZmMap,this.zombies=new n.Zombies,this.gameModel=n.GameModel.getInstance(),this.blood=new n.Blood,this.smoke=new n.Smoke,this.bones=new n.Bones,this.skeleton=new n.Skeleton,this.blasts=new n.Blasts,this.fragments=new n.Fragments,this.trophies=new n.Trophies,this.exclamations=new n.Exclamations,this.bullets=new n.Bullets,this.police=new c,this.army=new p,this.tanks=new y,this.map.populatePois(),0==this.textures.length)for(var e=0;e<6;e++){for(var t=[],i=0;i<3;i++)t.push(PIXI.Texture.from("human"+(e+1)+"_"+(i+1)+".png"));this.textures.push({animated:t,dead:[PIXI.Texture.from("human"+(e+1)+"_dead.png")]})}if(0==this.doctorTextures.length){for(e=0;e<3;e++)this.doctorTextures.push(PIXI.Texture.from("doctor"+(e+1)+".png"));this.doctorDeadTexture=[PIXI.Texture.from("doctor4.png")]}if(this.humans.length>0){for(e=0;e<this.humans.length;e++)n.characterContainer.removeChild(this.humans[e]),this.humans[e].stop();this.discardedHumans=this.humans.slice(),this.humans.length=0,this.aliveHumans.length=0}this.police.populate(),this.army.populate(),this.tanks.populate(),this.getAttackDamage();var s=this.getMaxHumans(),a=this.getMaxDoctors(),o=this.getMaxHealth(this.gameModel.level),h=this.trophies.doesLevelHaveTrophy(this.gameModel.level);for(this.vip=void 0,h?this.escapeTarget={x:n.gameFieldSize.x/2,y:n.gameFieldSize.y+50}:this.vipText&&(this.vipText.visible=!1),e=0;e<s;e++){var l=void 0;if(a>0)this.discardedHumans.length>0?(l=this.discardedHumans.pop()).textures=this.doctorTextures:l=new r.Human(this.doctorTextures),l.deadTexture=this.doctorDeadTexture,l.flags.doctor=!0,l.flags.torchBearer=!1,l.timer.healTick=Math.random()*this.healTickTimer,a--;else{var d=Math.random()<this.getTorchChance(),u=Math.floor(3*Math.random())+(d?3:0);this.discardedHumans.length>0?(l=this.discardedHumans.pop()).textures=this.textures[u].animated:l=new r.Human(this.textures[u].animated),l.flags.torchBearer=d,l.deadTexture=this.textures[u].dead,l.flags.doctor=!1}l.reset(),l.flags.vip=!1,l.flags.dead=!1,l.flags.burning=!1,l.flags.infected=!1,l.burnDamage=0,l.plagueDamage=0,l.plagueTicks=0,l.animationSpeed=.15,l.anchor.set(35/80,1),l.currentPoi=this.map.getRandomBuilding(),l.position.copyFrom(this.map.randomPositionInBuilding(l.currentPoi)),l.zIndex=l.position.y,l.xSpeed=0,l.ySpeed=0,l.timer.plagueTick=Math.random()*this.plagueTickTimer,l.target=!1,l.speedMod=1,l.zombieTarget=null,l.lastKnownBuilding=null,l.visionDistance=this.visionDistance,l.visible=!0,l.alpha=1,l.maxHealth=l.health=o,h&&!l.flags.doctor&&(l.flags.vip=!0,this.vip=l,h=!1,l.maxHealth=l.health=2*o,this.setupVipText(l)),l.timer.scan=Math.random()*this.scanTime,l.timer.flee=0,this.changeState(l,r.HumanState.standing),l.timer.standing=Math.random()*this.randomSecondsToStand(),l.timer.attack=this.attackSpeed,l.scale.set(Math.random()>.5?this.scaling:-1*this.scaling,this.scaling),this.humans.push(l),n.characterContainer.addChild(l)}},e.prototype.updateHumanSpeed=function(e,t){if(this.frozen)e.gotoAndStop(0);else if(e.playing||e.play(),e.timer.dogStun&&e.timer.dogStun>0)e.timer.dogStun-=t;else{0==e.timer.target&&e.targetVector||(e.timer.target=0),e.timer.target-=t,e.timer.target<=0&&(e.targetVector=this.map.howDoIGetToMyTarget(e,e.target),e.timer.target=.2);var i=e.speedMod*e.maxSpeed;e.xSpeed=e.targetVector.x*i,e.ySpeed=e.targetVector.y*i,(isNaN(e.xSpeed)||isNaN(e.ySpeed))&&(e.xSpeed=0,e.ySpeed=0),e.position.x+=e.xSpeed*t,e.position.y+=e.ySpeed*t,e.zIndex=e.position.y,Math.abs(e.xSpeed)>1&&!e.flags.tank&&(e.scale.x=e.xSpeed>0?this.scaling:-this.scaling)}},e.prototype.update=function(e){if(this.gameModel.currentState==this.gameModel.states.playingLevel){var t=[],i=this.zombies.aliveZombies;this.graveyardAttackers.length=0;for(var s=0;s<this.humans.length;s++)this.updateHuman(this.humans[s],e,i),this.humans[s].flags.dead||t.push(this.humans[s]);this.aliveHumans=t,this.gameModel.stats.human.count=this.aliveHumans.length,this.police.update(e,i),this.army.update(e,i),this.tanks.update(e,i),this.vipText&&this.vipText.visible&&(this.vipText.x=this.vipText.human.x,this.vipText.y=this.vipText.human.y+this.vipText.yOffset),this.gameModel.humanCount=this.aliveHumans.length}},e.prototype.updateDeadHumanFading=function(e,t){if(e.visible){if(e.alpha>.5&&e.alpha-this.fadeSpeed*t<=.5&&!e.flags.tank&&Math.random()<this.gameModel.riseFromTheDeadChance)return this.zombies.createZombie(e.x,e.y,e.flags.dog),e.visible=!1,void n.characterContainer.removeChild(e);e.alpha-=this.fadeSpeed*t,e.alpha<0&&(e.visible=!1,n.characterContainer.removeChild(e))}},e.prototype.changeState=function(e,t){switch(t){case r.HumanState.standing:e.gotoAndStop(0),e.maxSpeed=this.maxWalkSpeed,e.timer.standing=this.randomSecondsToStand();break;case r.HumanState.walking:e.play(),e.maxSpeed=this.maxWalkSpeed;break;case r.HumanState.fleeing:e.play(),e.timer.flee=this.fleeTime,e.maxSpeed=this.maxRunSpeed,this.assignRandomTarget(e),this.exclamations.newExclamation(e);break;case r.HumanState.escaping:e.play(),e.maxSpeed=this.maxRunSpeed,e.target=this.escapeTarget,this.exclamations.newExclamation(e),this.gameModel.sendMessage("The VIP is escaping!"),this.vipEscaping=!0;break;case r.HumanState.attacking:e.play(),e.maxSpeed=this.maxRunSpeed}e.state=t},e.prototype.inflictBurn=function(e,t){e.flags.torchBearer&&(t.flags.burning?t.burnDamage+=this.attackDamage:(this.exclamations.newFire(t),t.burnDamage=this.attackDamage),t.flags.burning=!0)},e.prototype.burnHuman=function(e,t){e&&(e.flags.burning?e.burnDamage+=t:(e.timer.burnTick=this.burnTickTimer,e.timer.smoke=this.smokeTimer,this.exclamations.newFire(e),e.burnDamage=t),e.flags.burning=!0)},e.prototype.updatePlague=function(e,t){e.timer.plagueTick-=t,e.timer.plagueTick<0&&(this.damageHuman(e,e.plagueDamage),e.timer.plagueTick=this.plagueTickTimer,this.exclamations.newPoison(e),e.plagueTicks--,this.pandemic&&this.pandemicBullet(e),e.plagueTicks<=0&&(e.flags.infected=!1,e.plagueDamage=0))},e.prototype.pandemicBullet=function(e){for(var t=0;t<this.aliveHumans.length;t++)Math.abs(this.aliveHumans[t].x-e.x)<30&&Math.abs(this.aliveHumans[t].y-e.y)<30&&Math.random()<.3&&this.bullets.newBullet(e,this.aliveHumans[t],this.gameModel.zombieDamage/2,!0)},e.prototype.healHuman=function(e){e.health<e.maxHealth&&(e.flags.infected&&e.plagueTicks>0&&e.plagueTicks--,e.health+=2*this.attackDamage,e.health>e.maxHealth&&(e.health=e.maxHealth,e.speedMod=Math.max(Math.min(1,e.health/e.maxHealth),.25)),this.exclamations.newHealing(e))},e.prototype.doHeal=function(e,t){if(e.timer.healTick-=t,e.timer.healTick<0){e.timer.healTick=this.healTickTimer;for(var i=0;i<this.aliveHumans.length;i++)Math.abs(this.aliveHumans[i].x-e.x)<100&&Math.abs(this.aliveHumans[i].y-e.y)<100&&this.fastDistance(e.x,e.y,this.aliveHumans[i].x,this.aliveHumans[i].y)<100&&this.healHuman(this.aliveHumans[i])}},e.prototype.updateHuman=function(e,t,i){var s=this;if(e.flags.dead)return this.updateDeadHumanFading(e,t);if(e.timer.attack-=t,e.timer.scan-=t,e.timer.flee-=t,e.flags.infected&&this.updatePlague(e,t),e.flags.doctor&&this.doHeal(e,t),e.flags.burning&&this.updateBurns(e,t),(!e.zombieTarget||e.zombieTarget.flags.dead)&&e.timer.scan<0){var a=this.scanForZombies(e,i);a>0&&(e.flags.vip?e.state!==r.HumanState.escaping&&this.changeState(e,r.HumanState.escaping):Math.random()<a*this.fleeChancePerZombie?this.changeState(e,r.HumanState.fleeing):(e.target=e.zombieTarget,this.changeState(e,r.HumanState.attacking)))}switch(e.state){case r.HumanState.standing:e.timer.standing-=t,e.timer.standing<0&&(this.assignRandomTarget(e),this.changeState(e,r.HumanState.walking));break;case r.HumanState.walking:case r.HumanState.fleeing:this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.moveTargetDistance?(e.target=void 0,e.zombieTarget=void 0,this.changeState(e,r.HumanState.standing)):this.updateHumanSpeed(e,t);break;case r.HumanState.escaping:this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.moveTargetDistance?(this.smoke.newDroneCloud(e.x,e.y),e.flags.dead=!0,e.zombieTarget=void 0,e.visible=!1,this.vipText.visible=!1,this.gameModel.sendMessage("The VIP has escaped!"),this.gameModel.vipEscaped(),setTimeout((function(){s.vipEscaping=!1}),1e3)):this.updateHumanSpeed(e,t);break;case r.HumanState.attacking:e.scale.x=e.target.x>e.x?this.scaling:-this.scaling,e.zombieTarget&&!e.zombieTarget.flags.dead?this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.attackDistance?e.timer.attack<0&&(this.zombies.damageZombie(e.zombieTarget,this.attackDamage,e),this.inflictBurn(e,e.zombieTarget),e.timer.attack=this.attackSpeed):this.updateHumanSpeed(e,t):this.changeState(e,r.HumanState.standing)}},e.prototype.scanForZombies=function(e,t){e.timer.scan=this.scanTime;for(var i=0,s=0;s<t.length;s++)t[s].flags.dead||Math.abs(t[s].x-e.x)<e.visionDistance&&Math.abs(t[s].y-e.y)<e.visionDistance&&(e.zombieTarget=t[s],i++);return i},e}();t.Humans=o;var h,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.radioTime=0,t.followTimer=0,t}return a(t,e),t}(r.Human);!function(e){e[e.shooting=0]="shooting",e[e.attacking=1]="attacking",e[e.walking=2]="walking",e[e.running=3]="running",e[e.standing=4]="standing",e[e.following=5]="following",e[e.hunting=6]="hunting"}(h||(h={}));var c=function(){function e(){if(this.maxWalkSpeed=15,this.maxRunSpeed=40,this.police=[],this.discardedPolice=[],this.walkTexture=[],this.deadTexture=[],this.dogTexture=[],this.deadDogTexture=[],this.policeDogLevel=20,this.policePerLevel=1,this.attackSpeed=2,this.attackDamage=16,this.attackDistance=20,this.moveTargetDistance=5,this.shootDistance=110,this.visionDistance=150,this.scaling=2,this.dogScaling=1.3,this.radioTime=30,e.instance)return e.instance;e.instance=this}return e.prototype.isExtraPolice=function(){return(this.gameModel.level+10)%20==0},e.prototype.getMaxPolice=function(){var e=Math.min(Math.round(this.policePerLevel*this.gameModel.level),100);return this.gameModel.level<3?0:this.isExtraPolice()?Math.max(2*e,150):e},e.prototype.getMaxHealth=function(){return Math.round(1.1*this.humans.getMaxHealth(this.gameModel.level))},e.prototype.getAttackDamage=function(){this.attackDamage=Math.round(this.getMaxHealth()/10)},e.prototype.populate=function(){if(this.map=new n.ZmMap,this.gameModel=n.GameModel.getInstance(),this.humans=new o,this.exclamations=new n.Exclamations,this.zombies=new n.Zombies,this.bullets=new n.Bullets,0==this.walkTexture.length){for(var e=0;e<3;e++)this.walkTexture.push(PIXI.Texture.from("cop"+(e+1)+".png"));for(this.deadTexture=[PIXI.Texture.from("cop4.png")],e=0;e<2;e++)this.dogTexture.push(PIXI.Texture.from("dog"+(e+1)+".png"));this.deadDogTexture=[PIXI.Texture.from("dogdead.png")]}if(this.police.length>0){for(e=0;e<this.police.length;e++)n.characterContainer.removeChild(this.police[e]);this.discardedPolice=this.police.slice(),this.police=[]}var t=this.getMaxPolice(),i=this.getMaxHealth(),s=.6*i;for(this.getAttackDamage(),e=0;e<t;e++){var a=void 0;this.discardedPolice.length>0?((a=this.discardedPolice.pop()).alpha=1,a.textures=this.walkTexture):a=new l(this.walkTexture),a.reset(),a.flags.dog=!1,a.flags.dead=!1,a.flags.infected=!1,a.flags.burning=!1,a.burnDamage=0,a.plagueDamage=0,a.plagueTicks=0,a.deadTexture=this.deadTexture,a.animationSpeed=.2,a.anchor.set(35/80,1),a.currentPoi=this.map.getRandomBuilding(),a.position.copyFrom(this.map.randomPositionInBuilding(a.currentPoi)),a.zIndex=a.position.y,a.xSpeed=0,a.ySpeed=0,a.radioTime=5,a.speedMod=1,a.lastKnownBuilding=void 0,a.timer.plagueTick=Math.random()*this.humans.plagueTickTimer,a.maxSpeed=this.maxWalkSpeed,a.visionDistance=this.visionDistance,a.visible=!0,a.maxHealth=a.health=i,a.timer.scan=Math.random()*this.humans.scanTime,a.timer.standing=Math.random()*this.humans.randomSecondsToStand(),a.target=!1,a.zombieTarget=void 0,a.policeState=h.standing,a.timer.attack=this.attackSpeed,a.scale.set(Math.random()>.5?this.scaling:-1*this.scaling,this.scaling),this.police.push(a),n.characterContainer.addChild(a),this.gameModel.level>=this.policeDogLevel&&Math.random()>.5&&this.createPoliceDog(a,s)}this.isExtraPolice()&&this.gameModel.sendMessage("Warning: High Police Activity!")},e.prototype.createPoliceDog=function(e,t){var i;this.discardedPolice.length>0?((i=this.discardedPolice.pop()).alpha=1,i.textures=this.dogTexture):i=new l(this.dogTexture),i.reset(),i.owner=e,i.flags.dog=!0,i.flags.dead=!1,i.flags.infected=!1,i.flags.burning=!1,i.burnDamage=0,i.plagueDamage=0,i.plagueTicks=0,i.deadTexture=this.deadDogTexture,i.animationSpeed=.15,i.anchor.set(.5,1),i.position.set(e.position.x+3,e.position.y),i.zIndex=i.position.y,i.xSpeed=0,i.ySpeed=0,i.speedMod=1,i.lastKnownBuilding=null,i.timer.plagueTick=Math.random()*this.humans.plagueTickTimer,i.maxSpeed=this.maxRunSpeed,i.visionDistance=this.visionDistance,i.visible=!0,i.maxHealth=i.health=t,i.timer.scan=Math.random()*this.humans.scanTime,i.target=e,i.zombieTarget=null,i.policeState=h.following,i.followTimer=0,i.timer.attack=this.attackSpeed,i.scale.set(Math.random()>.5?this.dogScaling:-1*this.dogScaling,this.dogScaling),this.police.push(i),n.characterContainer.addChild(i)},e.prototype.update=function(e,t){for(var i=0,s=0;s<this.police.length;s++)this.police[s].flags.dog?this.updatePoliceDog(this.police[s],e,t):this.updatePolice(this.police[s],e,t),this.police[s].flags.dead||(this.humans.aliveHumans.push(this.police[s]),i++);this.gameModel.stats.police.count=i},e.prototype.decideStateOnZombieDistance=function(e){if(e.zombieTarget&&!e.zombieTarget.flags.dead){e.target=e.zombieTarget;var t=n.fastDistance(e.position.x,e.position.y,e.zombieTarget.x,e.zombieTarget.y);if(t>this.shootDistance)return void this.changeState(e,h.running);if(t<this.attackDistance)return void this.changeState(e,h.attacking);this.changeState(e,h.shooting)}},e.prototype.changeState=function(e,t){switch(t){case h.standing:e.gotoAndStop(0);break;case h.walking:e.play(),e.maxSpeed=this.maxWalkSpeed;break;case h.running:e.play(),e.maxSpeed=this.maxRunSpeed;break;case h.shooting:e.gotoAndStop(0);break;case h.attacking:e.play()}e.policeState=t},e.prototype.radioForBackup=function(e){for(var t=null,i=2e3,s=0;s<this.police.length;s++)if(!this.police[s].flags.dead&&!this.police[s].flags.dog&&(!this.police[s].zombieTarget||this.police[s].zombieTarget.flags.dead)){var a=n.fastDistance(e.x,e.y,this.police[s].x,this.police[s].y);a<i&&(t=this.police[s],i=a)}t&&(t.zombieTarget=e.zombieTarget,this.exclamations.newRadio(e),this.exclamations.newRadio(t),e.radioTime=this.radioTime,t.radioTime=this.radioTime)},e.prototype.updatePolice=function(e,t,i){if(e.flags.dead)return this.humans.updateDeadHumanFading(e,t);switch(e.timer.attack-=t,e.timer.scan-=t,e.radioTime-=t,e.flags.infected&&this.humans.updatePlague(e,t),e.flags.burning&&this.humans.updateBurns(e,t),(!e.zombieTarget||e.zombieTarget.flags.dead)&&e.timer.scan<0&&(this.humans.scanForZombies(e,i),e.zombieTarget&&!e.zombieTarget.flags.dead&&e.radioTime<0&&this.radioForBackup(e)),this.decideStateOnZombieDistance(e),e.policeState){case h.standing:e.timer.standing-=t,e.timer.standing<0&&(this.humans.assignRandomTarget(e),this.changeState(e,h.walking));break;case h.walking:n.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.moveTargetDistance?(e.target=!1,e.zombieTarget=null,e.timer.standing=this.humans.randomSecondsToStand(),this.changeState(e,h.standing)):this.humans.updateHumanSpeed(e,t);break;case h.running:e.zombieTarget&&!e.zombieTarget.flags.dead?e.target&&this.humans.updateHumanSpeed(e,t):this.changeState(e,h.standing);break;case h.attacking:e.zombieTarget&&!e.zombieTarget.flags.dead?(e.scale.x=e.zombieTarget.x>e.x?this.scaling:-this.scaling,e.timer.attack<0&&(this.zombies.damageZombie(e.zombieTarget,this.attackDamage,e),e.timer.attack=this.attackSpeed)):this.changeState(e,h.standing);break;case h.shooting:e.zombieTarget&&!e.zombieTarget.flags.dead?(e.scale.x=e.zombieTarget.x>e.x?this.scaling:-this.scaling,e.timer.attack<0&&(this.bullets.newBullet(e,e.zombieTarget,this.attackDamage),e.timer.attack=this.attackSpeed)):this.changeState(e,h.standing)}},e.prototype.updateDogSpeed=function(e,t){this.humans.updateHumanSpeed(e,t),Math.abs(e.xSpeed)>1&&(e.scale.x=e.xSpeed>0?this.dogScaling:-this.dogScaling)},e.prototype.updatePoliceDog=function(e,t,i){if(e.flags.dead)return this.humans.updateDeadHumanFading(e,t);switch(e.timer.attack-=t,e.timer.scan-=t,e.flags.infected&&this.humans.updatePlague(e,t),e.flags.burning&&this.humans.updateBurns(e,t),e.policeState){case h.following:if(e.owner.flags.dead){e.policeState=h.hunting,e.play();break}if(e.owner.zombieTarget&&!e.owner.zombieTarget.flags.dead){e.policeState=h.attacking,e.play(),e.target=e.owner.zombieTarget;break}e.target=e.owner,n.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.moveTargetDistance?(e.followTimer=3*Math.random(),e.gotoAndStop(0)):(e.followTimer-=t,e.followTimer<0&&(e.play(),this.updateDogSpeed(e,t)));break;case h.attacking:e.zombieTarget&&!e.zombieTarget.flags.dead?n.fastDistance(e.position.x,e.position.y,e.zombieTarget.x,e.zombieTarget.y)<this.moveTargetDistance?(e.scale.x=e.target.x>e.x?this.dogScaling:-this.dogScaling,e.timer.attack<0&&(this.zombies.damageZombie(e.zombieTarget,this.attackDamage,e),e.target.dogStun=1,e.timer.attack=this.attackSpeed)):(e.target=e.zombieTarget,this.updateDogSpeed(e,t)):e.policeState=h.following;break;case h.hunting:(!e.zombieTarget||e.zombieTarget.flags.dead)&&e.timer.scan<0&&(this.humans.scanForZombies(e,i),e.zombieTarget&&(e.policeState=h.attacking)),n.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.moveTargetDistance?(e.target={x:Math.random()*n.gameFieldSize.x,y:Math.random()*n.gameFieldSize.y},e.maxSpeed=this.maxRunSpeed):this.updateDogSpeed(e,t)}},e}();t.Police=c;var d,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minigun=!1,t.rocketlauncher=!1,t.attackingGraveyard=!1,t.shotsLeft=0,t.shotTimer=0,t}return a(t,e),t}(r.Human);!function(e){e[e.shooting=0]="shooting",e[e.attacking=1]="attacking",e[e.walking=2]="walking",e[e.running=3]="running",e[e.standing=4]="standing"}(d||(d={}));var p=function(){function e(){if(this.maxWalkSpeed=20,this.maxRunSpeed=50,this.armymen=[],this.discardedArmymen=[],this.textures=[],this.aliveZombies=[],this.armyPerLevel=.9,this.attackSpeed=2,this.attackDamage=20,this.attackDistance=25,this.moveTargetDistance=5,this.shootDistance=130,this.visionDistance=200,this.scaling=2,this.shotsPerBurst=3,this.droneStrikeTimer=0,this.droneStrikeTime=35,this.assaultStarted=!1,this.droneStrike=null,this.droneActive=!1,this.droneBlastRadius=35,e.instance)return e.instance;e.instance=this}return e.prototype.isExtraArmy=function(){return this.gameModel.level%20==0},e.prototype.getMaxArmy=function(){var e=Math.min(Math.round(this.armyPerLevel*this.gameModel.level),100);return this.gameModel.level<11?0:this.isExtraArmy()?Math.max(2*e,150):this.gameModel.isBossStage(this.gameModel.level)?Math.max(e,75):e},e.prototype.getMaxHealth=function(){return Math.round(1.2*this.humans.getMaxHealth(this.gameModel.level))},e.prototype.getAttackDamage=function(){this.attackDamage=Math.round(this.getMaxHealth()/10)},e.prototype.populate=function(){if(this.map=new n.ZmMap,this.zombies=new n.Zombies,this.humans=new o,this.gameModel=n.GameModel.getInstance(),this.graveyard=new n.Graveyard,this.bullets=new n.Bullets,this.assaultStarted=!1,this.blasts=new n.Blasts,this.exclamations=new n.Exclamations,0==this.textures.length)for(var e=0;e<3;e++){for(var t=[],i=0;i<3;i++)t.push(PIXI.Texture.from("army"+(e+1)+"_"+(i+1)+".png"));this.textures.push({animated:t,dead:[PIXI.Texture.from("army"+(e+1)+"_dead.png")]})}if(this.droneStrike&&this.droneStrike.laser&&(n.foregroundContainer.removeChild(this.droneStrike.text),n.foregroundContainer.removeChild(this.droneStrike.laser)),this.armymen.length>0){for(e=0;e<this.armymen.length;e++)n.characterContainer.removeChild(this.armymen[e]);this.discardedArmymen=this.armymen.slice(),this.armymen=[]}var s=this.getMaxArmy(),a=this.getMaxHealth();for(this.getAttackDamage(),this.droneStrike=!1,this.droneStrikeTimer=Math.random()*this.droneStrikeTime,this.droneActive=this.gameModel.level>=25,e=0;e<s;e++){var r=void 0,h=0;this.gameModel.level>35&&Math.random()<.3&&(h=1),(this.gameModel.level>45&&Math.random()<.3||this.gameModel.isBossStage(this.gameModel.level)&&Math.random()<.5)&&(h=2),this.discardedArmymen.length>0?((r=this.discardedArmymen.pop()).alpha=1,r.textures=this.textures[h].animated):r=new u(this.textures[h].animated),r.reset(),r.flags.dead=!1,r.flags.infected=!1,r.flags.burning=!1,r.burnDamage=0,r.plagueDamage=0,r.minigun=1==h,r.rocketlauncher=2==h,r.deadTexture=this.textures[h].dead,r.animationSpeed=.2,r.anchor.set(35/80,1),r.currentPoi=this.map.getRandomBuilding(),r.position.copyFrom(this.map.randomPositionInBuilding(r.currentPoi)),r.zIndex=r.position.y,r.xSpeed=0,r.ySpeed=0,r.speedMod=1,r.lastKnownBuilding=null,r.maxSpeed=this.maxWalkSpeed,r.visionDistance=this.visionDistance,r.visible=!0,r.maxHealth=r.health=a,r.timer.attack=this.attackSpeed,r.timer.plagueTick=Math.random()*this.humans.plagueTickTimer,r.timer.scan=Math.random()*this.humans.scanTime,r.timer.standing=Math.random()*this.humans.randomSecondsToStand(),r.target=!1,r.zombieTarget=null,r.graveYardTarget=null,r.armyState=d.standing,r.attackingGraveyard=!1,r.scale.set(Math.random()>.5?this.scaling:-1*this.scaling,this.scaling),this.armymen.push(r),n.characterContainer.addChild(r)}this.isExtraArmy()&&this.gameModel.sendMessage("Warning: High Military Activity!")},e.prototype.update=function(e,t){var i=0;this.aliveZombies=t,this.droneActive&&(this.droneStrikeTimer-=e);for(var s=0;s<this.armymen.length;s++)this.updateArmy(this.armymen[s],e,t),this.armymen[s].flags.dead||(this.humans.aliveHumans.push(this.armymen[s]),this.armymen[s].attackingGraveyard&&this.humans.graveyardAttackers.push(this.armymen[s]),i++);this.gameModel.stats.army.count=i,this.updateDroneStrike(e,t)},e.prototype.decideStateOnZombieDistance=function(e){var t;if(e.graveYardTarget||e.zombieTarget&&!e.zombieTarget.flags.dead){e.target=null!==(t=e.graveYardTarget)&&void 0!==t?t:e.zombieTarget;var i=n.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y);if(i>this.shootDistance&&!e.rocketlauncher)return void this.changeState(e,d.running);if(i>1.2*this.shootDistance&&e.rocketlauncher)return void this.changeState(e,d.running);if(i<this.attackDistance&&!e.graveYardTarget)return void this.changeState(e,d.attacking);this.changeState(e,d.shooting)}},e.prototype.changeState=function(e,t){switch(t){case d.standing:e.gotoAndStop(0);break;case d.walking:e.play(),e.maxSpeed=this.maxWalkSpeed;break;case d.running:e.play(),e.maxSpeed=this.maxRunSpeed;break;case d.shooting:e.gotoAndStop(0);break;case d.attacking:e.play()}e.armyState=t},e.prototype.updateArmy=function(e,t,i){var s,a;if(e.flags.dead)return this.humans.updateDeadHumanFading(e,t);switch(e.timer.attack-=t,e.timer.scan-=t,e.flags.infected&&this.humans.updatePlague(e,t),e.flags.burning&&this.humans.updateBurns(e,t),!e.graveYardTarget&&(!e.zombieTarget||e.zombieTarget.flags.dead)&&e.timer.scan<0&&(this.humans.scanForZombies(e,i)>3&&this.droneActive&&this.droneStrikeTimer<0&&this.callDroneStrike(e,i),this.assaultStarted&&e.rocketlauncher&&Math.random()>.98&&(e.graveYardTarget=this.graveyard.target,e.attackingGraveyard=!0)),this.decideStateOnZombieDistance(e),e.armyState){case d.standing:e.timer.standing-=t,e.timer.standing<0&&(this.humans.assignRandomTarget(e),this.changeState(e,d.walking));break;case d.walking:n.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.moveTargetDistance?(e.target=null,e.zombieTarget=null,e.timer.standing=this.humans.randomSecondsToStand(),this.changeState(e,d.standing)):this.humans.updateHumanSpeed(e,t);break;case d.running:e.graveYardTarget||e.zombieTarget&&!e.zombieTarget.flags.dead?(e.target=null!==(s=e.graveYardTarget)&&void 0!==s?s:e.zombieTarget,this.humans.updateHumanSpeed(e,t)):this.changeState(e,d.standing);break;case d.attacking:e.zombieTarget&&!e.zombieTarget.flags.dead?(e.scale.x=e.zombieTarget.x>e.x?this.scaling:-this.scaling,e.timer.attack<0&&(this.zombies.damageZombie(e.zombieTarget,this.attackDamage,e),e.timer.attack=this.attackSpeed)):this.changeState(e,d.standing);break;case d.shooting:e.graveYardTarget||e.zombieTarget&&!e.zombieTarget.flags.dead?(e.target=null!==(a=e.graveYardTarget)&&void 0!==a?a:e.zombieTarget,e.scale.x=e.target.x>e.x?this.scaling:-this.scaling,e.timer.attack<0&&(e.shotsLeft=this.shotsPerBurst,e.minigun&&(e.shotsLeft=3*this.shotsPerBurst),e.rocketlauncher&&(e.shotsLeft=1),e.timer.attack=e.rocketlauncher?1.5*this.attackSpeed:this.attackSpeed,e.shotTimer=0),e.shotsLeft>0&&(e.shotTimer-=t,e.shotTimer<0&&(e.shotTimer=.15,e.minigun&&(e.shotTimer=.08),this.bullets.newBullet(e,e.target,e.rocketlauncher?1.2*this.attackDamage:e.minigun?this.attackDamage/2:this.attackDamage,!1,e.rocketlauncher),e.shotsLeft--))):this.changeState(e,d.standing)}},e.prototype.callDroneStrike=function(e,t){for(var i=0,s=0;s<t.length;s++)t[s].x>e.zombieTarget.x-this.droneBlastRadius&&t[s].x<e.zombieTarget.x+this.droneBlastRadius&&t[s].y>e.zombieTarget.y-this.droneBlastRadius&&t[s].y<e.zombieTarget.y+this.droneBlastRadius&&i++;var a=0,r=this.humans.aliveHumans;for(s=0;s<r.length;s++)r[s].x>e.zombieTarget.x-this.droneBlastRadius&&r[s].x<e.zombieTarget.x+this.droneBlastRadius&&r[s].y>e.zombieTarget.y-this.droneBlastRadius&&r[s].y<e.zombieTarget.y+this.droneBlastRadius&&a++;i>1&&0==a&&(this.exclamations.newRadio(e),this.droneStrikeTimer=this.droneStrikeTime,this.droneStrike={caller:e,target:e.zombieTarget,timer:3,bombsLeft:3})},e.prototype.droneBomb=function(e){this.droneExplosion(this.droneStrike.target.x+32*(Math.random()-1),this.droneStrike.target.y+32*(Math.random()-1),e,3*this.attackDamage),this.droneStrike.timer=.3,this.droneStrike.bombsLeft--},e.prototype.droneExplosion=function(e,t,i,s){i||(i=this.aliveZombies),this.blasts.newDroneBlast(e,t);for(var a=0;a<i.length;a++)i[a].x>e-this.droneBlastRadius&&i[a].x<e+this.droneBlastRadius&&i[a].y>t-this.droneBlastRadius&&i[a].y<t+this.droneBlastRadius&&this.zombies.damageZombie(i[a],s,null)},e.prototype.updateDroneStrike=function(e,t){if(this.droneStrike){if(this.droneStrike.timer-=e,this.droneStrike.startedBombing||(this.droneStrike.text||(this.droneStrike.text=new PIXI.Text("3",{fontFamily:"sans-serif",fontSize:40,fill:"#F00",stroke:"#000",strokeThickness:0,align:"center"}),this.droneStrike.text.anchor={x:.5,y:1},this.droneStrike.text.scale.x=.5,this.droneStrike.text.scale.y=.5,n.foregroundContainer.addChild(this.droneStrike.text),this.droneStrike.laser=new PIXI.Graphics,n.foregroundContainer.addChild(this.droneStrike.laser)),this.droneStrike.text.text=Math.ceil(this.droneStrike.timer),this.droneStrike.text.x=this.droneStrike.target.x,this.droneStrike.text.y=this.droneStrike.target.y-30,this.droneStrike.laser.clear(),this.droneStrike.laser.lineStyle(1,16711680),this.droneStrike.laser.moveTo(this.droneStrike.caller.x,this.droneStrike.caller.y-10),this.droneStrike.laser.lineTo(this.droneStrike.target.x,this.droneStrike.target.y-10)),(this.droneStrike.caller.dead||this.droneStrike.target.dead)&&!this.droneStrike.startedBombing)return n.foregroundContainer.removeChild(this.droneStrike.text),n.foregroundContainer.removeChild(this.droneStrike.laser),this.droneStrike=!1,void(this.droneStrikeTimer=0);this.droneStrike.timer<0&&(this.droneStrike.startedBombing||(n.foregroundContainer.removeChild(this.droneStrike.text),n.foregroundContainer.removeChild(this.droneStrike.laser),this.droneStrike.startedBombing=!0),this.droneBomb(t),this.droneStrike.bombsLeft<=0&&(this.droneStrike=!1))}},e}();t.Army=p;var g,m,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attackingGraveyard=!1,t}return a(t,e),t}(r.Human);!function(e){e[e.shooting=0]="shooting",e[e.attacking=1]="attacking",e[e.patrolling=2]="patrolling"}(g||(g={})),function(e){e[e.horizontal=0]="horizontal",e[e.vertical=1]="vertical"}(m||(m={}));var y=function(){function e(){if(this.speed=20,this.tanks=[],this.aliveTanks=[],this.attackDamage=0,this.attackSpeed=5,this.scaling=3,this.moveTargetDistance=20,this.shootDistance=250,this.aliveZombies=null,e.instance)return e.instance;e.instance=this}return e.prototype.getMaxTanks=function(){return this.gameModel.isBossStage(this.gameModel.level)?Math.min(Math.round(this.gameModel.level/30),20):0},e.prototype.getMaxHealth=function(){return Math.round(10*this.humans.getMaxHealth(this.gameModel.level))},e.prototype.getAttackDamage=function(){this.attackDamage=Math.round(this.getMaxHealth()/10)},e.prototype.populate=function(){if(this.map=new n.ZmMap,this.gameModel=n.GameModel.getInstance(),this.zombies=new n.Zombies,this.humans=new o,this.army=new p,this.graveyard=new n.Graveyard,this.bullets=new n.Bullets,!this.textures){this.textures={vertical:[],horizontal:[],turret:null};for(var e=0;e<2;e++)this.textures.horizontal.push(PIXI.Texture.from("tank"+e+".png"));for(e=2;e<4;e++)this.textures.vertical.push(PIXI.Texture.from("tank"+e+".png"));this.textures.turret=PIXI.Texture.from("tank4.png")}if(this.tanks.length>0){for(e=0;e<this.tanks.length;e++)n.characterContainer.removeChild(this.tanks[e]);this.tanks=[],this.aliveTanks=[]}var t=this.getMaxTanks(),i=this.getMaxHealth();for(this.getAttackDamage(),e=0;e<t;e++){var s=new f(this.textures.horizontal);s.flags.tank=!0,s.turretSprite=new PIXI.Sprite(this.textures.turret),s.addChild(s.turretSprite),s.animationSpeed=.2,s.anchor.set(.5,1),s.turretSprite.anchor.set(7.5/16,7.5/16),s.x=0,s.y=0,s.play(),s.turretSprite.x=0,s.turretSprite.y=-7,s.currentDirection=m.horizontal,s.currentPoi=this.map.getRandomBuilding(),s.position.copyFrom(this.map.randomPositionInBuilding(s.currentPoi)),s.zIndex=s.position.y,s.xSpeed=0,s.ySpeed=0,s.speedMod=1,s.flags.dead=!1,s.flags.infected=!1,s.flags.burning=!1,s.burnDamage=0,s.lastKnownBuilding=null,s.plagueDamage=0,s.timer.plagueTick=Math.random()*this.humans.plagueTickTimer,s.maxSpeed=this.speed,s.visionDistance=250,s.visible=!0,s.maxHealth=s.health=i,s.timer.scan=Math.random()*this.humans.scanTime,s.target=!1,s.zombieTarget=null,s.graveYardTarget=null,s.attackingGraveyard=!1,s.tankState=g.patrolling,s.timer.attack=this.attackSpeed,s.scale.set(this.scaling,this.scaling),this.tanks.push(s),n.characterContainer.addChild(s)}},e.prototype.update=function(e,t){this.aliveZombies=t,this.aliveTanks=[];for(var i=0;i<this.tanks.length;i++)this.updateTank(this.tanks[i],e,t),this.tanks[i].flags.dead||(this.humans.aliveHumans.push(this.tanks[i]),this.aliveTanks.push(this.tanks[i]),this.tanks[i].attackingGraveyard&&this.humans.graveyardAttackers.push(this.tanks[i]))},e.prototype.updateTank=function(e,t,i){if(e.flags.dead)return this.humans.updateDeadHumanFading(e,t);switch(e.timer.attack-=t,e.timer.scan-=t,e.flags.burning&&this.humans.updateBurns(e,t),!e.attackingGraveyard&&(!e.zombieTarget||e.zombieTarget.flags.dead)&&e.timer.scan<0&&(this.humans.scanForZombies(e,i),this.army.assaultStarted&&Math.random()>.9&&(e.graveYardTarget=this.graveyard.target,e.attackingGraveyard=!0)),this.decideStateOnZombieDistance(e),e.tankState){case g.patrolling:e.target||(e.target=this.map.randomPositionInBuilding(null)),n.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)<this.moveTargetDistance?(e.target=!1,e.zombieTarget=null):this.humans.updateHumanSpeed(e,t);break;case g.attacking:e.attackingGraveyard?(e.target=e.graveYardTarget,this.humans.updateHumanSpeed(e,t)):e.zombieTarget&&!e.zombieTarget.flags.dead?this.humans.updateHumanSpeed(e,t):this.changeState(e,g.patrolling);break;case g.shooting:e.graveYardTarget||e.zombieTarget&&!e.zombieTarget.flags.dead?e.timer.attack<0&&(e.timer.attack=this.attackSpeed,this.bullets.newBullet(e,e.graveYardTarget||e.zombieTarget,this.attackDamage,!1,!0)):this.changeState(e,g.patrolling)}this.updateTankSprites(e,t)},e.prototype.updateTankSprites=function(e,t){var i;if(Math.abs(e.xSpeed)>Math.abs(e.ySpeed)?e.currentDirection!=m.horizontal&&(e.currentDirection=m.horizontal,e.textures=this.textures.horizontal,e.play(),e.turretSprite.y=-7):e.currentDirection!=m.vertical&&(e.currentDirection=m.vertical,e.textures=this.textures.vertical,e.play(),e.turretSprite.y=-8),e.graveYardTarget||e.zombieTarget){e.target=null!==(i=e.graveYardTarget)&&void 0!==i?i:e.zombieTarget;var s=Math.atan2(e.target.x-e.x,e.y-e.target.y)+Math.PI/2;e.turretSprite.rotation>s?e.turretSprite.rotation-=2*t:e.turretSprite.rotation+=2*t}},e.prototype.decideStateOnZombieDistance=function(e){var t;if(e.graveYardTarget||e.zombieTarget&&!e.zombieTarget.flags.dead){if(e.target=null!==(t=e.graveYardTarget)&&void 0!==t?t:e.zombieTarget,n.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y)>this.shootDistance)return void this.changeState(e,g.attacking);this.changeState(e,g.shooting)}},e.prototype.changeState=function(e,t){switch(t){case g.patrolling:case g.attacking:e.play();break;case g.shooting:e.gotoAndStop(0)}e.tankState=t},e}();t.Tanks=y},838:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),a=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),a(i(809),t),a(i(140),t),a(i(473),t),a(i(226),t),a(i(927),t),a(i(345),t),a(i(894),t),a(i(698),t),a(i(539),t),a(i(463),t),a(i(550),t),a(i(372),t),a(i(298),t),a(i(681),t),a(i(84),t),a(i(115),t)},927:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PartFactory=void 0;var s=i(838),a=function(){function e(){if(this.gameModel=s.GameModel.getInstance(),this.costs={blood:"blood",parts:"parts"},this.generatorsApplied=[],this.generators=[new r(1,"Simple Machine",this.costs.blood,1e6,1.08,1,2,"A simple device that produces 1 part every 2 seconds"),new r(2,"Part Duplicator",this.costs.parts,100,1.09,4,3,"A more advanced device that produces 4 parts every 3 seconds"),new r(3,"Stamp Press",this.costs.parts,1e3,1.1,16,5,"An industrial press that produces 16 parts every 5 seconds"),new r(4,"Conveyor",this.costs.parts,1e4,1.11,64,8,"A fantastic new invention that produces 64 parts every 8 seconds"),new r(5,"Splitter Combiner",this.costs.parts,1e5,1.12,192,10,"A wondrous machine that produces 192 parts every 10 seconds"),new r(6,"Batch Converter",this.costs.parts,5e5,1.13,512,12,"An astounding contraption that produces 512 parts every 12 seconds")],e.instance)return e.instance;e.instance=this}return e.prototype.factoryStats=function(){for(var e=0,t=0,i=0;i<this.generatorsApplied.length;i++)e+=this.generatorsApplied[i].rank,t+=this.generatorsApplied[i].total/this.generatorsApplied[i].time;return{machines:e,partsPerSec:t*this.gameModel.partsPCMod}},e.prototype.update=function(e){for(var t=0;t<this.generatorsApplied.length;t++)this.generatorsApplied[t].timeLeft-=e,this.generatorsApplied[t].timeLeft<0&&(this.generatorsApplied[t].timeLeft=this.generatorsApplied[t].time,this.gameModel.persistentData.parts+=this.generatorsApplied[t].total*this.gameModel.partsPCMod)},e.prototype.updateLongTime=function(e){for(var t=0,i=0;i<this.generatorsApplied.length;i++)t+=this.generatorsApplied[i].total*(e/this.generatorsApplied[i].time);return t*this.gameModel.partsPCMod},e.prototype.currentRank=function(e){for(var t=0;t<this.gameModel.persistentData.generators.length;t++){var i=this.gameModel.persistentData.generators[t];if(e.id==i.id)return i.rank}return 0},e.prototype.purchasePrice=function(e){return Math.round(e.basePrice*Math.pow(e.multi,this.currentRank(e)))},e.prototype.upgradeMaxAffordable=function(e){var t=this.currentRank(e),i=0;switch(e.costType){case this.costs.blood:i=s.getMaxUpgrades(e.basePrice,e.multi,t,this.gameModel.persistentData.blood);break;case this.costs.parts:i=s.getMaxUpgrades(e.basePrice,e.multi,t,this.gameModel.persistentData.parts)}return 0!=e.cap?Math.min(i,e.cap-t):i},e.prototype.upgradeMaxPrice=function(e,t){return s.getCostForUpgrades(e.basePrice,e.multi,this.currentRank(e),t)},e.prototype.canAffordGenerator=function(e){switch(e.costType){case this.costs.blood:return this.gameModel.persistentData.blood>=this.purchasePrice(e);case this.costs.parts:return this.gameModel.persistentData.parts>=this.purchasePrice(e)}return!1},e.prototype.purchaseMaxGenerators=function(e){for(var t=this.upgradeMaxAffordable(e),i=0;i<t;i++)this.purchaseGenerator(e,!1);this.gameModel.saveData()},e.prototype.purchaseGenerator=function(e,t){if(void 0===t&&(t=!0),this.canAffordGenerator(e)){switch(e.costType){case this.costs.blood:this.gameModel.persistentData.blood-=this.purchasePrice(e);break;case this.costs.parts:this.gameModel.persistentData.parts-=this.purchasePrice(e)}for(var i=void 0,s=0;s<this.gameModel.persistentData.generators.length;s++)e.id==this.gameModel.persistentData.generators[s].id&&(i=this.gameModel.persistentData.generators[s]).rank++;i||this.gameModel.persistentData.generators.push({id:e.id,rank:1}),t&&this.gameModel.saveData(),this.applyGenerators()}},e.prototype.applyGenerator=function(e,t){for(var i=!1,s=0;s<this.generatorsApplied.length;s++)this.generatorsApplied[s].id==e.id&&(i=!0,this.generatorsApplied[s].rank=t,this.generatorsApplied[s].total=this.generatorsApplied[s].produces*this.generatorsApplied[s].rank);i||this.generatorsApplied.push({id:e.id,produces:e.produces,total:e.produces*t,rank:t,time:e.time,timeLeft:e.time})},e.prototype.applyGenerators=function(){for(var e=0;e<this.generators.length;e++){var t=this.currentRank(this.generators[e]);t>0&&this.applyGenerator(this.generators[e],t)}},e}();t.PartFactory=a;var r=function(e,t,i,s,a,r,n,o){this.id=e,this.name=t,this.costType=i,this.basePrice=s,this.multi=a,this.produces=r,this.time=n,this.description=o,this.cap=0}},372:function(e,t,i){var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Skeleton=void 0;var r=i(5),n=i(841),o=i(838),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t}(r.Creature),l=function(){function e(){if(this.skeletons=[],this.aliveSkeletons=[],this.discardedSprites=[],this.aliveHumans=[],this.scaling=1,this.moveTargetDistance=15,this.attackDistance=25,this.attackSpeed=3,this.targetDistance=100,this.fadeSpeed=.1,this.currId=1,this.scanTime=3,this.spawnTimer=0,this.respawnTime=10,this.moveSpeed=40,this.lastKillingBlow=0,this.randomSpells=[],this.lootChance=.001,this.textures={set:!1,up:[],down:[],left:[],right:[],dead:[]},this.directions={down:1,up:2,right:3,left:4,dead:5},this.burnTickTimer=5,this.smokeTimer=.3,this.fastDistance=o.fastDistance,this.magnitude=o.magnitude,this.damageZombie=null,this.searchClosestTarget=null,this.updateBurns=null,this.updateZombieRegen=null,this.causePlagueExplosion=null,this.inflictPlague=null,this.healZombie=null,this.storageName="incremancerskele",this.persistent={xpRate:0,skeletons:0,level:1,xp:0,items:[],currItemId:0},this.aliveZombies=[],this.graveyardAttackers=[],this.lootPositions={helmet:{id:1,name:"Helmet"},chest:{id:2,name:"Chest"},legs:{id:3,name:"Legs"},gloves:{id:4,name:"Gloves"},boots:{id:5,name:"Boots"},sword:{id:6,name:"Sword"},shield:{id:7,name:"Shield"}},this.rarity={common:1,rare:2,epic:3,legendary:4},this.prefixes={commonQuality:["Wooden","Sturdy","Rigid","Iron","Rusty","Flimsy","Battered","Damaged","Used","Stained","Training"],rareQuality:["Steel","Shiny","Polished","Forged","Plated","Bronze","Reinforced","Veteran's","Reliable"],epicQuality:["Antique","Ancient","Famous","Bejeweled","Notorious","Historic","Mythical","Extraordinary"],legendaryQuality:["Monstrous","Diabolical","Withering","Terrible","Demoniacal"]},this.stats={respawnTime:{id:1,scaling:1},speed:{id:2,scaling:1},zombieHealth:{id:3,scaling:24},zombieDamage:{id:4,scaling:3},zombieSpeed:{id:5,scaling:1}},e.instance)return e.instance;e.instance=this}return e.prototype.xpForNextLevel=function(){return 1e3*Math.pow(this.persistent.level,2)},e.prototype.addXp=function(e){if(this.isAlive()&&(this.persistent.xp+=e*this.persistent.xpRate,this.persistent.xp>this.xpForNextLevel())){this.persistent.xp-=this.xpForNextLevel(),this.persistent.level++,this.upgrades.applyUpgrades(),this.model.sendMessage("Skeleton Champion reached level "+this.persistent.level+"!");var t=document.getElementById("skeleton");t&&(t.classList.toggle("levelup"),setTimeout((function(){t.classList.toggle("levelup")}),3e3))}},e.prototype.isAlive=function(){for(var e=0;e<this.skeletons.length;e++)if(!this.skeletons[e].flags.dead)return!0;return!1},e.prototype.applyUpgrades=function(){if(this.persistent.skeletons>0){this.applyItemUpgrades();var e=1+this.persistent.level/100;this.model.bloodPCMod*=e,this.model.brainsPCMod*=e,this.model.bonesPCMod*=e,this.model.partsPCMod*=e,this.model.zombieDamagePCMod*=e,this.model.zombieHealthPCMod*=e}},e.prototype.acceptOffer=function(){this.model.persistentData.trophies=[],this.persistent.skeletons<1?(this.persistent.skeletons=1,this.persistent.xpRate=1,this.model.sendMessage("Skeleton Champion joins the fight!")):this.persistent.xpRate*=2,this.upgrades.applyUpgrades(),this.model.saveData()},e.prototype.populate=function(){if(this.model=o.GameModel.getInstance(),this.map=new o.ZmMap,this.graveyard=new o.Graveyard,this.exclamations=new o.Exclamations,this.spells=new o.Spells,this.smoke=new o.Smoke,this.upgrades=new o.Upgrades,this.humans=new o.Humans,this.zombies=new o.Zombies,this.prestigePoints=new o.PrestigePoints,this.bones=new o.Bones,this.blasts=new o.Blasts,this.blood=new o.Blood,this.damageZombie=this.zombies.damageZombie,this.searchClosestTarget=this.zombies.searchClosestTarget,this.updateBurns=this.zombies.updateBurns,this.updateZombieRegen=this.zombies.updateZombieRegen,this.causePlagueExplosion=this.zombies.causePlagueExplosion,this.inflictPlague=this.zombies.inflictPlague,this.healZombie=this.zombies.healZombie,!this.textures.set){this.textures.down=[],this.textures.up=[],this.textures.right=[],this.textures.dead=[];for(var e=0;e<3;e++)this.textures.down.push(PIXI.Texture.from("skeleton"+e+".png"));for(e=3;e<6;e++)this.textures.up.push(PIXI.Texture.from("skeleton"+e+".png"));for(e=6;e<9;e++)this.textures.right.push(PIXI.Texture.from("skeleton"+e+".png"));this.textures.dead.push(PIXI.Texture.from("skeleton9.png")),this.textures.set=!0}var t=[];for(e=0;e<this.skeletons.length;e++)this.skeletons[e].flags.dead?(this.discardedSprites.push(this.skeletons[e]),o.characterContainer.removeChild(this.skeletons[e])):(t.push(this.skeletons[e]),this.skeletons[e].x=this.graveyard.sprite.x,this.skeletons[e].zIndex=this.skeletons[e].y=this.graveyard.sprite.y+(this.graveyard.level>2?8:0),this.skeletons[e].target=null,this.skeletons[e].state=r.CreatureState.lookingForTarget);this.skeletons=t,this.aliveSkeletons=[],this.lootChance=.001,this.model.level<this.persistent.level&&(this.lootChance*=.5),this.model.level>2*this.persistent.level&&(this.lootChance*=1.5)},e.prototype.spawnCreature=function(){var e;this.discardedSprites.length>0?(e=this.discardedSprites.pop()).textures=this.textures.down:e=new h(this.textures.down),e.tint=15658734,e.immuneToBurns=!1,e.bulletReflect=0,e.zombie=!0,e.textureSet=this.textures,e.deadTexture=this.textures.dead,e.currentDirection=this.directions.down,e.flags=new n.CharacterFlags,e.burnDamage=0,e.lastKnownBuilding=!1,e.alpha=1,e.animationSpeed=.15,e.anchor.set(8.5/16,1),e.position.set(this.graveyard.sprite.x,this.graveyard.sprite.y+(this.graveyard.level>2?8:0)),e.target=null,e.zIndex=e.position.y,e.visible=!0,e.maxHealth=e.health=10*this.model.zombieHealth,e.attackDamage=10*this.model.zombieDamage,e.regenTimer=5,e.state=r.CreatureState.lookingForTarget,e.scaling=this.scaling,e.scale.set(e.scaling,e.scaling),e.timer.ability=4*Math.random(),e.timer.attack=0,e.timer.scan=0,e.timer.burnTick=this.burnTickTimer,e.timer.smoke=this.smokeTimer,e.xSpeed=0,e.ySpeed=0,e.speedMultiplier=1,e.maxSpeed=this.moveSpeed,e.play(),e.zombieId=this.currId++,this.skeletons.push(e),o.characterContainer.addChild(e),this.smoke.newZombieSpawnCloud(e.x,e.y-2)},e.prototype.skeletonTimer=function(){return this.aliveSkeletons.length<this.persistent.skeletons?this.spawnTimer:0},e.prototype.update=function(e){this.aliveHumans=this.humans.aliveHumans,this.graveyardAttackers=this.humans.graveyardAttackers,this.aliveZombies=this.zombies.aliveZombies,this.aliveSkeletons=[];for(var t=0;t<this.skeletons.length;t++)this.skeletons[t].visible&&(this.updateCreature(this.skeletons[t],e),this.skeletons[t].flags.dead||(this.aliveZombies.push(this.skeletons[t]),this.aliveSkeletons.push(this.skeletons[t])));this.aliveSkeletons.length<this.persistent.skeletons&&(this.spawnTimer-=e,this.spawnTimer<0&&(this.spawnCreature(),this.spawnTimer=this.respawnTime)),this.lastKillingBlow-=e},e.prototype.updateCreature=function(e,t){if(e.flags.dead){if(!e.visible)return;return e.alpha-=this.fadeSpeed*t,void(e.alpha<0&&(e.visible=!1,o.characterContainer.removeChild(e)))}switch(e.timer.attack-=t,e.timer.scan-=t,e.timer.ability-=t,this.model.runeEffects.healthRegen>0&&this.updateZombieRegen(e,t),e.flags.burning&&!e.immuneToBurns&&this.updateBurns(e,t),e.timer.ability<0&&(e.timer.ability=4),(!e.target||e.target.flags.dead)&&e.timer.scan<0&&(e.state=r.CreatureState.lookingForTarget),e.state){case r.CreatureState.lookingForTarget:this.searchClosestTarget(e),e.target&&(e.state=r.CreatureState.movingToTarget);break;case r.CreatureState.movingToTarget:var i=this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y);if(i<this.attackDistance){e.state=r.CreatureState.attackingTarget;break}i>3*this.attackDistance&&e.timer.scan<0&&this.searchClosestTarget(e),this.updateCreatureSpeed(e,t);break;case r.CreatureState.attackingTarget:var s=this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y);if(s<this.attackDistance){if(e.timer.attack<0&&!e.target.flags.dead&&(this.humans.damageHuman(e.target,this.calculateDamage(e)),e.target.flags.dead&&this.lastKillingBlow<=0&&(this.model.addPrestigePoints(this.persistent.level),this.lastKillingBlow=20,this.prestigePoints.newPart(e.target.x,e.target.y)),e.timer.attack=this.attackSpeed*this.model.runeEffects.attackSpeed,e.flags.burning&&(e.timer.attack*=1/this.model.burningSpeedMod),this.randomSpells.length>0))for(var a=0;a<this.randomSpells.length;a++)Math.random()<.07&&this.spells.castSpellNoMana(this.randomSpells[a]);s>this.attackDistance/2&&this.updateCreatureSpeed(e,t)}else e.state=r.CreatureState.movingToTarget}},e.prototype.incinerate=function(){for(var e,t=0;t<this.skeletons.length;t++)this.skeletons[t].visible&&(e=this.skeletons[t]);if(e)for(t=0;t<this.aliveHumans.length;t++)Math.abs(this.aliveHumans[t].x-e.x)<200&&Math.abs(this.aliveHumans[t].y-e.y)<200&&this.humans.burnHuman(this.aliveHumans[t],e.attackDamage)},e.prototype.getCreatureDirection=function(e){return Math.abs(e.xSpeed)>Math.abs(e.ySpeed)?e.xSpeed<0?this.directions.left:this.directions.right:e.ySpeed<0?this.directions.up:this.directions.down},e.prototype.changeTextureDirection=function(e){var t=this.getCreatureDirection(e);if(t!==e.currentDirection){switch(t){case this.directions.up:e.textures=e.textureSet.up,e.scale.x=e.scaling;break;case this.directions.down:e.textures=e.textureSet.down,e.scale.x=e.scaling;break;case this.directions.right:e.textures=e.textureSet.right,e.scale.x=e.scaling;break;case this.directions.left:e.textures=e.textureSet.right,e.scale.x=-e.scaling}e.currentDirection=t,e.play()}},e.prototype.updateCreatureSpeed=function(e,t){if(e.timer.dogStun>0)e.timer.dogStun-=t;else{e.timer.target&&e.targetVector||(e.timer.target=0),e.timer.target-=t,e.timer.target<=0&&(e.targetVector=this.map.howDoIGetToMyTarget(e,e.target),e.timer.target=.2);var i=e.speedMultiplier*e.maxSpeed;e.xSpeed=e.targetVector.x*i,e.ySpeed=e.targetVector.y*i,e.position.x+=e.xSpeed*t,e.position.y+=e.ySpeed*t,e.zIndex=e.position.y,this.changeTextureDirection(e)}},e.prototype.calculateDamage=function(e){var t=e.attackDamage;return this.model.runeEffects.critChance>0&&Math.random()<this.model.runeEffects.critChance&&(t*=this.model.runeEffects.critDamage),t},e.prototype.applyItemUpgrades=function(){var e=this;this.model=o.GameModel.getInstance(),this.moveSpeed=40,this.respawnTime=10,this.randomSpells=[],this.persistent.items.filter((function(e){return e.q})).forEach((function(t){t.e.forEach((function(i){switch(i){case e.stats.respawnTime.id:e.respawnTime--;break;case e.stats.speed.id:e.moveSpeed++;break;case e.stats.zombieHealth.id:e.model.zombieHealth+=t.l*e.stats.zombieHealth.scaling;break;case e.stats.zombieDamage.id:e.model.zombieDamage+=t.l*e.stats.zombieDamage.scaling;break;case e.stats.zombieSpeed.id:e.model.zombieSpeed++}})),t.se&&t.se.forEach((function(t){e.randomSpells.push(t)}))}))},e.prototype.getLootName=function(e){var t="";switch(e.r){case this.rarity.common:t=this.prefixes.commonQuality[e.p];break;case this.rarity.rare:t=this.prefixes.rareQuality[e.p];break;case this.rarity.epic:t=this.prefixes.epicQuality[e.p];break;case this.rarity.legendary:t=this.prefixes.legendaryQuality[e.p]}var i="";switch(e.s){case this.lootPositions.helmet.id:i=this.lootPositions.helmet.name;break;case this.lootPositions.chest.id:i=this.lootPositions.chest.name;break;case this.lootPositions.legs.id:i=this.lootPositions.legs.name;break;case this.lootPositions.gloves.id:i=this.lootPositions.gloves.name;break;case this.lootPositions.boots.id:i=this.lootPositions.boots.name;break;case this.lootPositions.sword.id:i=this.lootPositions.sword.name;break;case this.lootPositions.shield.id:i=this.lootPositions.shield.name}return t+" "+i},e.prototype.getLootClass=function(e){switch(e.r){case this.rarity.common:return"common";case this.rarity.rare:return"rare";case this.rarity.epic:return"epic";case this.rarity.legendary:return"legendary"}},e.prototype.getLootStats=function(e){var t=[];if(e.e)for(var i=0;i<e.e.length;i++)switch(e.e[i]){case this.stats.respawnTime.id:t.push("-1 second respawn time");break;case this.stats.speed.id:t.push("+1 movement speed");break;case this.stats.zombieHealth.id:t.push("+"+o.formatWhole(this.stats.zombieHealth.scaling*e.l)+" zombie health");break;case this.stats.zombieDamage.id:t.push("+"+o.formatWhole(this.stats.zombieDamage.scaling*e.l)+" zombie damage");break;case this.stats.zombieSpeed.id:t.push("+1 zombie speed")}return t},e.prototype.getSpecialEffects=function(e){var t=[];if(e.se)for(var i=function(i){var a=s.spells.spells.filter((function(t){return t.id==e.se[i]}))[0];t.push(a.itemText||"Has a chance to cast "+a.name+" when attacking, this does not cost energy or trigger a cooldown")},s=this,a=0;a<e.se.length;a++)i(a);return t},e.prototype.testForLoot=function(){if(this.persistent.skeletons>0&&Math.random()<this.lootChance){var e=this.generateLoot(this.persistent.level);this.model.sendMessage(this.getLootName(e)+" collected!"),this.persistent.items.push(e)}},e.prototype.generateLoot=function(e){var t=Math.round(6*Math.random())+1,i=this.rarity.common,s=[];if(Math.random()<.2&&(i=this.rarity.rare,Math.random()<.2&&(i=this.rarity.epic,Math.random()<.1))){i=this.rarity.legendary;var a=o.getRandomElementFromArray(this.spells.spells,Math.random());s.push(a.id)}var r=0;switch(i){case this.rarity.common:r=Math.floor(Math.random()*this.prefixes.commonQuality.length);break;case this.rarity.rare:r=Math.floor(Math.random()*this.prefixes.rareQuality.length);break;case this.rarity.epic:r=Math.floor(Math.random()*this.prefixes.epicQuality.length);break;case this.rarity.legendary:r=Math.floor(Math.random()*this.prefixes.legendaryQuality.length)}for(var n=[Math.random()>.5?this.stats.zombieHealth.id:this.stats.zombieDamage.id],h=0;h<i-1;h++){for(var l=Math.ceil(5*Math.random());n.indexOf(l)>-1;)l=Math.ceil(5*Math.random());n.push(l)}return{id:this.persistent.currItemId++,l:e,s:t,r:i,p:r,e:n,se:s,q:!1}},e.prototype.destroyItem=function(e){this.addXp(e.l*e.r*10);for(var t=0;t<this.persistent.items.length;t++)this.persistent.items[t].id===e.id&&this.persistent.items.splice(t,1)},e.prototype.destroyAllItems=function(){this.addXp(this.xpForItems()),this.persistent.items=this.persistent.items.filter((function(e){return e.q}))},e.prototype.xpForItems=function(){var e=0;return this.persistent.items.filter((function(e){return!e.q})).forEach((function(t){e+=t.l*t.r*10})),e},e}();t.Skeleton=l},473:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Spells=void 0;var s=i(838),a=function(e,t,i,s,a,r,n,o,h){this.id=e,this.name=t,this.tooltip=i,this.itemText=s,this.cooldown=a,this.duration=r,this.energyCost=n,this.start=o,this.end=h,this.timer=0,this.onCooldown=!1,this.active=!1,this.cooldownLeft=0},r=function(){function e(){var t=this;if(this.skeleton=new s.Skeleton,this.zombies=new s.Zombies,this.humans=new s.Humans,this.spellMap=new Map,this.spells=[new a(1,"Time Warp","Speed up the flow of time for 30 seconds","",120,30,0,(function(){s.GameModel.getInstance().gameSpeed=2}),(function(){s.GameModel.getInstance().gameSpeed=1})),new a(2,"Energy Charge","5x Energy rate for 20 seconds, cost 50 energy","",180,20,50,(function(){s.GameModel.getInstance().energySpellMultiplier=5}),(function(){s.GameModel.getInstance().energySpellMultiplier=1})),new a(3,"Detonate","Explode your zombies into clouds of plague, cost 69 energy... nice","",120,3,69,(function(){(new e).zombies.detonate=!0}),(function(){(new e).zombies.detonate=!1})),new a(4,"Earth Freeze","Freeze all humans in place preventing them from moving for 15 seconds, cost 75 energy","",60,15,75,(function(){(new e).humans.frozen=!0}),(function(){(new e).humans.frozen=!1})),new a(5,"Gigazombies","For 5 seconds any zombies spawned will be giants with 10x health and attack damage, cost 100 energy","",300,5,100,(function(){(new e).zombies.super=!0}),(function(){(new e).zombies.super=!1})),new a(6,"Incinerate","Burns humans near the skeleton champion","Has a chance to cast Incinerate when attacking, burning all humans within a large radius of the Skeleon",1,10,10,(function(){(new e).skeleton.incinerate()}),(function(){})),new a(7,"Pandemic","Causes plague to spread","Has a chance to cast Pandemic when attacking, causing infected humans to spread the plague to each other for 20 seconds",10,20,10,(function(){(new e).humans.pandemic=!0}),(function(){(new e).humans.pandemic=!1}))],e.instance)return e.instance;e.instance=this,this.spells.forEach((function(e){return t.spellMap.set(e.id,e)}))}return e.prototype.lockAllSpells=function(){for(var e=0;e<this.spells.length;e++)this.spells[e].unlocked=!1},e.prototype.unlockSpell=function(e){this.spellMap.get(e).unlocked=!0},e.prototype.getSpell=function(e){return this.spellMap.get(e)},e.prototype.getUnlockedSpells=function(){return this.spells.filter((function(e){return e.unlocked}))},e.prototype.castSpell=function(e){var t=s.GameModel.getInstance();e.onCooldown||e.active||!e.unlocked||e.energyCost>t.energy||(t.energy-=e.energyCost,e.onCooldown=!0,e.cooldownLeft=e.cooldown,e.active=!0,e.timer=e.duration,e.start(),t.sendMessage(e.name))},e.prototype.castSpellNoMana=function(e){var t=this.spells.filter((function(t){return t.id==e}));if(t.length>0){var i=t[0];if(i.onCooldown||i.active)return;i.active=!0,i.timer=i.duration,i.start(),s.GameModel.getInstance().sendMessage(i.name)}},e.prototype.updateSpells=function(e){for(var t=0;t<this.spells.length;t++){var i=this.spells[t];i.onCooldown&&(i.cooldownLeft-=e,i.cooldownLeft<=0&&(i.onCooldown=!1)),i.active&&(i.timer-=e,i.timer<=0&&(i.active=!1,i.end()))}},e}();t.Spells=r},539:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Trophies=void 0;var s=i(838),a=function(){function e(){if(this.gameModel=s.GameModel.getInstance(),this.upgrades=new s.Upgrades,this.trophyStats=[{type:this.upgrades.types.health,value:50,percentage:!1},{type:this.upgrades.types.damage,value:7,percentage:!1},{type:this.upgrades.types.energyCap,value:10,percentage:!1},{type:this.upgrades.types.energyRate,value:.5,percentage:!1},{type:this.upgrades.types.boneCollectorCapacity,value:15,percentage:!1},{type:this.upgrades.types.plagueDamage,value:50,percentage:!1},{type:this.upgrades.types.bloodCap,value:5e3,percentage:!1},{type:this.upgrades.types.brainsRate,value:2,percentage:!1},{type:this.upgrades.types.zombieHealthPC,value:.02,percentage:!0},{type:this.upgrades.types.bonesRate,value:2,percentage:!1},{type:this.upgrades.types.zombieDmgPC,value:.02,percentage:!0}],e.instance)return e.instance;e.instance=this}return e.prototype.isPercentage=function(e){for(var t=0;t<this.trophyStats.length;t++)if(this.trophyStats[t].type==e)return 1==this.trophyStats[t].percentage},e.prototype.doesLevelHaveTrophy=function(e){return!(this.gameModel.persistentData.vipEscaped&&this.gameModel.persistentData.vipEscaped.indexOf(e)>-1||this.gameModel.persistentData.trophies&&this.gameModel.persistentData.trophies.indexOf(e)>-1||e%5!=0)},e.prototype.createTrophy=function(e,t,i){var s=Math.round(e/5)-1,a=Math.floor(s/this.trophyStats.length),r=this.trophyStats[s-a*this.trophyStats.length];return{level:e,type:r.type,effect:r.value*(a+1),rank:1,owned:t,escaped:i}},e.prototype.trophyAquired=function(e){this.gameModel.persistentData.trophies||(this.gameModel.persistentData.trophies=[]),-1==this.gameModel.persistentData.trophies.indexOf(e)?(this.gameModel.persistentData.trophies.push(e),this.gameModel.persistentData.trophies.sort(),this.gameModel.saveData(),this.upgrades.applyUpgrades(),window.kongregate&&window.kongregate.stats.submit("trophies",this.gameModel.persistentData.trophies.length),this.gameModel.sendMessage("The VIP has been killed! - New Trophy Aquired")):this.gameModel.sendMessage("The VIP has been killed!")},e.prototype.getTrophyList=function(){this.gameModel.persistentData.trophies||(this.gameModel.persistentData.trophies=[]),this.gameModel.persistentData.vipEscaped||(this.gameModel.persistentData.vipEscaped=[]);for(var e=[],t=this.gameModel.persistentData.allTimeHighestLevel+5,i=0;i<this.gameModel.persistentData.trophies.length;i++)this.gameModel.persistentData.trophies[i]>t&&(t=this.gameModel.persistentData.trophies[i]);for(i=5;i<=t;i+=5)e.push(this.createTrophy(i,this.gameModel.persistentData.trophies.indexOf(i)>-1,this.gameModel.persistentData.vipEscaped.indexOf(i)>-1));return e},e.prototype.getTrophyTotals=function(){for(var e=this.getTrophyList().filter((function(e){return e.owned})),t=[],i=function(i){0==t.filter((function(t){return t.type==e[i].type})).length?t.push(e[i]):s.isPercentage(e[i].type)?t.filter((function(t){return t.type==e[i].type}))[0].effect=(t.filter((function(t){return t.type==e[i].type}))[0].effect+1)*(1+e[i].effect)-1:t.filter((function(t){return t.type==e[i].type}))[0].effect+=e[i].effect},s=this,a=0;a<e.length;a++)i(a);return t},e.prototype.getAquiredTrophyList=function(){this.gameModel.persistentData.trophies||(this.gameModel.persistentData.trophies=[]);for(var e=[],t=0;t<this.gameModel.persistentData.trophies.length;t++)e.push(this.createTrophy(this.gameModel.persistentData.trophies[t],!0,!1));return e},e}();t.Trophies=a},698:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Upgrades=void 0;var s=i(838),a=function(){function e(){if(this.gameModel=s.GameModel.getInstance(),this.spells=new s.Spells,this.skeleton=new s.Skeleton,this.partFactory=new s.PartFactory,this.types={energyRate:"energyRate",energyCap:"energyCap",damage:"damage",health:"health",speed:"speed",brainsRate:"brainsRate",bonesRate:"bonesRate",bloodCap:"bloodCap",brainsCap:"brainsCap",brainRecoverChance:"brainRecoverChance",riseFromTheDeadChance:"riseFromTheDeadChance",boneCollectorCapacity:"boneCollectorCapacity",construction:"construction",infectedBite:"infectedBite",infectedBlast:"infectedBlast",plagueDamage:"plagueDamage",burningSpeedPC:"burningSpeedPC",unlockSpell:"unlockSpell",spitDistance:"spitDistance",blastHealing:"blastHealing",plagueArmor:"plagueArmor",monsterLimit:"monsterLimit",runicSyphon:"runicSyphon",gigazombies:"gigazombies",bulletproof:"bulletproof",harpySpeed:"harpySpeed",tankBuster:"tankBuster",harpyBombs:"harpyBombs",spikeDelay:"spikeDelay",bloodGainPC:"bloodGainPC",bloodStoragePC:"bloodStoragePC",brainsGainPC:"brainsGainPC",brainsStoragePC:"brainsStoragePC",bonesGainPC:"bonesGainPC",partsGainPC:"partsGainPC",zombieDmgPC:"zombieDmgPC",zombieHealthPC:"zombieHealthPC",golemHealthPC:"golemHealthPC",golemDamagePC:"golemDamagePC",startingPC:"startingPC",energyCost:"energyCost",autoconstruction:"autoconstruction",autoshop:"autoshop",graveyardHealth:"graveyardHealth"},this.costs={energy:"energy",blood:"blood",brains:"brains",bones:"bones",prestigePoints:"prestigePoints",parts:"parts"},this.constructionStates={building:"building",paused:"paused",autoPaused:"autoPaused"},this.constructionTickTimer=1,this.angularModel=null,this.runeCalculations=[{rune:"death",effect:"attackSpeed",cost:"blood",logBase:1.6,adjustment:-13,subtract:!0,cap:.8},{rune:"death",effect:"critChance",cost:"brains",logBase:1.3,adjustment:-20,cap:.8},{rune:"death",effect:"critDamage",cost:"bones",logBase:1.03,adjustment:-200,cap:0},{rune:"life",effect:"damageReduction",cost:"blood",logBase:1.5,adjustment:-15,subtract:!0,cap:.8},{rune:"life",effect:"healthRegen",cost:"brains",logBase:2.9,adjustment:-5.5,cap:.5},{rune:"life",effect:"damageReflection",cost:"bones",logBase:1.24,adjustment:-30,cap:1}],this.constructionTypes={graveyard:"graveyard",crypt:"crypt",fort:"fort",fortress:"fortress",citadel:"citadel",fence:"fence",fenceSize:"fenceSize",plagueWorkshop:"plagueWorkshop",plagueLaboratory:"plagueLaboratory",plagueSpikes:"plagueSpikes",spellTower:"spellTower",runesmith:"runesmith",aviary:"aviary",zombieCage:"zombieCage",partFactory:"partFactory",monsterFactory:"monsterFactory",pit:"pit",harpy:"harpy"},this.constructionUpgrades=[new r(201,"Cursed Graveyard",this.constructionTypes.graveyard,{blood:1800},30,1,1,1,null,"Construct a Cursed Graveyard in the town that will automatically spawn zombies when your energy is at its maximum!","Graveyard menu now available!"),new r(205,"Crypt",this.constructionTypes.crypt,{blood:21e3,bones:2220},60,1,1,1,201,"Construct a Crypt in your graveyard. This will give you a nice dark and quiet place to think. The additional space will also allow you to store 50% more blood and brains!",null),new r(206,"Bone Fort",this.constructionTypes.fort,{blood:6e4,bones:6e3,energy:60},60,1,1,1,205,"Turn your crypt into a fort. The additional space will also allow you to store 60% more blood and brains.","New upgrades are available in the shop!"),new r(207,"Bone Fortress",this.constructionTypes.fortress,{blood:1e5,bones:9e3,energy:90},60,1,1,1,206,"Turn your fort into a fortress. The additional space will also allow you to store 70% more blood and brains.",null),new r(211,"Bone Citadel",this.constructionTypes.citadel,{blood:2e5,bones:12e3,energy:120},60,1,1,1,207,"Turn your fortress into a towering citadel that looms over the town. The additional space will also allow you to store 80% more blood and brains.","New upgrades are available in the shop!"),new r(202,"Perimeter Fence",this.constructionTypes.fence,{bones:880,energy:22},44,1,1,1,201,"Build a protective fence around the graveyard that will reduce damage taken by zombies inside by 50%.",null),new r(203,"Bigger Fence",this.constructionTypes.fenceSize,{bones:880,energy:22},44,1,10,4,202,"Enlarge the fence so a greater area is protected.",null),new r(204,"Plague Workshop",this.constructionTypes.plagueWorkshop,{blood:10200,brains:600},60,1,1,1,205,"Build a laboratory to study the effects of plague. This will unlock new upgrades in the shop.","Plague upgrades now available!"),new r(208,"Plague Spikes",this.constructionTypes.plagueSpikes,{brains:3e3,bones:1e3},30,1,1,1,204,"Booby trap the area around your graveyard with cruel spikes that infect trespassing humans with the plague.",null),new r(209,"Spell Tower",this.constructionTypes.spellTower,{brains:3e3,blood:3e4},30,1,1,1,206,"Dedicate one tower of your fort to the study of spellcraft. Perhaps you can learn some new spells?","Spells now available in the shop!"),new r(210,"Runesmith",this.constructionTypes.runesmith,{bones:3e3,blood:12e4,brains:1e3},30,1,1,1,207,"Build a runesmith's workshop in order to fortify your zombies with powerful runes.",null),new r(212,"Accursed Aviary",this.constructionTypes.aviary,{bones:6e3,blood:22e4,brains:2e3},60,1,1,1,211,"Construct an aviary on top of your citadel so you can release wicked harpies to bomb the townspeople.","Harpies available for hire in the graveyard menu"),new r(213,"Zombie Cage",this.constructionTypes.zombieCage,{bones:600,blood:900},30,1,5,1,201,"Build a cage to contain surplus zombies once a town is defeated.",null),new r(214,"Second Zombie Cage",this.constructionTypes.zombieCage,{bones:1200,blood:1800},30,1,10,1,205,"Build an additional cage to contain surplus zombies once a town is defeated.",null),new r(215,"Third Zombie Cage",this.constructionTypes.zombieCage,{bones:1800,blood:2700},30,1,10,1,206,"Build an additional cage to contain surplus zombies once a town is defeated.",null),new r(216,"Fourth Zombie Cage",this.constructionTypes.zombieCage,{bones:2400,blood:3600},30,1,10,1,207,"Build an additional cage to contain surplus zombies once a town is defeated.",null),new r(217,"Fifth Zombie Cage",this.constructionTypes.zombieCage,{bones:3e3,blood:4500},30,1,15,1,211,"Build an additional cage to contain surplus zombies once a town is defeated.",null),new r(218,"Plague Laboratory",this.constructionTypes.plagueLaboratory,{brains:25e3,blood:1e6},50,1,1,1,211,"Expand the plague workshop into a well equipped laboratory in order to unlock additional plague upgrades.",null),new r(219,"Part Factory",this.constructionTypes.partFactory,{brains:35e3,blood:15e6},50,1,1,1,218,"Build a factory to create parts that can be used to construct more powerful beings for your army.","Factory menu now available!"),new r(220,"Creature Factory",this.constructionTypes.monsterFactory,{brains:45e3,blood:4e7},50,1,1,1,219,"Build a factory to turn creature parts into living entities of destruction","Creatures now available in factory menu!"),new r(221,"Bottomless Pit",this.constructionTypes.pit,{bones:75e3,parts:5e6},50,1,1,10,219,"A bottomless pit with walls made from creature parts. Drastically increases your capacity to store blood and brains.",null),new r(222,"Harpy Outfitter",this.constructionTypes.harpy,{bones:75e3,brains:75e3,blood:8e7},50,1,1,1,220,"Build an outfitter to upgrade the abilities of your harpies.","Harpy upgrades now available in the shop!")],this.upgrades=[new n(1,"Bloodthirst",this.types.damage,this.costs.blood,50,1.2,1,40,"Your zombies thirst for blood and do +1 damage for each rank of Bloodthirst.",null,null),new n(9,"Sharpened Teeth",this.types.damage,this.costs.blood,3e3,1.23,3,50,"Your zombies bites do +3 damage with each rank of Sharpened Teeth.",null,206),new n(11,"Razor Claws",this.types.damage,this.costs.blood,28e3,1.25,5,0,"Your zombies attacks do +5 damage with each rank of Razor Claws.",null,211),new n(16,"Killer Instinct",this.types.damage,this.costs.blood,1e6,1.27,8,0,"Your zombies attacks do +8 damage with each rank of Killer Instinct.",null,220),new n(2,"Like Leather",this.types.health,this.costs.blood,100,1.2,10,40,"Your zombies gain tougher skin and +10 health with each rank.",null,null),new n(10,"Thick Skull",this.types.health,this.costs.blood,5e3,1.23,25,50,"Your zombies gain +25 health with each rank.",null,206),new n(12,"Battle Hardened",this.types.health,this.costs.blood,32e3,1.25,40,0,"Your zombies gain +40 health with each rank of Battle Hardened.",null,211),new n(17,"Tough as Nails",this.types.health,this.costs.blood,1e6,1.27,100,0,"Your zombies gain +100 health with each rank of Tough as Nails.",null,220),new n(3,"Cold Storage",this.types.brainsCap,this.costs.blood,150,1.2,50,20,"Turns out you can use all of your spare blood to store brains and keep them fresh. Each rank increases your maximum brain capacity by 50.",null,null),new n(4,"Recycling is Cool",this.types.brainRecoverChance,this.costs.blood,1e3,1.2,.1,10,"Why are we wasting so many good brains on this project? Each rank increases your chance to get a brain back from a dead zombie by 10%",null,null),new n(5,"Your Soul is Mine!",this.types.riseFromTheDeadChance,this.costs.blood,1500,1.4,.1,10,"Using your most powerful blood magic you command the bodies of the dead to rise as your servants! Each rank grants 10% chance that dead humans will turn into zombies.",null,null),new n(6,"Infected Bite",this.types.infectedBite,this.costs.blood,3500,1.4,.1,10,"Your zombies are now infected with plague and could infect their victims too. Each rank adds 10% chance to inflict damage over time when a zombie attacks a target.",null,204),new n(7,"Detonate",this.types.unlockSpell,this.costs.blood,25e3,1,3,1,"Learn the Detonate spell which can explode all of your zombies into a cloud of plague. Not exactly sure how useful that will be.","New spell learned, Detonate!",209),new n(8,"Gigazombies?",this.types.unlockSpell,this.costs.blood,5e4,1,5,1,"Learn the Gigazombies spell which will turn some of your zombies into hulking monstrosities with increased health and damage.","New spell learned, Gigazombies!",209),new n(13,"Blazing Speed",this.types.burningSpeedPC,this.costs.blood,3e4,1.25,.05,10,"The humans are using torches to set your zombies on fire. Perhaps we can turn the tables on them? Each rank increases the movement and attack speed of burning zombies by 5%",null,207),new n(14,"Spit it Out",this.types.spitDistance,this.costs.blood,5e5,1.6,5,10,"The first rank gives your zombies the ability to spit plague at enemies beyond normal attack range. Spit attacks do 50% zombie damage and infect the victim with plague. Subsequent ranks will increase the range of spit attacks.",null,218),new n(15,"Runic Syphon",this.types.runicSyphon,this.costs.blood,34e3,1.9,.01,10,"Infuse your runes for free! Each rank gives your Runesmith the ability to infuse 1% of your resource income, without consuming it. Additionally when blood and brains reach their storage limit, any additional resources will be infused automatically.",null,210),new n(19,"Faster Harpies",this.types.harpySpeed,this.costs.blood,1e8,1.07,2,20,"These harpies are way too slow! We have to make them faster. Each rank increases harpy speed by 2",null,222),new n(20,"Energy Rush",this.types.energyRate,this.costs.brains,20,1.8,.5,20,"Melting brains down in your cauldron to make smoothies can be beneficial for your health. It also increases your energy rate by 0.5 per second for each rank.",null,null),new n(21,"Master Summoner",this.types.energyCap,this.costs.brains,10,1.5,5,20,"All the brains you harvested have proved fruitful in your experiments. Each rank raises your maximum energy by 5.",null,null),new n(22,"Primal Reflexes",this.types.speed,this.costs.brains,5,1.6,1,20,"The zombies retain more of their human agility increasing run speed by 1 for each rank.",null,null),new n(23,"Blood Harvest",this.types.bloodStoragePC,this.costs.brains,50,1.12,.1,0,"All this brain power has enabled you to devise some superior blood storage methods. Each rank increases your maximum blood by 10%.",null,null),new n(24,"Unholy Construction",this.types.construction,this.costs.brains,25,1,1,1,"Learn the art of Unholy Construction in order to build structures that will solidify your foothold on the town.","Construction menu now available!",null),new n(25,"Infected Corpse",this.types.infectedBlast,this.costs.brains,500,1.4,.1,10,"Fill your zombies with so much plague they are ready to explode! Each rank adds 10% chance for a zombie to explode into a cloud of plague upon death.",null,204),new n(26,"Energy Charge",this.types.unlockSpell,this.costs.brains,2e3,1,2,1,"Learn the Energy Charge spell which can drastically increase your energy rate for a short time.","New spell learned, Energy Charge!",209),new n(27,"What Doesn't Kill You",this.types.blastHealing,this.costs.brains,1e4,1.3,.1,20,"Plague explosions from zombies and harpies will also heal nearby zombies for 10% of the explosion damage with each rank.",null,218),new n(28,"One is Never Enough",this.types.monsterLimit,this.costs.brains,2e4,1.2,1,15,"We're definitely going to need more than one golem to finish the job. Each rank increases your creature limit by 1",null,220),new n(29,"Tank Buster",this.types.tankBuster,this.costs.brains,4e5,1.2,1,1,"Teach your harpies some new tricks. Once bought this upgrade will make your harpies drop fire bombs on tanks during boss stages.",null,222),new n(30,"Improved Spikes",this.types.spikeDelay,this.costs.brains,800,1.2,1,4,"Each rank reduces the delay between plague spike activation by 20%",null,208),new n(40,"Bone Throne",this.types.energyCap,this.costs.bones,50,1.55,10,15,"Sitting atop your throne of bones you can finally think clearly. Each rank increases maximum energy by 10.",null,null),new n(41,"Crown of Bones",this.types.energyRate,this.costs.bones,200,1.5,.2,25,"Not just dapper, these spikes help channel your energy. Each rank increases energy rate by 0.2 per second.",null,null),new n(42,"Bonebarrows",this.types.boneCollectorCapacity,this.costs.bones,300,1.2,5,20,"Your bone collectors are struggling to carry all these bones. Maybe it's time we gave them an upgrade? Each rank increases their carrying capacity by 5.",null,null),new n(43,"Bone Reinforced Tanks",this.types.bloodCap,this.costs.bones,500,1.07,2e3,0,"Finally! Now that we have a solid construction material we can get to work building better storage for our other resources. Each rank increases blood storage by 2000.",null,null),new n(44,"Brain Cage",this.types.brainsCap,this.costs.bones,650,1.07,500,0,"There's nothing I love more than a mind enslaved. Now we can put these brains where they belong. In cages! Each rank increases brain storage by 500.",null,null),new n(45,"Earth Freeze",this.types.unlockSpell,this.costs.bones,5e3,1,4,1,"Learn the Earth Freeze spell which can freeze all humans in place for a short time.","New spell learned, Earth Freeze!",209),new n(46,"Plague Armor",this.types.plagueArmor,this.costs.bones,15e3,1.6,.02,10,"The best defense is a good offense? True in the case of Plague Armor which reduces the damage done by infected humans by 2% per rank.",null,218),new n(47,"Bulletproof",this.types.bulletproof,this.costs.bones,6e4,1.6,.05,5,"Craft your earth golems from much harder stone. Each rank gives them 5% chance to reflect bullets back to their source.",null,220),new n(48,"Bombs Away",this.types.harpyBombs,this.costs.bones,5e5,1.6,1,3,"Upgrade your harpies so they can carry more than just one bomb at a time.",null,222),new n(60,"Extra Limbs",this.types.golemDamagePC,this.costs.parts,900,1.3,.02,0,"Your golems gain +2% damage with each rank of Extra Limbs.",null,220),new n(61,"Big Boned",this.types.golemHealthPC,this.costs.parts,1e3,1.31,.02,0,"Your golems gain +2% health with each rank of Big Boned.",null,220)],this.prestigeUpgrades=[new n(108,"A Small Investment",this.types.startingPC,this.costs.prestigePoints,10,1.25,1,0,"Each rank gives you an additional 500 blood, 50 brains, and 200 bones when starting a new level.",null,null),new n(109,"Time Warp",this.types.unlockSpell,this.costs.prestigePoints,50,1,1,1,"Unlock the Time Warp spell in order to speed up the flow of time.",null,null),new n(110,"Master of Death",this.types.energyCost,this.costs.prestigePoints,1e3,1,1,5,"Each rank reduces the energy cost of summoning a zombie by 1",null,null),new n(101,"Blood Storage",this.types.bloodStoragePC,this.costs.prestigePoints,10,1.25,.2,0,"Additional 20% blood storage for each rank.",null,null),new n(102,"Blood Rate",this.types.bloodGainPC,this.costs.prestigePoints,10,1.25,.2,0,"Additional 20% blood income rate for each rank.",null,null),new n(103,"Brain Storage",this.types.brainsStoragePC,this.costs.prestigePoints,10,1.25,.2,0,"Additional 20% brain storage for each rank.",null,null),new n(104,"Brain Rate",this.types.brainsGainPC,this.costs.prestigePoints,10,1.25,.2,0,"Additional 20% brain income rate for each rank.",null,null),new n(105,"Bone Rate",this.types.bonesGainPC,this.costs.prestigePoints,10,1.25,.2,0,"Additional 20% bones income rate for each rank.",null,null),new n(111,"Parts Rate",this.types.partsGainPC,this.costs.prestigePoints,10,1.25,.2,0,"Additional 20% creature parts income rate for each rank.",null,null),new n(112,"Auto Construction",this.types.autoconstruction,this.costs.prestigePoints,250,1,1,1,"Unlock the ability to automatically start construction of the cheapest available building option.",null,null),new n(114,"Auto Shop",this.types.autoshop,this.costs.prestigePoints,250,1,1,1,"Unlock the ability to automatically purchase items from the shop.",null,null),new n(113,"Graveyard Health",this.types.graveyardHealth,this.costs.prestigePoints,10,1.25,.1,0,"Additional 10% graveyard health during boss levels with each rank.",null,null)],e.instance)return e.instance;e.instance=this}return e.prototype.hasRequirement=function(e){return!e.requires||0!=this.gameModel.persistentData.constructions.filter((function(t){return t.id==e.requires})).length},e.prototype.getUpgrades=function(e){var t=this;switch(e){case this.costs.blood:case this.costs.brains:case this.costs.bones:case this.costs.parts:return this.upgrades.filter((function(i){return i.costType==e&&(0==i.cap||t.currentRank(i)<i.cap)&&t.hasRequirement(i)}));case"completed":return this.upgrades.filter((function(e){return e.cap>0&&t.currentRank(e)>=e.cap}))}},e.prototype.applyUpgrades=function(){var e=this;this.gameModel.resetToBaseStats(),this.spells.lockAllSpells();for(var t=function(t){var s=i.upgrades.filter((function(i){return i.id==e.gameModel.persistentData.upgrades[t].id}))[0];s||(s=i.prestigeUpgrades.filter((function(i){return i.id==e.gameModel.persistentData.upgrades[t].id}))[0]),s&&i.applyUpgrade(s,i.gameModel.persistentData.upgrades[t].rank)},i=this,a=0;a<this.gameModel.persistentData.upgrades.length;a++)t(a);for(a=0;a<this.gameModel.persistentData.constructions.length;a++)this.applyConstructionUpgrade(this.gameModel.persistentData.constructions[a]);var r=(new s.Trophies).getAquiredTrophyList();for(a=0;a<r.length;a++)this.applyUpgrade(r[a],r[a].rank);this.skeleton.applyUpgrades(),this.gameModel.bloodMax*=this.gameModel.bloodStorePCMod,this.gameModel.brainsMax*=this.gameModel.brainsStorePCMod,this.gameModel.zombieDamage*=this.gameModel.zombieDamagePCMod,this.gameModel.zombieHealth*=this.gameModel.zombieHealthPCMod,this.gameModel.persistentData.runeshatter&&(this.gameModel.zombieDamage*=this.shatterEffect(),this.gameModel.zombieHealth*=this.shatterEffect(),this.gameModel.zombieCost+=this.gameModel.persistentData.runeshatter)},e.prototype.applyUpgrade=function(e,t){switch(e.type){case this.types.energyRate:return void(this.gameModel.energyRate+=e.effect*t);case this.types.brainsRate:return void(this.gameModel.brainsRate+=e.effect*t);case this.types.bonesRate:return void(this.gameModel.bonesRate+=e.effect*t);case this.types.energyCap:return void(this.gameModel.energyMax+=e.effect*t);case this.types.bloodCap:return void(this.gameModel.bloodMax+=e.effect*t);case this.types.brainsCap:return void(this.gameModel.brainsMax+=e.effect*t);case this.types.damage:return void(this.gameModel.zombieDamage+=e.effect*t);case this.types.speed:return void(this.gameModel.zombieSpeed+=e.effect*t);case this.types.health:return void(this.gameModel.zombieHealth+=e.effect*t);case this.types.brainRecoverChance:return void(this.gameModel.brainRecoverChance+=e.effect*t);case this.types.riseFromTheDeadChance:return void(this.gameModel.riseFromTheDeadChance+=e.effect*t);case this.types.infectedBite:return void(this.gameModel.infectedBiteChance+=e.effect*t);case this.types.infectedBlast:return void(this.gameModel.infectedBlastChance+=e.effect*t);case this.types.plagueDamage:return void(this.gameModel.plagueDamageMod+=e.effect);case this.types.burningSpeedPC:return void(this.gameModel.burningSpeedMod+=e.effect*t);case this.types.construction:return void(this.gameModel.construction=1);case this.types.boneCollectorCapacity:return void(this.gameModel.boneCollectorCapacity+=e.effect*t);case this.types.unlockSpell:return void this.spells.unlockSpell(e.effect);case this.types.spitDistance:return void(this.gameModel.spitDistance=30+e.effect*t);case this.types.blastHealing:return void(this.gameModel.blastHealing+=e.effect*t);case this.types.plagueArmor:return void(this.gameModel.plagueDmgReduction-=e.effect*t);case this.types.monsterLimit:return void(this.gameModel.creatureLimit+=e.effect*t);case this.types.runicSyphon:return void(this.gameModel.runicSyphon.percentage+=e.effect*t);case this.types.bulletproof:return void(this.gameModel.bulletproofChance+=e.effect*t);case this.types.harpySpeed:return void(this.gameModel.harpySpeed+=e.effect*t);case this.types.tankBuster:return void(this.gameModel.tankBuster=!0);case this.types.harpyBombs:return void(this.gameModel.harpyBombs+=e.effect*t);case this.types.spikeDelay:return void(this.gameModel.spikeDelay-=e.effect*t);case this.types.bonesGainPC:return void(this.gameModel.bonesPCMod*=Math.pow(1+e.effect,t));case this.types.partsGainPC:return void(this.gameModel.partsPCMod*=Math.pow(1+e.effect,t));case this.types.bloodGainPC:return void(this.gameModel.bloodPCMod*=Math.pow(1+e.effect,t));case this.types.bloodStoragePC:return void(this.gameModel.bloodStorePCMod*=Math.pow(1+e.effect,t));case this.types.brainsGainPC:return void(this.gameModel.brainsPCMod*=Math.pow(1+e.effect,t));case this.types.brainsStoragePC:return void(this.gameModel.brainsStorePCMod*=Math.pow(1+e.effect,t));case this.types.zombieDmgPC:return void(this.gameModel.zombieDamagePCMod*=Math.pow(1+e.effect,t));case this.types.zombieHealthPC:return void(this.gameModel.zombieHealthPCMod*=Math.pow(1+e.effect,t));case this.types.golemDamagePC:return void(this.gameModel.golemDamagePCMod*=Math.pow(1+e.effect,t));case this.types.golemHealthPC:return void(this.gameModel.golemHealthPCMod*=Math.pow(1+e.effect,t));case this.types.startingPC:return void(this.gameModel.startingResources+=e.effect*t);case this.types.energyCost:return void(this.gameModel.zombieCost-=e.effect*t);case this.types.autoconstruction:return void(this.gameModel.autoconstructionUnlocked=!0);case this.types.autoshop:return void(this.gameModel.autoUpgrades=!0);case this.types.graveyardHealth:return void(this.gameModel.graveyardHealthMod*=Math.pow(1+e.effect,t))}},e.prototype.applyConstructionUpgrade=function(e){switch(e.type){case this.constructionTypes.graveyard:return void(this.gameModel.constructions.graveyard=1);case this.constructionTypes.crypt:return this.gameModel.constructions.crypt=1,this.gameModel.brainsStorePCMod*=1.5,void(this.gameModel.bloodStorePCMod*=1.5);case this.constructionTypes.fort:return this.gameModel.constructions.fort=1,this.gameModel.brainsStorePCMod*=1.6,void(this.gameModel.bloodStorePCMod*=1.6);case this.constructionTypes.fortress:return this.gameModel.constructions.fortress=1,this.gameModel.brainsStorePCMod*=1.7,void(this.gameModel.bloodStorePCMod*=1.7);case this.constructionTypes.citadel:return this.gameModel.constructions.citadel=1,this.gameModel.brainsStorePCMod*=1.8,void(this.gameModel.bloodStorePCMod*=1.8);case this.constructionTypes.plagueSpikes:return void(this.gameModel.constructions.plagueSpikes=1);case this.constructionTypes.fence:return void(this.gameModel.constructions.fence=1);case this.constructionTypes.fenceSize:return void(this.gameModel.fenceRadius+=e.effect*e.rank);case this.constructionTypes.pit:return this.gameModel.bloodMax+=1e6*e.rank,void(this.gameModel.brainsMax+=1e5*e.rank);case this.constructionTypes.runesmith:return this.gameModel.constructions.runesmith=1,void(this.gameModel.persistentData.runes||(this.gameModel.persistentData.runes={life:{blood:0,brains:0,bones:0},death:{blood:0,brains:0,bones:0}}));case this.constructionTypes.aviary:return void(this.gameModel.constructions.aviary=1);case this.constructionTypes.zombieCage:return void(this.gameModel.zombieCages+=e.effect*e.rank);case this.constructionTypes.partFactory:return this.gameModel.constructions.partFactory=!0,void(this.gameModel.constructions.factory=!0);case this.constructionTypes.monsterFactory:return this.gameModel.constructions.monsterFactory=!0,void(this.gameModel.constructions.factory=!0)}},e.prototype.displayStatValue=function(e){switch(e.type){case this.types.energyRate:return"Energy rate: "+s.format2Places(this.gameModel.energyRate)+" per second";case this.types.energyCap:return"Maximum energy: "+s.formatWhole(this.gameModel.energyMax);case this.types.bloodCap:return"Maximum blood: "+s.formatWhole(this.gameModel.bloodMax);case this.types.brainsCap:return"Maximum brains: "+s.formatWhole(this.gameModel.brainsMax);case this.types.damage:return"Zombie damage: "+s.formatWhole(this.gameModel.zombieDamage);case this.types.speed:return"Zombie speed: "+s.formatWhole(this.gameModel.zombieSpeed);case this.types.health:return"Zombie maximum health: "+s.formatWhole(this.gameModel.zombieHealth);case this.types.brainRecoverChance:return Math.round(100*this.gameModel.brainRecoverChance)+"% chance to recover brain";case this.types.riseFromTheDeadChance:return Math.round(100*this.gameModel.riseFromTheDeadChance)+"% chance for human corpses to turn into zombies";case this.types.infectedBite:return Math.round(100*this.gameModel.infectedBiteChance)+"% chance for zombies to infect their targets";case this.types.infectedBlast:return Math.round(100*this.gameModel.infectedBlastChance)+"% chance for zombies to explode on death";case this.types.bulletproof:return Math.round(100*this.gameModel.bulletproofChance)+"% chance for earth golems to reflect bullets";case this.types.construction:return this.gameModel.construction>0?"You have unlocked Unholy Construction":"You have yet to unlock Unholy Construction";case this.types.boneCollectorCapacity:return"Bone collector capacity: "+s.formatWhole(this.gameModel.boneCollectorCapacity);case this.types.bonesGainPC:return"Bones: "+s.formatWhole(Math.round(100*this.gameModel.bonesPCMod))+"%";case this.types.partsGainPC:return"Parts: "+s.formatWhole(Math.round(100*this.gameModel.partsPCMod))+"%";case this.types.bloodGainPC:return"Blood: "+s.formatWhole(Math.round(100*this.gameModel.bloodPCMod))+"%";case this.types.bloodStoragePC:return"Blood Storage: "+s.formatWhole(100*this.gameModel.bloodStorePCMod)+"%";case this.types.brainsGainPC:return"Brains: "+s.formatWhole(Math.round(100*this.gameModel.brainsPCMod))+"%";case this.types.brainsStoragePC:return"Brains Storage: "+s.formatWhole(100*this.gameModel.brainsStorePCMod)+"%";case this.types.zombieDmgPC:return"Zombie Damage: "+Math.round(100*this.gameModel.zombieDamagePCMod)+"%";case this.types.zombieHealthPC:return"Zombie Health: "+Math.round(100*this.gameModel.zombieHealthPCMod)+"%";case this.types.golemDamagePC:return"Golem Damage: "+Math.round(100*this.gameModel.golemDamagePCMod)+"%";case this.types.golemHealthPC:return"Golem Health: "+Math.round(100*this.gameModel.golemHealthPCMod)+"%";case this.types.startingPC:return Math.round(500*this.gameModel.startingResources)+" blood, "+Math.round(50*this.gameModel.startingResources)+" brains, "+Math.round(200*this.gameModel.startingResources)+" bones";case this.types.unlockSpell:return this.currentRank(e)>0?"You have learned this spell":"You have yet to learn this spell";case this.types.energyCost:return"Zombie Cost: "+this.gameModel.zombieCost+" energy";case this.types.burningSpeedPC:return"Burning zombie speed: "+Math.round(100*this.gameModel.burningSpeedMod)+"%";case this.types.blastHealing:return"Plague heal: "+Math.round(100*this.gameModel.blastHealing)+"%";case this.types.spitDistance:return"Zombie spit distance: "+this.gameModel.spitDistance;case this.types.plagueArmor:return"Infected damage reduction: "+Math.round(100-100*this.gameModel.plagueDmgReduction)+"%";case this.types.monsterLimit:return"Creature limit: "+this.gameModel.creatureLimit;case this.types.runicSyphon:return"Syphon amount: "+Math.round(100*this.gameModel.runicSyphon.percentage)+"%";case this.types.autoconstruction:return this.currentRank(e)>0?"You have unlocked automatic construction":"You have yet to unlock automatic construction";case this.types.autoshop:return this.currentRank(e)>0?"You have unlocked automatic shop purchases":"You have yet to unlock automatic shop purchases";case this.types.graveyardHealth:return"Graveyard health: "+Math.round(100*this.gameModel.graveyardHealthMod)+"%";case this.types.harpySpeed:return"Harpy speed: "+s.formatWhole(this.gameModel.harpySpeed);case this.types.harpyBombs:return"Harpy bombs: "+s.formatWhole(this.gameModel.harpyBombs);case this.types.tankBuster:return this.currentRank(e)>0?"You have unlocked tank buster":"You have yet to unlock tank buster";case this.types.spikeDelay:return"Current spike delay: "+(5-this.currentRank(e))+" seconds"}},e.prototype.currentRank=function(e){for(var t=0;t<this.gameModel.persistentData.upgrades.length;t++){var i=this.gameModel.persistentData.upgrades[t];if(e.id==i.id)return i.rank}return 0},e.prototype.currentRankConstruction=function(e){if(this.gameModel.persistentData.constructions)for(var t=0;t<this.gameModel.persistentData.constructions.length;t++){var i=this.gameModel.persistentData.constructions[t];if(e.id==i.id)return i.rank}return 0},e.prototype.upgradePrice=function(e){return Math.round(e.basePrice*Math.pow(e.multiplier,this.currentRank(e)))},e.prototype.upgradeMaxAffordable=function(e){var t=this.currentRank(e),i=0;switch(e.costType){case this.costs.blood:i=s.getMaxUpgrades(e.basePrice,e.multiplier,t,this.gameModel.persistentData.blood);break;case this.costs.brains:i=s.getMaxUpgrades(e.basePrice,e.multiplier,t,this.gameModel.persistentData.brains);break;case this.costs.bones:i=s.getMaxUpgrades(e.basePrice,e.multiplier,t,this.gameModel.persistentData.bones);break;case this.costs.parts:i=s.getMaxUpgrades(e.basePrice,e.multiplier,t,this.gameModel.persistentData.parts);break;case this.costs.prestigePoints:i=s.getMaxUpgrades(e.basePrice,e.multiplier,t,this.gameModel.persistentData.prestigePointsToSpend)}return 0!=e.cap?Math.min(i,e.cap-t):i},e.prototype.upgradeMaxPrice=function(e,t){return s.getCostForUpgrades(e.basePrice,e.multiplier,this.currentRank(e),t)},e.prototype.canAffordUpgrade=function(e){if(e.cap>0&&this.currentRank(e)>=e.cap)return e.auto=!1,!1;switch(e.costType){case this.costs.energy:return this.gameModel.energy>=this.upgradePrice(e);case this.costs.blood:return this.gameModel.persistentData.blood>=this.upgradePrice(e);case this.costs.brains:return this.gameModel.persistentData.brains>=this.upgradePrice(e);case this.costs.bones:return this.gameModel.persistentData.bones>=this.upgradePrice(e);case this.costs.parts:return this.gameModel.persistentData.parts>=this.upgradePrice(e);case this.costs.prestigePoints:return this.gameModel.persistentData.prestigePointsToSpend>=this.upgradePrice(e)}return!1},e.prototype.constructionLeadsTo=function(e){return this.constructionUpgrades.filter((function(t){return t.requires==e.id})).map((function(e){return e.name})).join(", ")+this.upgrades.filter((function(t){return t.requires==e.id})).map((function(e){return e.name})).join(", ")},e.prototype.purchaseMaxUpgrades=function(e){for(var t=this.upgradeMaxAffordable(e),i=0;i<t;i++)this.purchaseUpgrade(e,!1);this.gameModel.saveData()},e.prototype.purchaseUpgrade=function(e,t){if(void 0===t&&(t=!0),this.canAffordUpgrade(e)){var i=!1;switch(e.costType){case this.costs.energy:this.gameModel.energy-=this.upgradePrice(e);break;case this.costs.blood:this.gameModel.persistentData.blood-=this.upgradePrice(e);break;case this.costs.brains:this.gameModel.persistentData.brains-=this.upgradePrice(e);break;case this.costs.bones:this.gameModel.persistentData.bones-=this.upgradePrice(e);break;case this.costs.prestigePoints:i=!0,this.gameModel.persistentData.prestigePointsToSpend-=this.upgradePrice(e);break;case this.costs.parts:this.gameModel.persistentData.parts-=this.upgradePrice(e)}for(var s=void 0,a=0;a<this.gameModel.persistentData.upgrades.length;a++)if(e.id==this.gameModel.persistentData.upgrades[a].id){s=!0,this.gameModel.persistentData.upgrades[a]={id:e.id,rank:this.gameModel.persistentData.upgrades[a].rank+1},i&&(this.gameModel.persistentData.upgrades[a].costType=this.costs.prestigePoints);break}if(!s){var r={id:e.id,rank:1,costType:null};i&&(r.costType=this.costs.prestigePoints),this.gameModel.persistentData.upgrades.push(r)}t&&this.gameModel.saveData(),this.applyUpgrades(),e.purchaseMessage&&this.gameModel.sendMessage(e.purchaseMessage)}},e.prototype.consumeResources=function(e){var t=!0;return this.gameModel.persistentData.currentConstruction.shortfall={},e.energy&&e.energy>this.gameModel.energy&&(t=!1,this.gameModel.persistentData.currentConstruction.shortfall.energy=!0),e.blood&&e.blood>this.gameModel.persistentData.blood&&(t=!1,this.gameModel.persistentData.currentConstruction.shortfall.blood=!0),e.brains&&e.brains>this.gameModel.persistentData.brains&&(t=!1,this.gameModel.persistentData.currentConstruction.shortfall.brains=!0),e.bones&&e.bones>this.gameModel.persistentData.bones&&(t=!1,this.gameModel.persistentData.currentConstruction.shortfall.bones=!0),e.parts&&e.parts>this.gameModel.persistentData.parts&&(t=!1,this.gameModel.persistentData.currentConstruction.shortfall.parts=!0),!!t&&(this.gameModel.persistentData.currentConstruction.shortfall=!1,e.energy&&(this.gameModel.energy-=e.energy),e.blood&&(this.gameModel.persistentData.blood-=e.blood),e.brains&&(this.gameModel.persistentData.brains-=e.brains),e.bones&&(this.gameModel.persistentData.bones-=e.bones),e.parts&&(this.gameModel.persistentData.parts-=e.parts),!0)},e.prototype.completeConstruction=function(){for(var e,t=this,i=this.constructionUpgrades.filter((function(e){return e.id==t.gameModel.persistentData.currentConstruction.id}))[0],s=0;s<this.gameModel.persistentData.constructions.length;s++)i.id==this.gameModel.persistentData.constructions[s].id&&((e=this.gameModel.persistentData.constructions[s]).effect=i.effect,e.rank++);e||this.gameModel.persistentData.constructions.push({id:i.id,name:i.name,rank:1,type:i.type,effect:i.effect}),this.gameModel.persistentData.currentConstruction=!1,this.gameModel.saveData(),this.applyUpgrades(),this.angularModel.updateConstructionUpgrades(),this.gameModel.sendMessage("Construction of "+i.name+" complete!"),i.completeMessage&&this.gameModel.sendMessage(i.completeMessage)},e.prototype.updateAutoUpgrades=function(){if(this.gameModel.autoUpgrades){for(var e=0;e<this.upgrades.length;e++)this.upgrades[e].auto&&this.purchaseUpgrade(this.upgrades[e],!1);if(this.gameModel.constructions.factory)for(e=0;e<this.partFactory.generators.length;e++)this.partFactory.generators[e].auto&&this.partFactory.purchaseGenerator(this.partFactory.generators[e],!1)}this.gameModel.autoShatter&&this.doShatter()},e.prototype.updateConstruction=function(e){var t=this;if((this.gameModel.persistentData.currentConstruction||this.gameModel.autoconstruction)&&this.gameModel.persistentData.currentConstruction.state!=this.constructionStates.paused)if(this.gameModel.persistentData.currentConstruction)this.constructionTickTimer-=e,this.constructionTickTimer<0&&(this.constructionTickTimer=1,this.consumeResources(this.gameModel.persistentData.currentConstruction.costPerTick)?(this.gameModel.persistentData.currentConstruction.state=this.constructionStates.building,this.gameModel.persistentData.currentConstruction.timeRemaining-=1,this.gameModel.persistentData.currentConstruction.timeRemaining<=0&&this.completeConstruction()):this.gameModel.persistentData.currentConstruction.state=this.constructionStates.autoPaused);else if(this.gameModel.autoconstruction){var i=this.getAvailableConstructions();if(!i||0==i.length)return void(this.gameModel.autoconstruction=!1);for(var s=null,a=0,r=0;r<i.length;r++){var n=(i[r].costs.energy||0)+(i[r].costs.blood||0)+(i[r].costs.brains||0)+(i[r].costs.bones||0)+100*(i[r].costs.parts||0);(n<a||!s)&&(a=n,s=i[r])}s&&setTimeout((function(){return t.startConstruction(s)}))}},e.prototype.startConstruction=function(e){if(!this.gameModel.persistentData.currentConstruction){var t=this.gameModel.persistentData.blood>=(e.costs.blood||0)&&this.gameModel.persistentData.brains>=(e.costs.brains||0)&&this.gameModel.persistentData.bones>=(e.costs.bones||0)&&this.gameModel.persistentData.parts>=(e.costs.parts||0)&&this.gameModel.energy>=(e.costs.energy||0),i={energy:0,blood:0,brains:0,bones:0,parts:0};e.costs.energy&&(i.energy=e.costs.energy/(t?5:e.time)),e.costs.blood&&(i.blood=e.costs.blood/(t?5:e.time)),e.costs.brains&&(i.brains=e.costs.brains/(t?5:e.time)),e.costs.bones&&(i.bones=e.costs.bones/(t?5:e.time)),e.costs.parts&&(i.parts=e.costs.parts/(t?5:e.time)),this.gameModel.persistentData.currentConstruction={state:this.constructionStates.building,name:e.name,id:e.id,timeRemaining:t?5:e.time,time:t?5:e.time,costPerTick:i}}},e.prototype.playPauseConstruction=function(){this.gameModel.persistentData.currentConstruction&&(this.gameModel.persistentData.currentConstruction.state==this.constructionStates.paused?this.gameModel.persistentData.currentConstruction.state=this.constructionStates.building:this.gameModel.persistentData.currentConstruction.state=this.constructionStates.paused)},e.prototype.cancelConstruction=function(){this.gameModel.persistentData.currentConstruction=!1},e.prototype.constructionAvailable=function(e){return!(this.gameModel.persistentData.currentConstruction&&this.gameModel.persistentData.currentConstruction.id==e.id||this.currentRankConstruction(e)>=e.cap||e.requires&&0==this.gameModel.persistentData.constructions.filter((function(t){return t.id==e.requires})).length)},e.prototype.constructionComplete=function(e){return this.currentRankConstruction(e)>=e.cap},e.prototype.getAvailableConstructions=function(){var e=this;return this.constructionUpgrades.filter((function(t){return e.constructionAvailable(t)}))},e.prototype.getCompletedConstructions=function(){var e=this;return this.constructionUpgrades.filter((function(t){return e.constructionComplete(t)}))},e.prototype.upgradeIdCheck=function(){var e=[];this.upgrades.forEach((function(t){e[t.id]&&console.error("ID "+t.id+" already used"),e[t.id]=!0})),this.prestigeUpgrades.forEach((function(t){e[t.id]&&console.error("ID "+t.id+" already used"),e[t.id]=!0})),this.constructionUpgrades.forEach((function(t){e[t.id]&&console.error("ID "+t.id+" already used"),e[t.id]=!0}))},e.prototype.updateRunicSyphon=function(e){e.percentage>0&&(this.gameModel.persistentData.runes.life.blood+=e.blood/2,this.gameModel.persistentData.runes.death.blood+=e.blood/2,this.gameModel.persistentData.runes.life.brains+=e.brains/2,this.gameModel.persistentData.runes.death.brains+=e.brains/2,this.gameModel.persistentData.runes.life.bones+=e.bones/2,this.gameModel.persistentData.runes.death.bones+=e.bones/2,e.blood=0,e.brains=0,e.bones=0,this.updateRuneEffects())},e.prototype.shatterPercent=function(e){var t=1e8*Math.pow(1.5,this.gameModel.persistentData.runeshatter);return Math.floor(100*Math.min(1,e.blood/t))},e.prototype.shatterBloodCost=function(e){return Math.max(0,1e8*Math.pow(1.5,this.gameModel.persistentData.runeshatter)-e.blood)},e.prototype.shatterEffect=function(){return Math.pow(1.1,this.gameModel.persistentData.runeshatter)},e.prototype.canShatter=function(){return!!this.gameModel.persistentData.runes&&this.shatterPercent(this.gameModel.persistentData.runes.life)+this.shatterPercent(this.gameModel.persistentData.runes.death)==200},e.prototype.doShatter=function(){this.canShatter()&&(this.gameModel.persistentData.runeshatter++,this.gameModel.persistentData.runes.life.blood=0,this.gameModel.persistentData.runes.death.blood=0,this.gameModel.persistentData.runes.life.brains=0,this.gameModel.persistentData.runes.death.brains=0,this.gameModel.persistentData.runes.life.bones=0,this.gameModel.persistentData.runes.death.bones=0,this.updateRuneEffects(),this.applyUpgrades())},e.prototype.infuseRune=function(e,t,i){var s="life"==e?this.gameModel.persistentData.runes.life:this.gameModel.persistentData.runes.death;switch(t){case"blood":this.gameModel.persistentData.blood>=i&&(s.blood+=i,this.gameModel.persistentData.blood-=i);break;case"brains":this.gameModel.persistentData.brains>=i&&(s.brains+=i,this.gameModel.persistentData.brains-=i);break;case"bones":this.gameModel.persistentData.bones>=i&&(s.bones+=i,this.gameModel.persistentData.bones-=i)}this.updateRuneEffects()},e.prototype.updateRuneEffects=function(){if(this.gameModel.persistentData.runes){for(var e={attackSpeed:1,critChance:0,critDamage:0,damageReduction:1,healthRegen:0,damageReflection:0},t=0;t<this.runeCalculations.length;t++){var i=this.runeCalculations[t],s=this.gameModel.persistentData.runes[i.rune][i.cost];if(s>0){var a=(Math.log(s)/Math.log(i.logBase)+i.adjustment)/100;a>0&&(i.cap&&a>i.cap&&(a=i.cap),i.subtract?e[i.effect]-=a:e[i.effect]+=a)}}this.gameModel.runeEffects=e}},e}();t.Upgrades=a;var r=function(e,t,i,s,a,r,n,o,h,l,c){this.id=e,this.name=t,this.type=i,this.costs=s,this.time=a,this.multiplier=r,this.effect=n,this.cap=o,this.requires=h,this.description=l,this.completeMessage=c},n=function(e,t,i,s,a,r,n,o,h,l,c){this.id=e,this.name=t,this.type=i,this.costType=s,this.basePrice=a,this.multiplier=r,this.effect=n,this.cap=o,this.description=h,this.rank=1,this.purchaseMessage=l,this.requires=c}},809:(e,t)=>{function i(e,t){return e||(e=0),e>=1e15?e.toExponential(t).replace("+",""):e>=1e12?(e/1e12).toFixed(t)+"T":e>=1e9?(e/1e9).toFixed(t)+"B":e>=1e6?(e/1e6).toFixed(t)+"M":e>=1e3?(e/1e3).toFixed(t)+"K":e.toFixed(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.moveToolTip=t.getCostForUpgrades=t.getMaxUpgrades=t.formatNumber=t.formatWhole=t.format2Places=t.rgbToHex=t.getRandomElementFromArray=t.RotateVector2d=t.fastDistance=t.distanceBetweenPoints=t.magnitude=void 0,t.magnitude=function(e,t){return Math.sqrt(e*e+t*t)},t.distanceBetweenPoints=function(e,t,i,s){return Math.sqrt((e-i)*(e-i)+(t-s)*(t-s))},t.fastDistance=function(e,t,i,s){var a=Math.abs(e-i),r=Math.abs(t-s);return.4*(a+r)+.56*Math.max(a,r)},t.RotateVector2d=function(e,t,i){return{x:e*Math.cos(i)-t*Math.sin(i),y:e*Math.sin(i)+t*Math.cos(i)}},t.getRandomElementFromArray=function(e,t){return e[Math.floor(t*e.length)]},t.rgbToHex=function(e,t,i){return i|t<<8|e<<16},t.format2Places=function(e){return i(e,2)},t.formatWhole=function(e){return i(e,e>1e3?2:0)},t.formatNumber=i,t.getMaxUpgrades=function(e,t,i,s){return 1==t?Math.floor(s/e):Math.floor(Math.log(s*(t-1)/(e*Math.pow(t,i))+1)/Math.log(t))},t.getCostForUpgrades=function(e,t,i,s){return 1==t?e*s:e*(Math.pow(t,i)*(Math.pow(t,s)-1)/(t-1))},t.moveToolTip=function(e,t){var i=document.getElementById("champ-hold").getBoundingClientRect(),s=e.clientX-i.x,a=e.clientY-i.y;t.getElementsByClassName("tooltip")[0].style.top=a+20+"px",t.getElementsByClassName("tooltip")[0].style.left=s+20+"px"}},226:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ZmMap=void 0;var s=i(841),a=i(838),r=i(809),n=function(){function e(){if(this.gameModel=a.GameModel.getInstance(),this.humans=new a.Humans,this.buildings=[],this.buildingsByPopularity=[],this.buildingMap=[],this.roadSprite=null,this.roadTexture=null,this.entranceWidth=16,this.entranceDepth=16,this.cornerDistance=16,this.minBuildings=3,this.wallWidth=4,this.graveyardCollision=null,this.graveYardLocation={x:0,y:0},this.graveYardPosition=null,this.wallCollisionBuffer=3,this.fastDistance=a.fastDistance,this.pathFindStepSize=5,this.dx=0,this.dy=0,this.stepsToTake=10,this.hasHit=!1,this.vector=null,this.corner=null,this.hitbuilding=!1,this.insideBuilding=!1,this.treeSprites=[],this.treeTextures=[],this.armyTextures=[],e.instance)return e.instance;e.instance=this}return e.prototype.getRandomBuilding=function(){return a.getRandomElementFromArray(this.buildingsByPopularity,Math.random())},e.prototype.roomNoOverlap=function(e,t){return e.x>t.x+t.width+50||e.x+e.width+50<t.x||e.y>t.y+t.height+50||e.y+e.height+50<t.y||void 0},e.prototype.isValidPosition=function(e){if(!this.roomNoOverlap(e,this.graveYardPosition))return!1;for(var t=0;t<this.buildings.length;t++)if(!this.roomNoOverlap(e,this.buildings[t]))return!1;return!(this.gameModel.level%5==0&&!this.gameModel.isBossStage(this.gameModel.level)&&e.y<this.roadSprite.y+this.roadSprite.height/2&&e.y+e.height>this.roadSprite.y-this.roadSprite.height/2)},e.prototype.makeHorizontalWall=function(e,t,i,a,r,n){if(i){var o=new s.Wall(t);o.x=a,o.y=r,o.width=n/2-this.entranceWidth,o.height=4,e.push(o);var h=new s.Wall(t);h.x=a+n/2+this.entranceWidth,h.y=r,h.width=n/2-this.entranceWidth,h.height=4,e.push(h)}else{var l=new s.Wall(t);l.x=a,l.y=r,l.width=n,l.height=4,e.push(l)}},e.prototype.makeVerticalWall=function(e,t,i,a,r,n){if(i){var o=new s.Wall(t);o.x=a,o.y=r,o.width=4,o.height=n/2-this.entranceWidth,e.push(o);var h=new s.Wall(t);h.x=a,h.y=r+n/2+this.entranceWidth,h.width=4,h.height=n/2-this.entranceWidth,e.push(h)}else{var l=new s.Wall(t);l.x=a,l.y=r,l.width=4,l.height=n,e.push(l)}},e.prototype.addBuilding=function(e){e.container=new PIXI.Container,e.floorSprite=new PIXI.TilingSprite(PIXI.Texture.WHITE),e.floorSprite.tint=a.rgbToHex(10+Math.round(50*Math.random()),10+Math.round(50*Math.random()),10+Math.round(50*Math.random())),e.floorSprite.alpha=.2,e.container.x=e.x,e.container.y=e.y,e.floorSprite.width=e.width,e.floorSprite.height=e.height,e.container.addChild(e.floorSprite);for(var t,i=[{x:e.x+e.width/2,y:e.y,north:!0,inside:{x:e.x+e.width/2,y:e.y+this.entranceDepth,entrance:!0},outside:{x:e.x+e.width/2,y:e.y-this.entranceDepth,entrance:!0}},{x:e.x+e.width/2,y:e.y+e.height,south:!0,inside:{x:e.x+e.width/2,y:e.y+e.height-this.entranceDepth,entrance:!0},outside:{x:e.x+e.width/2,y:e.y+e.height+this.entranceDepth,entrance:!0}},{x:e.x,y:e.y+e.height/2,west:!0,inside:{x:e.x+this.entranceDepth,y:e.y+e.height/2,entrance:!0},outside:{x:e.x-this.entranceDepth,y:e.y+e.height/2,entrance:!0}},{x:e.x+e.width,y:e.y+e.height/2,east:!0,inside:{x:e.x+e.width-this.entranceDepth,y:e.y+e.height/2,entrance:!0},outside:{x:e.x+e.width+this.entranceDepth,y:e.y+e.height/2,entrance:!0}}],s={x:a.gameFieldSize.x/2,y:a.gameFieldSize.y/2},r=2e3,n=0;n<i.length;n++){var o=a.fastDistance(i[n].x,i[n].y,s.x,s.y);o<r&&(r=o,t=i[n])}e.entrance=t,this.gameModel.level%5==0&&(e.y<a.gameFieldSize.y/2?e.entrance=i.filter((function(e){return e.south}))[0]:e.entrance=i.filter((function(e){return e.north}))[0]),e.walls=[];var h=a.getRandomElementFromArray(this.buildingTextures,Math.random());for(this.makeHorizontalWall(e.walls,h,e.entrance.north,-4,-4,e.width+8),this.makeHorizontalWall(e.walls,h,e.entrance.south,-4,e.height,e.width+8),this.makeVerticalWall(e.walls,h,e.entrance.west,-4,-4,e.height+8),this.makeVerticalWall(e.walls,h,e.entrance.east,e.width,-4,e.height+8),n=0;n<e.walls.length;n++)e.container.addChild(e.walls[n]);for(e.container.cacheAsBitmap=!0,a.backgroundContainer.addChild(e.container),n=0;n<e.walls.length;n++)e.walls[n].collisionX=e.x+e.walls[n].x,e.walls[n].collisionY=e.y+e.walls[n].y,e.walls[n].collisionWidth=e.walls[n].width,e.walls[n].collisionHeight=e.walls[n].height},e.prototype.addCorners=function(e){e.corners=[],e.corners.push({x:e.x-this.cornerDistance,y:e.y-this.cornerDistance}),e.corners.push({x:e.x+e.width+this.cornerDistance,y:e.y-this.cornerDistance}),e.corners.push({x:e.x-this.cornerDistance,y:e.y+e.height+this.cornerDistance}),e.corners.push({x:e.x+e.width+this.cornerDistance,y:e.y+e.height+this.cornerDistance})},e.prototype.setGraveyardPosition=function(){this.gameModel.level%5!=0||this.gameModel.isBossStage(this.gameModel.level)?this.graveYardPosition={x:a.gameFieldSize.x/2-50,y:a.gameFieldSize.y/2-50,width:100,height:100}:this.graveYardPosition={x:Math.random()*a.gameFieldSize.x*.8-50+.1*a.gameFieldSize.x,y:(Math.random()>.5?.25*a.gameFieldSize.y:.75*a.gameFieldSize.y)-50,width:100,height:100},this.graveYardLocation={x:this.graveYardPosition.x+50,y:this.graveYardPosition.y+50}},e.prototype.populatePois=function(){if(this.setGraveyardPosition(),!this.buildingTextures){this.buildingTextures=[];for(var e=0;e<2;e++)this.buildingTextures.push(PIXI.Texture.from("floor"+(e+1)+".png"));for(e=0;e<2;e++)this.buildingTextures.push(PIXI.Texture.from("wall"+(e+1)+".png"));this.roadSprite=new PIXI.TilingSprite(PIXI.Texture.from("road.png")),this.roadSprite.width=a.gameFieldSize.x,this.roadSprite.tileScale.set(3,3),this.roadSprite.height=96,a.backgroundContainer.addChild(this.roadSprite),this.roadSprite.visible=!1,this.roadSprite.anchor.set(.5,.5)}if(this.buildings.length>0)for(e=0;e<this.buildings.length;e++){a.backgroundContainer.removeChild(this.buildings[e].container),this.buildings[e].container.destroy();for(var t=0;t<this.buildings[e].walls.length;t++);}var i=1;this.buildingsByPopularity=[],this.buildings=[];var r=this.minBuildings,n=this.humans.getMaxHumans(),o=Math.max(Math.min(50,Math.round(n/3)),10);for(this.roadSprite.visible=!1,this.gameModel.isBossStage(this.gameModel.level)?(n=0,r=0):this.gameModel.level%5==0&&(this.roadSprite.visible=!0,this.roadSprite.width=a.gameFieldSize.x,this.roadSprite.x=a.gameFieldSize.x/2,this.roadSprite.y=a.gameFieldSize.y/2);n>0||r>0;){r--;var h=Math.round(5+Math.random()*(o-5)),l=Math.sqrt(500*h);n-=h;for(var c=!1,d=void 0,u=1e3;!c&&u>0;)u--,d=this.gameModel.level%5==0?Math.random()>.7?{x:10+Math.random()*(a.gameFieldSize.x-(20+l)),y:10+Math.random()*(a.gameFieldSize.y-(20+l)),width:l,height:l}:{x:10+Math.random()*(a.gameFieldSize.x-(20+l)),y:Math.random()>.5?a.gameFieldSize.y/2+this.roadSprite.height/2+8:a.gameFieldSize.y/2-this.roadSprite.height/2-8-l,width:l,height:l}:{x:10+Math.random()*(a.gameFieldSize.x-(20+l)),y:10+Math.random()*(a.gameFieldSize.y-(20+l)),width:l,height:l},c=this.isValidPosition(d);if(c){var p=new s.Building(i++,d.x,d.y,l,l);this.addBuilding(p);var g=Math.max(Math.round(l/10),1);for(t=0;t<g;t++)this.buildingsByPopularity.push(p);this.buildings.push(p),this.addCorners(p)}}this.populateBuildingMap(),this.populateTrees()},e.prototype.populateBuildingMap=function(){if(this.buildingMap=[],this.mapCols=Math.ceil(a.gameFieldSize.x/10),this.mapRows=Math.ceil(a.gameFieldSize.y/10),0!=this.buildings.length)for(var e=0;e<this.mapRows;e++)for(var t=10*e,i=0;i<this.mapCols;i++){for(var s=10*i,n=1e4,o=void 0,h=0;h<this.buildings.length;h++){var l=this.buildings[h],c=r.distanceBetweenPoints(s,t,l.x+l.width/2,l.y+l.height/2)-l.width/2;c<n&&(n=c,o=l)}this.buildingMap[e*this.mapCols+i]=o}},e.prototype.getBuildingFromMap=function(e,t){return this.buildingMap[Math.round(t/10)*this.mapCols+Math.round(e/10)]},e.prototype.randomPositionInBuilding=function(e){if(!e){var t=Math.random()>.5?-1:1,i=Math.random()>.5?-1:1,s=a.gameFieldSize.x/4,r=a.gameFieldSize.y/4;return Math.random()>.5?{x:Math.random()*a.gameFieldSize.x,y:a.gameFieldSize.y/2+i*r+Math.random()*i*r}:{x:a.gameFieldSize.x/2+t*s+Math.random()*t*s,y:Math.random()*a.gameFieldSize.y}}return{x:e.x+5+Math.random()*(e.width-10),y:e.y+5+Math.random()*(e.height-10)}},e.prototype.isInsidePoi=function(e,t,i,s){return void 0===s&&(s=0),e>i.x-s&&e<i.x+i.width+s&&t>i.y-s&&t<i.y+i.height+s},e.prototype.checkWall=function(e,t,i,s){t.y>e.collisionY&&t.y<e.collisionY+e.collisionHeight&&(t.x<e.collisionX-this.wallCollisionBuffer&&i.x>e.collisionX-this.wallCollisionBuffer&&(s.x=!0,s.validX=e.collisionX-this.wallCollisionBuffer-1),t.x>e.collisionX+e.collisionWidth+this.wallCollisionBuffer&&i.x<e.collisionX+e.collisionWidth+this.wallCollisionBuffer&&(s.x=!0,s.validX=e.collisionX+e.collisionWidth+this.wallCollisionBuffer+1)),t.x>e.collisionX&&t.x<e.collisionX+e.collisionWidth&&(t.y<e.collisionY-this.wallCollisionBuffer&&i.y>e.collisionY-this.wallCollisionBuffer&&(s.y=!0,s.validY=e.collisionY-this.wallCollisionBuffer-1),t.y>e.collisionY+e.collisionHeight+this.wallCollisionBuffer&&i.y<e.collisionY+e.collisionHeight+this.wallCollisionBuffer&&(s.y=!0,s.validY=e.collisionY+e.collisionHeight+this.wallCollisionBuffer+1))},e.prototype.checkGraveyard=function(e,t){var i=new o;return this.graveyardCollision&&this.checkWall(this.graveyardCollision,e,t,i),i.x||i.y?i:null},e.prototype.checkCollisions=function(e,t){var i=this.findBuilding(e);if(!i)return this.checkGraveyard(e,t);for(var s=new o,a=0;a<i.walls.length;a++)this.checkWall(i.walls[a],e,t,s);return s},e.prototype.pathStepCalc=function(e,t){var i=t.x-e.x,s=t.y-e.y,a=Math.abs(i),r=Math.abs(s);if(0!=Math.max(a,r)){var n=1/Math.max(a,r);return{x:i*(n*=1.29289-(a+r)*n*.29289)*this.pathFindStepSize,y:s*n*this.pathFindStepSize}}},e.prototype.isBuildingClose=function(e,t){return e.x>t.x-this.cornerDistance&&e.x<t.x+t.width+this.cornerDistance&&e.y>t.y-this.cornerDistance&&e.y<t.y+t.height+this.cornerDistance},e.prototype.findBuilding=function(e){return this.getBuildingFromMap(e.x,e.y)},e.prototype.normalizeVector=function(e){if(0==e.x&&0==e.y)return e;var t=Math.sqrt(e.x*e.x+e.y*e.y);return e.x/=t,e.y/=t,e},e.prototype.modifyVectorForCollision=function(e,t,i){if(!t&&!this.graveyardCollision)return this.normalizeVector(e);var s=new o,a={x:i.x+(e.x>0?1:-1),y:i.y+(e.y>0?1:-1)};if(t)for(var r=0;r<t.walls.length;r++)this.checkWall(t.walls[r],i,a,s);return this.graveyardCollision&&this.checkWall(this.graveyardCollision,i,a,s),s.x&&(e.x=0),s.y&&(e.y=0),this.normalizeVector(e)},e.prototype.willVectorHitBuilding=function(e,t,i){if(this.dx=t.x-e.x,this.dy=t.y-e.y,this.dx<0&&e.x<i.x-4)return!1;if(this.dx>0&&e.x>i.x+i.width+4)return!1;if(this.dy<0&&e.y<i.y-4)return!1;if(this.dy>0&&e.y>i.y+i.width+4)return!1;for(this.step=this.pathStepCalc(e,t),this.stepsToTake=10,this.hasHit=!1,this.testPosition={x:e.x,y:e.y};!this.hasHit&&this.stepsToTake>0;)this.stepsToTake--,this.testPosition.x+=this.step.x,this.testPosition.y+=this.step.y,this.isInsidePoi(this.testPosition.x,this.testPosition.y,i,4)&&(this.hasHit=!0);return this.hasHit},e.prototype.findNearestCorner=function(e,t){for(var i=null,s=1e4,a=0;a<t.length;a++){var r=this.fastDistance(e.x,e.y,t[a].x,t[a].y);r<s&&(s=r,i=t[a])}return i},e.prototype.findAdjacentCorners=function(e,t){for(var i=[],s=0;s<t.corners.length;s++)t.corners[s].x!=e.x&&t.corners[s].y!=e.y||i.push(t.corners[s]);return i},e.prototype.navigateAroundBuilding=function(e,t,i,s){return this.vector={x:t.x-e.x,y:t.y-e.y,distance:s},i?(this.hitbuilding=this.willVectorHitBuilding(e,t,i),this.hitbuilding?(this.corner=this.findNearestCorner(t,i.corners),this.hitbuilding=this.willVectorHitBuilding(e,this.corner,i),this.hitbuilding?(this.corner=this.findNearestCorner(e,this.findAdjacentCorners(this.corner,i)),this.vector.x=this.corner.x-e.x,this.vector.y=this.corner.y-e.y,this.modifyVectorForCollision(this.vector,i,e)):(this.vector.x=this.corner.x-e.x,this.vector.y=this.corner.y-e.y,this.modifyVectorForCollision(this.vector,i,e))):this.modifyVectorForCollision(this.vector,i,e)):this.normalizeVector(this.vector)},e.prototype.howDoIGetToMyTarget=function(e,t){if(this.distanceToTarget=this.fastDistance(e.x,e.y,t.x,t.y),this.closeBuilding=this.findBuilding(e),this.insideBuilding=!1,this.closeBuilding&&(this.insideBuilding=this.isInsidePoi(e.x,e.y,this.closeBuilding,0),this.insideBuilding))return this.isInsidePoi(t.x,t.y,this.closeBuilding,0)?this.modifyVectorForCollision({x:t.x-e.x,y:t.y-e.y},this.closeBuilding,e):this.modifyVectorForCollision({x:this.closeBuilding.entrance.outside.x-e.x,y:this.closeBuilding.entrance.outside.y-e.y},this.closeBuilding,e);var i=this.findBuilding(t);return i&&(this.insideBuilding=this.isInsidePoi(t.x,t.y,i,0),this.insideBuilding)?this.fastDistance(e.x,e.y,i.entrance.outside.x,i.entrance.outside.y)<30?this.modifyVectorForCollision({x:i.entrance.inside.x-e.x,y:i.entrance.inside.y-e.y},this.closeBuilding,e):this.navigateAroundBuilding(e,i.entrance.outside,this.closeBuilding,this.distanceToTarget):this.distanceToTarget<20?this.modifyVectorForCollision({x:t.x-e.x,y:t.y-e.y},this.closeBuilding,e):this.navigateAroundBuilding(e,t,this.closeBuilding,this.distanceToTarget)},e.prototype.isValidTreePosition=function(e){if(!this.isValidPosition(e))return!1;for(var t=0;t<this.treeSprites.length;t++)if(this.fastDistance(e.x,e.y,this.treeSprites[t].x,this.treeSprites[t].y)<25)return!1;return!0},e.prototype.populateTrees=function(){if(this.treeSprites.length>0){for(var e=0;e<this.treeSprites.length;e++)a.characterContainer.removeChild(this.treeSprites[e]);this.treeSprites=[]}if(0==this.treeTextures.length){for(e=0;e<6;e++)this.treeTextures.push(PIXI.Texture.from("tree"+e+".png"));this.armyTextures.push(PIXI.Texture.from("hedgehog.png")),this.armyTextures.push(PIXI.Texture.from("sandbags.png"))}var t=Math.round(a.gameFieldSize.x/50);for(this.gameModel.isBossStage(this.gameModel.level)&&(t=Math.round(1.5*t));t>0;){for(var i=!1,s=void 0,r=1e3;!i&&r>0;)r--,s={x:8+Math.random()*(a.gameFieldSize.x-16),y:8+Math.random()*(a.gameFieldSize.y-16),width:2,height:2},i=this.isValidTreePosition(s);if(i){var n=.4+.6*Math.random();this.gameModel.constructions.graveyard&&(n=Math.min((this.fastDistance(s.x,s.y,this.graveYardLocation.x,this.graveYardLocation.y)-90)/400,1));var o=this.treeTextures[this.treeTextures.length-1-Math.round((this.treeTextures.length-1)*n)];this.gameModel.isBossStage(this.gameModel.level)&&Math.random()>.7&&(o=a.getRandomElementFromArray(this.armyTextures,Math.random()));var h=new PIXI.Sprite(o);h.anchor.set(.5,1),h.x=s.x,h.y=s.y,h.zIndex=h.y,h.scale.x=h.scale.y=2,h.scale.x=Math.random()>.5?h.scale.x:-1*h.scale.x,this.treeSprites.push(h),a.characterContainer.addChild(h)}t--}},e}();t.ZmMap=n;var o=function(){this.x=!1,this.y=!1,this.validX=0,this.validY=0}},140:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gameFieldSize=t.setGameFieldSizeForLevel=t.update=t.centerGameContainer=t.zoom=t.characterContainer=t.KeysPressed=t.uiContainer=t.backgroundSpriteContainer=t.backgroundContainer=t.viewableArea=t.gameContainer=t.foregroundContainer=void 0;var s,a,r,n,o,h,l,c,d,u=i(838);t.gameContainer=s,t.backgroundContainer=a,t.backgroundSpriteContainer=r,t.characterContainer=n,t.uiContainer=o,t.foregroundContainer=h;var p,g,m,f,y,b,v,x={x:800,y:600,defaultScale:1},S={x:600,y:600};function M(e){this.data=e.data,this.dragging=!0,this.dragOffset=this.data.getLocalPosition(this),this.dragOffset.x*=this.scale.x,this.dragOffset.y*=this.scale.y,this.dragStartX=this.x,this.dragStartY=this.y,w=0}function k(){this.dragging=!1,this.data=null,w=0}t.gameFieldSize=S;var w=0,C=0;function T(e){if(b.zombieCursor&&(b.zombieCursor.position=e.data.getLocalPosition(this.parent)),e.data.originalEvent.touches&&e.data.originalEvent.touches.length>1)!function(e){var t=Math.abs(e.data.originalEvent.touches[0].clientX-e.data.originalEvent.touches[1].clientX);w?C+50<Date.now()&&Math.abs(t-w)>10&&(z(t>w?1:-1,null),C=Date.now(),w=t):w=t}(e);else if(this.dragging){var t=this.data.getLocalPosition(this.parent);this.x=t.x-this.dragOffset.x,this.y=t.y-this.dragOffset.y,D(this),u.distanceBetweenPoints(this.dragStartX,this.dragStartY,this.x,this.y)>5&&(this.hasMoved=!0)}}function D(e){var t=S.x*e.scale.x,i=S.y*e.scale.y;e.x>.5*x.x&&(e.x=.5*x.x),e.x+t<.5*x.x&&(e.x=.5*x.x-t),e.y>.5*x.y&&(e.y=.5*x.y),e.y+i<.5*x.y&&(e.y=.5*x.y-i)}function P(e){this.hasMoved||p.currentState!=p.states.playingLevel||(Z.shift?b.spawnAllZombies(e.data.getLocalPosition(this).x,e.data.getLocalPosition(this).y):b.spawnZombie(e.data.getLocalPosition(this).x,e.data.getLocalPosition(this).y)),this.hasMoved=!1}function z(e,t){if(!(C+50>Date.now())){C=Date.now();var i=s;t||(t={x:.5*x.x,y:.5*x.y});var a=S.x*i.scale.x,r=S.y*i.scale.y;t.x>i.x+a&&(t.x=i.x+a),t.x<i.x&&(t.x=i.x),t.y<i.y&&(t.y=i.y),t.y>i.y+r&&(t.y=i.y+r);var n=(t.x-i.x)/i.scale.x,o=(t.y-i.y)/i.scale.y;e>0?i.scale.x<10&&(i.scale.x=i.scale.y=1.1*i.scale.x,b.zombieCursor&&b.zombieCursor.scale&&(b.zombieCursor.scale.x=b.zombieCursor.scale.y=1.1*b.zombieCursor.scale.x)):Math.max(a,r)>.8*Math.min(x.y,x.x)&&(i.scale.x=i.scale.y=.9*i.scale.x,b.zombieCursor&&b.zombieCursor.scale&&(b.zombieCursor.scale.x=b.zombieCursor.scale.y=.9*b.zombieCursor.scale.x)),i.x=t.x-n*i.scale.x,i.y=t.y-o*i.scale.y,D(i)}}function B(e){e.preventDefault();var t={x:e.clientX*(x.x/document.body.clientWidth),y:e.clientY*(x.y/document.body.clientHeight)};e.deltaY<0||e.deltaX<0?z(1,t):z(-1,t)}function I(e){void 0===e&&(e=!1),e&&(s.scale.x=x.defaultScale,s.scale.y=x.defaultScale,b.zombieCursor&&(b.zombieCursor.scale.x=b.zombieCursor.scale.y=b.zombieCursorScale*x.defaultScale)),s.x=(x.x-S.x*s.scale.x)/2,s.y=(x.y-S.y*s.scale.y)/2}t.zoom=z,t.centerGameContainer=I;var H={x:0,y:0,width:1e3,height:1e3,hideParticle:function(e,t){return e<this.x||t<this.y||e>this.x+this.width||t>this.y+this.height},update:function(){this.x=-s.x/s.scale.x,this.y=-s.y/s.scale.y,this.width=x.x/s.scale.x,this.height=x.y/s.scale.y}};t.viewableArea=H;var F=new PIXI.Matrix,R=0,A=1;function E(e,t){p.persistentData.showfps&&(R++,(A-=e)<0&&(p.frameRate=R,R=0,A=1)),function(e){var t=Z,i=!1,a=s;t.w&&(a.y+=t.scrollSpeed*e,i=!0),t.a&&(a.x+=t.scrollSpeed*e,i=!0),t.s&&(a.y-=t.scrollSpeed*e,i=!0),t.d&&(a.x-=t.scrollSpeed*e,i=!0),i&&D(a)}(e),H.update(),e*=p.gameSpeed,m.update(e),v.update(e),b.update(e),f.update(e),y.update(e),g.update(e),c.visible=v.vipEscaping&&void 0!==v.vip,c.visible&&function(e){c.x=5,c.y=x.y-305;var t=s.scale.x,i=s.scale.y,a=s.x,r=s.y;s.position.set(0,0),v.vip&&(F.tx=-2*v.vip.x+150,F.ty=-2*v.vip.y+150),s.scale.set(2,2),e.renderer.render(s,l,void 0,F),s.scale.set(t,i),s.position.set(a,r)}(t)}function L(){var e=Math.min(500+50*p.level,1500),i=Math.random()*e/3;t.gameFieldSize=S={x:e+i,y:e-i},d&&(d.width=S.x,d.height=S.y),s.hitArea=new PIXI.Rectangle(0,0,S.x,S.y)}function G(){var e=document.body.clientWidth,t=document.body.clientHeight;x={x:e,y:t,defaultScale:Math.max(e,t)/1e3},Z.scrollSpeed=Math.max(e,t)/4}t.update=E,t.setGameFieldSizeForLevel=L,window.onload=function(){p=u.GameModel.getInstance(),g=new u.Particles,m=new u.Graveyard,f=new u.Creatures,y=new u.Skeleton,b=new u.Zombies,v=new u.Humans,p.loadData(),p.onReady(),G(),function(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;var e=new PIXI.Application({width:x.x,height:x.y,backgroundColor:1066256,resolution:p.persistentData.resolution||1,antialias:!1,resizeTo:window});document.body.appendChild(e.view),function(e){t.gameContainer=s=new PIXI.Container,t.backgroundContainer=a=new PIXI.Container,t.backgroundSpriteContainer=r=new PIXI.Container,t.characterContainer=n=new PIXI.Container,n.sortableChildren=!0,t.foregroundContainer=h=new PIXI.Container,t.uiContainer=o=new PIXI.Container,l=PIXI.RenderTexture.create({width:300,height:300}),(c=new PIXI.Sprite(l)).visible=!1,o.addChild(c),s.addChild(a),s.addChild(r),s.addChild(n),s.addChild(h),e.stage.addChild(s),e.stage.addChild(o),s.interactive=!0,s.interactiveChildren=!1,s.on("pointerdown",M),s.on("pointerup",k),s.on("pointerupoutside",k),s.on("pointermove",T),s.on("click",P),s.on("tap",P),document.getElementsByTagName("canvas")[0].onwheel=B,document.getElementsByTagName("canvas")[0].oncontextmenu=function(e){e.preventDefault()}}(e),e.loader.add("sprites/ground.json").add("sprites/megagraveyard.png").add("sprites/graveyard.json").add("sprites/buildings.json").add("sprites/humans.json").add("sprites/cop.json").add("sprites/dogs.json").add("sprites/army.json").add("sprites/doctor.json").add("sprites/zombie.json").add("sprites/golem.json").add("sprites/bonecollector.json").add("sprites/harpy.json").add("sprites/objects2.json").add("sprites/fenceposts.json").add("sprites/trees2.json").add("sprites/fortress.json").add("sprites/tank.json").add("sprites/skeleton.json").load((function(){p.app=e,L(),(d=new PIXI.TilingSprite(PIXI.Texture.from("grass.png"))).width=S.x,d.height=S.y,a.addChild(d),p.setupLevel(),setTimeout((function(){I(!0)})),e.ticker.add((function(t){E(e.ticker.deltaMS/1e3,e)}))}))}(),window.self!==window.top&&(""!=document.referrer&&-1==document.referrer.indexOf("kongregate.com")&&-1==document.referrer.indexOf("konggames.com")&&-1==document.referrer.indexOf("gti.nz")?window.location.href="https://www.youtube.com/watch?v=dQw4w9WgXcQ":-1===document.referrer.indexOf("kongregate.com")&&-1===document.referrer.indexOf("konggames.com")||kongregateAPI.loadAPI((function(){window.kongregate=kongregateAPI.getAPI(),p.kongregate=!0,p.loginInUsingPlayFab()}))),document.addEventListener("visibilitychange",(function(){"hidden"==document.visibilityState?p.hidden=!0:p.hidden=!1}),!1)},window.onresize=function(){G()};var Z={scrollSpeed:200,w:!1,a:!1,s:!1,d:!1,shift:!1};t.KeysPressed=Z,window.onblur=function(){Z.w=Z.a=Z.s=Z.d=!1},window.onkeydown=function(e){switch(e.keyCode){case 16:case 17:Z.shift=!0;break;case 87:case 38:Z.w=!0;break;case 65:case 37:Z.a=!0;break;case 83:case 40:Z.s=!0;break;case 68:case 39:Z.d=!0;break;default:return!0}return!1},window.onkeyup=function(e){switch(e.keyCode){case 16:case 17:Z.shift=!1;break;case 87:case 38:Z.w=!1;break;case 65:case 37:Z.a=!1;break;case 83:case 40:Z.s=!1;break;case 68:case 39:Z.d=!1;break;default:return!0}return!1}},550:function(e,t,i){var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:!0}),t.Zombies=t.Zombie=void 0;var r=i(5),n=i(841),o=i(838),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dog=!1,t.super=!1,t}return a(t,e),t}(n.CharacterFlags),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags=new h,t.mod=1,t.scaleMod=1,t.textureId=0,t.turnTimer=0,t.detonateTimer=0,t}return a(t,e),t}(r.Creature);t.Zombie=l;var c=function(){function e(){if(this.zombies=[],this.discardedZombies=[],this.aliveZombies=[],this.aliveHumans=[],this.zombiePartition=[],this.scaling=2,this.moveTargetDistance=15,this.attackDistance=15,this.attackSpeed=3,this.targetDistance=100,this.fadeSpeed=.1,this.currId=1,this.scanTime=3,this.textures=[],this.dogTexture=[],this.deadDogTexture=[],this.maxSpeed=10,this.zombieCursor=null,this.zombieCursorText=null,this.zombieCursorScale=3,this.burnTickTimer=5,this.smokeTimer=.3,this.fastDistance=o.fastDistance,this.magnitude=o.magnitude,this.detonate=!1,this.super=!1,this.reactionTime=0,this.graveyardAttackers=[],this.spaceNeeded=3,e.instance)return e.instance;e.instance=this}return e.prototype.populate=function(){if(this.map=new o.ZmMap,this.model=o.GameModel.getInstance(),this.humans=new o.Humans,this.graveyard=new o.Graveyard,this.smoke=new o.Smoke,this.blood=new o.Blood,this.bones=new o.Bones,this.exclamations=new o.Exclamations,this.blasts=new o.Blasts,this.bullets=new o.Bullets,this.model.zombieCount=0,0==this.textures.length){for(var e=0;e<3;e++){for(var t=[],i=0;i<3;i++)t.push(PIXI.Texture.from("zombie"+(e+1)+"_"+(i+1)+".png"));this.textures.push({animated:t,dead:[PIXI.Texture.from("zombie"+(e+1)+"_dead.png")]})}for(e=0;e<2;e++)this.dogTexture.push(PIXI.Texture.from("zombiedog"+(e+1)+".png"));this.deadDogTexture=[PIXI.Texture.from("zombiedogdead.png")]}if(this.zombies.length>0){for(e=0;e<this.zombies.length;e++)o.characterContainer.removeChild(this.zombies[e]),this.zombies[e].stop();this.discardedZombies=this.zombies.slice(),this.zombies.length=0,this.aliveZombies.length=0}if(!this.zombieCursor){this.zombieCursor=new PIXI.Container;var s=new PIXI.Sprite(PIXI.Texture.from("zombie1_1.png"));s.alpha=.6,s.scale.x=s.scale.y=1,s.anchor.set(35/80,1),this.zombieCursorText=new PIXI.Text("1",{fontFamily:"sans-serif",fontSize:40,fill:"#FFF",stroke:"#000",strokeThickness:0,align:"center"}),this.zombieCursorText.anchor={x:.5,y:1},this.zombieCursorText.scale.x=this.zombieCursorText.scale.y=.1,this.zombieCursorText.y=-9,this.zombieCursorText.visible=!1,this.zombieCursorText.alpha=.7,this.zombieCursor.addChild(s),this.zombieCursor.addChild(this.zombieCursorText),o.uiContainer.addChild(this.zombieCursor)}},e.prototype.createZombie=function(e,t,i){void 0===i&&(i=!1);var s,a=Math.floor(Math.random()*this.textures.length);this.discardedZombies.length>0?(s=this.discardedZombies.pop()).textures=i?this.dogTexture:this.textures[a].animated:s=new l(i?this.dogTexture:this.textures[a].animated),s.zombie=!0,s.mod=1,s.scaleMod=1,this.super&&(s.mod=10,s.scaleMod=1.5),s.scaleMod>2&&(s.mod=20,s.scaleMod=2),s.flags=new h,s.flags.dog=i,s.flags.super=this.super,s.deadTexture=s.flags.dog?this.deadDogTexture:this.textures[a].dead,s.textureId=a,s.burnDamage=0,s.lastKnownBuilding=!1,s.alpha=1,s.animationSpeed=.15,s.anchor.set(35/80,1),s.position.set(e,t),s.target=null,s.zIndex=s.position.y,s.visible=!0,s.maxHealth=s.health=this.model.zombieHealth*s.mod,s.regenTimer=5,s.state=r.CreatureState.lookingForTarget;var n=i?.7:1;s.scaling=s.scaleMod*this.scaling*n,s.scale.set(Math.random()>.5?s.scaling:-1*s.scaling,s.scaling),s.timer.attack=0,s.xSpeed=0,s.ySpeed=0,s.speedMultiplier=1,s.timer.scan=0,s.timer.burnTick=this.burnTickTimer,s.timer.smoke=this.smokeTimer,s.play(),s.zombieId=this.currId++,this.zombies.push(s),o.characterContainer.addChild(s),this.smoke.newZombieSpawnCloud(e,t-2)},e.prototype.spawnZombie=function(e,t){this.model.energy<this.model.zombieCost||(this.model.energy-=this.model.zombieCost,this.createZombie(e,t,!1))},e.prototype.spawnAllZombies=function(e,t){for(var i=Math.min(Math.floor(this.model.energy/this.model.zombieCost),100),s=0;s<i;s++)this.spawnZombie(e+4*(Math.random()-1),t+4*(Math.random()-1))},e.prototype.damageZombie=function(e,t,i){e.graveyard?this.graveyard.damageGraveyard(t):(this.graveyard.isWithinFence(e)&&(t*=.5,this.exclamations.newShield(e)),i&&i.flags.infected&&(t*=this.model.plagueDmgReduction),e.health-=t*this.model.runeEffects.damageReduction,e.speedMultiplier=Math.max(Math.min(1,e.health/e.maxHealth),.4),e.flags.burning&&(e.speedMultiplier=this.model.burningSpeedMod),this.blood.newSplatter(e.x,e.y),e.health<=0&&!e.flags.dead&&(this.bones.newBones(e.x,e.y),e.flags.dead=!0,Math.random()<this.model.infectedBlastChance&&this.causePlagueExplosion(e,.2*e.maxHealth,!0),e.textures=e.deadTexture,e.gotoAndStop(0),Math.random()<this.model.brainRecoverChance&&this.model.addBrains(1)),i&&this.model.runeEffects.damageReflection>0&&this.humans.damageHuman(i,t*this.model.runeEffects.damageReflection))},e.prototype.causePlagueExplosion=function(e,t,i){void 0===i&&(i=!0);var s=50;this.blood.newPlagueSplatter(e.x,e.y),this.blasts.newBlast(e.x,e.y-4),i&&(e.visible=!1,o.characterContainer.removeChild(e));for(var a=0;a<this.aliveHumans.length;a++)Math.abs(this.aliveHumans[a].x-e.x)<s&&Math.abs(this.aliveHumans[a].y-e.y)<s&&this.fastDistance(e.x,e.y,this.aliveHumans[a].x,this.aliveHumans[a].y)<s&&(this.inflictPlague(this.aliveHumans[a]),this.humans.damageHuman(this.aliveHumans[a],t));if(this.model.blastHealing>0){var r=t*this.model.blastHealing;for(a=0;a<this.aliveZombies.length;a++)Math.abs(this.aliveZombies[a].x-e.x)<s&&Math.abs(this.aliveZombies[a].y-e.y)<s&&this.fastDistance(e.x,e.y,this.aliveZombies[a].x,this.aliveZombies[a].y)<s&&this.healZombie(this.aliveZombies[a],r)}},e.prototype.partitionInsert=function(e,t){var i=Math.round(t.x/10),s=Math.round(t.y/10);e[i]||(e[i]=[]),e[i][s]||(e[i][s]=[]),e[i][s].push(t)},e.prototype.partitionGetNeighbours=function(e){for(var t=[],i=Math.round(e.x/10),s=Math.round(e.y/10),a=i-1;a<=i+1;a++)if(this.zombiePartition[a])for(var r=s-1;r<=s+1;r++)this.zombiePartition[a][r]&&t.push.apply(t,this.zombiePartition[a][r]);return t},e.prototype.update=function(e){this.maxSpeed=this.model.zombieSpeed,this.reactionTime=Math.max(.2,this.aliveZombies.length/2e3);var t=[],i=[];this.aliveHumans=this.humans.aliveHumans,this.graveyardAttackers=this.humans.graveyardAttackers;for(var s=0;s<this.zombies.length;s++)this.zombies[s].visible&&(this.updateZombie(this.zombies[s],e),this.zombies[s].flags.dead||(t.push(this.zombies[s]),this.partitionInsert(i,this.zombies[s])));if(this.model.zombieCount=t.length,this.aliveZombies=t,this.zombiePartition=i,this.model.energy>=this.model.zombieCost&&this.model.currentState==this.model.states.playingLevel)if(this.zombieCursor.visible=!0,o.KeysPressed.shift){this.zombieCursorText.visible=!0;var a=Math.min(Math.floor(this.model.energy/this.model.zombieCost),100);this.zombieCursorText.text!=a&&(this.zombieCursorText.text=a)}else this.zombieCursorText.visible=!1;else this.zombieCursor.visible=!1},e.prototype.detonateZombie=function(e,t){e.detonateTimer||(e.detonateTimer=3*Math.random()),e.detonateTimer-=t,e.detonateTimer<0&&(this.bones.newBones(e.x,e.y),e.flags.dead=!0,this.causePlagueExplosion(e,.2*e.maxHealth,!0),Math.random()<this.model.brainRecoverChance&&this.model.addBrains(1))},e.prototype.updateZombie=function(e,t){var i;if(e.flags.dead){if(!e.visible)return;return e.alpha-=this.fadeSpeed*t,void(e.alpha<0&&(e.visible=!1,o.characterContainer.removeChild(e)))}switch(e.timer.attack-=t,e.timer.scan-=t,this.model.runeEffects.healthRegen>0&&this.updateZombieRegen(e,t),this.detonate&&this.detonateZombie(e,t),e.flags.burning&&this.updateBurns(e,t),(!e.target||e.target.flags.dead)&&e.timer.scan<0&&(e.state=r.CreatureState.lookingForTarget),e.state){case r.CreatureState.lookingForTarget:this.searchClosestTarget(null!==(i=e.target)&&void 0!==i?i:e),e.target&&!e.target.flags.dead||this.assignRandomTarget(e),e.target&&(e.state=r.CreatureState.movingToTarget);break;case r.CreatureState.movingToTarget:var s=this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y);if(s<this.attackDistance){e.state=r.CreatureState.attackingTarget;break}e.timer.attack<0&&s<this.model.spitDistance&&(this.bullets.newBullet(e,e.target,this.model.zombieDamage/2,!0),e.timer.attack=this.attackSpeed*this.model.runeEffects.attackSpeed),s>3*this.attackDistance&&e.timer.scan<0&&this.searchClosestTarget(e),this.updateZombieSpeed(e,t);break;case r.CreatureState.attackingTarget:var a=this.fastDistance(e.position.x,e.position.y,e.target.x,e.target.y);a<this.attackDistance?(e.scale.x=e.target.x>e.x?e.scaling:-e.scaling,e.timer.attack<0&&(this.humans.damageHuman(e.target,this.calculateDamage(e)),e.flags.dog&&(e.target.timer.dogStun=1),Math.random()<this.model.infectedBiteChance&&this.inflictPlague(e.target),e.timer.attack=this.attackSpeed*this.model.runeEffects.attackSpeed,e.flags.burning&&(e.timer.attack*=1/this.model.burningSpeedMod)),a>this.attackDistance/2&&this.updateZombieSpeed(e,t)):e.state=r.CreatureState.movingToTarget}},e.prototype.updateZombieRegen=function(e,t){e.regenTimer-=t,e.regenTimer<0&&(e.regenTimer=5,e.health<e.maxHealth&&(e.health+=e.maxHealth*this.model.runeEffects.healthRegen,e.health>e.maxHealth&&(e.health=e.maxHealth),e.speedMultiplier=Math.max(Math.min(1,e.health/e.maxHealth),.4)))},e.prototype.healZombie=function(e,t){e.health<e.maxHealth&&(e.health+=t,this.exclamations.newHealing(e),e.health>e.maxHealth&&(e.health=e.maxHealth),e.speedMultiplier=Math.max(Math.min(1,e.health/e.maxHealth),.4))},e.prototype.calculateDamage=function(e){var t=this.model.zombieDamage*e.mod;return this.model.runeEffects.critChance>0&&Math.random()<this.model.runeEffects.critChance&&(t*=this.model.runeEffects.critDamage),t},e.prototype.inflictPlague=function(e){e.flags.infected?(e.plagueDamage+=this.model.zombieDamage/2+this.model.plagueDamageMod,e.plagueTicks+=5):(this.exclamations.newPoison(e),e.plagueDamage=this.model.zombieDamage/2+this.model.plagueDamageMod,e.plagueTicks=5),e.flags.infected=!0},e.prototype.updateBurns=function(e,t){e.timer.burnTick-=t,e.timer.smoke-=t,e.timer.smoke<0&&(this.smoke.newFireSmoke(e.x,e.y-14),e.timer.smoke=this.smokeTimer),e.timer.burnTick<0&&(this.damageZombie(e,e.burnDamage,null),e.timer.burnTick=this.burnTickTimer,this.exclamations.newFire(e))},e.prototype.searchClosestTarget=function(e){if(!(e.timer.scan>0)){e.timer.scan=this.scanTime*Math.random();var t=300;if(this.model.isBossStage(this.model.level)&&Math.random()>.3)for(var i=0;i<this.graveyardAttackers.length;i++)Math.abs(this.graveyardAttackers[i].x-e.x)<t&&Math.abs(this.graveyardAttackers[i].y-e.y)<t&&(s=this.fastDistance(e.x,e.y,this.graveyardAttackers[i].x,this.graveyardAttackers[i].y))<t&&(e.target=this.graveyardAttackers[i],t=s);if(300==t)for(t=1e4,i=0;i<this.aliveHumans.length;i++){var s;Math.abs(this.aliveHumans[i].x-e.x)<t&&Math.abs(this.aliveHumans[i].y-e.y)<t&&(s=this.fastDistance(e.x,e.y,this.aliveHumans[i].x,this.aliveHumans[i].y))<t&&(e.target=this.aliveHumans[i],t=s)}}},e.prototype.assignRandomTarget=function(e){if(0!=this.aliveHumans.length){var t=this.map.findBuilding(e);if(t&&this.map.isInsidePoi(e.x,e.y,t,0))for(var i=0;i<this.aliveHumans.length;i++)if(this.map.isInsidePoi(this.aliveHumans[i].x,this.aliveHumans[i].y,t,0))return void(e.target=this.aliveHumans[i]);e.target=o.getRandomElementFromArray(this.aliveHumans,Math.random())}},e.prototype.dotProduct=function(e,t){return e*e+t*t},e.prototype.updateZombieSpeed=function(e,t){if(e.timer.dogStun&&e.timer.dogStun>0)e.timer.dogStun-=t;else{if(e.timer.target&&e.targetVector||(e.timer.target=0),e.timer.target-=t,e.timer.target<=0&&(e.targetVector=this.map.howDoIGetToMyTarget(e,e.target),e.timer.target=this.reactionTime),this.model.gameSpeed>1||e.flags.dog){var i=e.flags.dog?1.5:1,s=Math.max(this.maxSpeed*e.speedMultiplier*i,8);e.xSpeed=e.targetVector.x*s,e.ySpeed=e.targetVector.y*s}else{var a=5*this.maxSpeed*t;e.xSpeed+=e.targetVector.x*a,e.ySpeed+=e.targetVector.y*a;var r=this.dotProduct(e.xSpeed,e.ySpeed),n=Math.pow(Math.max(this.maxSpeed*e.speedMultiplier,8),2);r>n&&(e.xSpeed*=n/r,e.ySpeed*=n/r)}var o={x:e.position.x+e.xSpeed*t,y:e.position.y+e.ySpeed*t};if(e.turnTimer-=t,e.turnTimer<0&&(e.turnTimer=.5,!this.isSpaceToMove(e,o.x,o.y))){if(Math.random()>.5){var h={x:-e.ySpeed/2+e.xSpeed/2,y:e.xSpeed/2+e.ySpeed/2};e.xSpeed=h.x,e.ySpeed=h.y}else h={x:e.ySpeed/2+e.xSpeed/2,y:-e.xSpeed/2+e.ySpeed/2},e.xSpeed=h.x,e.ySpeed=h.y;o={x:e.position.x+e.xSpeed*t,y:e.position.y+e.ySpeed*t}}var l=this.map.checkCollisions(e.position,o);l&&(l.x&&(e.xSpeed=0),l.y&&(e.ySpeed=0),o={x:e.position.x+e.xSpeed*t,y:e.position.y+e.ySpeed*t},l.x&&(o.x=l.validX),l.y&&(o.y=l.validY)),e.position.set(o.x,o.y),e.zIndex=e.position.y,e.scale.x=e.xSpeed>0?e.scaling:-e.scaling}},e.prototype.isSpaceToMove=function(e,t,i){for(var s=this.partitionGetNeighbours(e),a=0;a<s.length;a++)if(s[a].health>=e.health&&s[a].zombieId!=e.zombieId&&Math.abs(s[a].x-t)<this.spaceNeeded&&Math.abs(s[a].y-i)<this.spaceNeeded&&Math.abs(s[a].x-t)<this.spaceNeeded)return this.fastDistance(t,i,s[a].x,s[a].y)>this.fastDistance(e.x,e.y,s[a].x,s[a].y);return!0},e}();t.Zombies=c}},t={},i=function i(s){if(t[s])return t[s].exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,i),a.exports}(115);Incremancer=i})();
//# sourceMappingURL=bundle.js.map